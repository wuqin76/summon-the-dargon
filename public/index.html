<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¬å”¤ç¥é¾™ - Dragon Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #FF9933 0%, #FFFFFF 50%, #138808 100%);
            background-attachment: fixed;
            color: #ffffff;
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
            position: relative;
        }
        
        /* å°åº¦é£æ ¼è£…é¥°èƒŒæ™¯ - å¢å¼ºç‰ˆ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 153, 51, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(19, 136, 8, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255, 215, 0, 0.08) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* å¤šä¸ªæ¼‚æµ®è£…é¥°å…ƒç´  */
        .floating-elements {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        
        .floating-elements::before {
            content: 'ğŸª·';
            position: absolute;
            font-size: 40px;
            animation: floatFlower1 25s infinite linear;
            opacity: 0.4;
        }
        
        .floating-elements::after {
            content: 'ğŸ¦š';
            position: absolute;
            font-size: 45px;
            animation: floatFlower2 30s infinite linear;
            opacity: 0.35;
        }
        
        @keyframes floatFlower1 {
            0% { top: -60px; left: 5%; transform: rotate(0deg); }
            50% { left: 85%; transform: rotate(180deg); }
            100% { top: 110vh; left: 15%; transform: rotate(360deg); }
        }
        
        @keyframes floatFlower2 {
            0% { top: -70px; right: 10%; transform: rotate(0deg) scaleX(-1); }
            50% { right: 80%; transform: rotate(180deg) scaleX(-1); }
            100% { top: 110vh; right: 20%; transform: rotate(360deg) scaleX(-1); }
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 0;
            padding-bottom: 20px;
            position: relative;
            z-index: 2;
            width: 100%;
        }
        
        @media (max-width: 768px) {
            .container {
                padding-bottom: 15px;
            }
        }

        /* å°åº¦é£æ ¼é¡¶éƒ¨æŠ½å¥–åŒºåŸŸ */
        .spin-hero {
            background: linear-gradient(135deg, #FF9933 0%, #FF6B35 50%, #F7931E 100%);
            padding: clamp(20px, 5vw, 35px) clamp(15px, 4vw, 25px);
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(255, 153, 51, 0.6),
                        0 0 100px rgba(255, 107, 53, 0.3);
            border-bottom: clamp(3px, 0.8vw, 6px) solid #138808;
        }
        
        @media (max-width: 480px) {
            .spin-hero {
                padding: 18px 12px;
            }
        }
        
        /* æ›¼é™€ç½—å›¾æ¡ˆè£…é¥° */
        .spin-hero::after {
            content: '';
            position: absolute;
            top: -100px;
            right: -100px;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, transparent 30%, rgba(255, 255, 255, 0.1) 30%, transparent 31%),
                        radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.05) 0%, transparent 70%);
            border-radius: 50%;
            animation: rotateMandala 30s infinite linear;
            pointer-events: none;
        }
        
        @keyframes rotateMandala {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .spin-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255, 255, 255, 0.03) 10px,
                rgba(255, 255, 255, 0.03) 20px
            );
            animation: slideBackground 20s linear infinite;
        }

        @keyframes slideBackground {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50%, 50%); }
        }

        .spin-hero-content {
            position: relative;
            z-index: 1;
        }

        .spin-title {
            text-align: center;
            font-size: clamp(24px, 6vw, 36px);
            font-weight: 900;
            margin-bottom: 15px;
            text-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.6),
                0 0 30px rgba(255, 153, 51, 0.8),
                0 0 60px rgba(255, 215, 0, 0.4);
            animation: pulse 2s ease-in-out infinite;
            color: #FFFFFF;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 0 15px;
        }
        
        .spin-title::before,
        .spin-title::after {
            content: 'ğŸª”';
            font-size: clamp(20px, 5vw, 28px);
            animation: flickerFlame 1.5s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(255, 153, 51, 0.8));
        }
        
        @keyframes flickerFlame {
            0%, 100% { 
                opacity: 0.8; 
                transform: scale(1) translateY(0);
                filter: drop-shadow(0 0 10px rgba(255, 153, 51, 0.8));
            }
            50% { 
                opacity: 1; 
                transform: scale(1.15) translateY(-3px);
                filter: drop-shadow(0 0 20px rgba(255, 153, 51, 1));
            }
        }
        
        @media (max-width: 480px) {
            .spin-title {
                gap: 8px;
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .invite-tip {
            text-align: center;
            font-size: clamp(13px, 3.5vw, 16px);
            margin-bottom: clamp(15px, 4vw, 22px);
            padding: clamp(10px, 2.5vw, 14px) clamp(15px, 4vw, 22px);
            background: rgba(255, 255, 255, 0.25);
            border-radius: 25px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.35);
            animation: tipGlow 2s ease-in-out infinite;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: clamp(10px, 3vw, 15px);
            flex-wrap: wrap;
            line-height: 1.4;
            position: relative;
            z-index: 50;
        }
        
        @media (max-width: 480px) {
            .invite-tip {
                font-size: 13px;
                padding: 10px 15px;
            }
        }

        @keyframes tipGlow {
            0%, 100% { 
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
                border-color: rgba(255, 255, 255, 0.3);
            }
            50% { 
                box-shadow: 0 4px 25px rgba(255, 215, 0, 0.4);
                border-color: rgba(255, 215, 0, 0.6);
            }
        }

        .invite-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: clamp(8px, 2vw, 12px) clamp(18px, 5vw, 28px);
            border-radius: 20px;
            font-size: clamp(13px, 3.5vw, 16px);
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 242, 254, 0.4);
            transition: all 0.3s ease;
            white-space: nowrap;
            position: relative;
            z-index: 100;
            pointer-events: auto;
        }

        .invite-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 242, 254, 0.5);
        }

        .invite-btn:active {
            transform: translateY(0);
        }

        /* è½¬ç›˜å®¹å™¨ - å“åº”å¼é€‚é…ï¼ˆæ›´å¤§ï¼‰ */
        .wheel-container {
            position: relative;
            width: 92vw;
            max-width: 550px;
            height: 92vw;
            max-height: 550px;
            margin: 0 auto 30px;
        }
        
        @media (max-width: 768px) {
            .wheel-container {
                width: 90vw;
                height: 90vw;
                max-width: 450px;
                max-height: 450px;
            }
        }
        
        @media (max-width: 480px) {
            .wheel-container {
                width: 92vw;
                height: 92vw;
                max-width: 380px;
                max-height: 380px;
            }
        }

        .wheel-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 550px;
            height: 550px;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, rgba(255, 153, 51, 0.4) 0%, rgba(247, 147, 30, 0.2) 50%, transparent 70%);
            animation: glowPulse 2s ease-in-out infinite;
            pointer-events: none;
            z-index: 1;
        }

        @keyframes glowPulse {
            0%, 100% { 
                opacity: 0.6; 
                transform: translate(-50%, -50%) scale(1);
                filter: brightness(1);
            }
            50% { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1.1);
                filter: brightness(1.3);
            }
        }

        .wheel {
            width: 100%;
            height: 100%;
            position: relative;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 
                0 15px 50px rgba(0, 0, 0, 0.5), 
                0 0 60px rgba(255, 153, 51, 0.6),
                0 0 100px rgba(247, 147, 30, 0.4),
                inset 0 0 30px rgba(255, 255, 255, 0.2),
                inset 0 0 50px rgba(255, 153, 51, 0.1);
            transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1);
            border: 8px solid #FFD700;
            border-image: linear-gradient(45deg, #FFD700, #FF9933, #FFD700, #FF9933) 1;
            animation: wheelGlow 3s ease-in-out infinite;
        }
        
        @keyframes wheelGlow {
            0%, 100% { 
                filter: brightness(1) drop-shadow(0 0 20px rgba(255, 153, 51, 0.5));
            }
            50% { 
                filter: brightness(1.2) drop-shadow(0 0 40px rgba(255, 153, 51, 0.8));
            }
        }

        .wheel-inner {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .sector {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            clip-path: polygon(0 0, 100% 0, 100% 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            font-weight: 900;
            font-size: 22px;
            color: white;
        }

        .sector span {
            display: block;
            transform: rotate(-15deg);
            text-shadow: 
                0 3px 10px rgba(0, 0, 0, 0.9),
                0 0 20px rgba(255, 255, 255, 0.6),
                0 0 5px rgba(0, 0, 0, 0.8);
            margin-left: clamp(50px, 13vw, 75px);
            margin-top: clamp(-75px, -18vw, -100px);
            font-size: clamp(20px, 6vw, 34px);
            font-weight: 900;
            letter-spacing: 1px;
        }
        
        @media (max-width: 768px) {
            .sector span {
                margin-left: clamp(45px, 12vw, 68px);
                margin-top: clamp(-70px, -17vw, -92px);
                font-size: clamp(19px, 5.8vw, 30px);
            }
        }
        
        @media (max-width: 480px) {
            .sector span {
                margin-left: clamp(42px, 11.5vw, 62px);
                margin-top: clamp(-65px, -16vw, -85px);
                font-size: clamp(18px, 5.5vw, 28px);
            }
        }

        /* å°åº¦é£æ ¼æ‰‡åŒºé…è‰² - é²œè‰³æ˜äº® */
        .sector:nth-child(1) {
            transform: rotate(0deg);
            background: linear-gradient(135deg, #FF6347, #FF4500);
        }

        .sector:nth-child(2) {
            transform: rotate(30deg);
            background: linear-gradient(135deg, #FFD700, #FFA500);
        }

        .sector:nth-child(3) {
            transform: rotate(60deg);
            background: linear-gradient(135deg, #FF9933, #FF7F00);
        }

        .sector:nth-child(4) {
            transform: rotate(90deg);
            background: linear-gradient(135deg, #32CD32, #228B22);
        }

        .sector:nth-child(5) {
            transform: rotate(120deg);
            background: linear-gradient(135deg, #FF69B4, #FF1493);
        }

        .sector:nth-child(6) {
            transform: rotate(150deg);
            background: linear-gradient(135deg, #FFD700, #FFEC8B);
        }

        .sector:nth-child(7) {
            transform: rotate(180deg);
            background: linear-gradient(135deg, #00CED1, #20B2AA);
        }

        .sector:nth-child(8) {
            transform: rotate(210deg);
            background: linear-gradient(135deg, #FF6B35, #F7931E);
        }

        .sector:nth-child(9) {
            transform: rotate(240deg);
            background: linear-gradient(135deg, #9370DB, #8A2BE2);
        }

        .sector:nth-child(10) {
            transform: rotate(270deg);
            background: linear-gradient(135deg, #FF4500, #DC143C);
        }

        .sector:nth-child(11) {
            transform: rotate(300deg);
            background: linear-gradient(135deg, #FFD700, #FF8C00);
        }

        .sector:nth-child(12) {
            transform: rotate(330deg);
            background: linear-gradient(135deg, #32CD32, #3CB371);
        }

        .sector:nth-child(3) span,
        .sector:nth-child(4) span,
        .sector:nth-child(6) span {
            color: #333;
            text-shadow: 0 2px 6px rgba(255, 255, 255, 0.8);
        }

        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: clamp(95px, 20vw, 140px);
            height: clamp(95px, 20vw, 140px);
            background: linear-gradient(135deg, #FFD700, #FF9933, #FFD700);
            background-size: 200% 200%;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(45px, 10vw, 65px);
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.6), 
                0 0 50px rgba(255, 153, 51, 0.9),
                0 0 80px rgba(255, 215, 0, 0.5),
                inset 0 4px 18px rgba(255, 255, 255, 0.6),
                inset 0 -4px 18px rgba(255, 153, 51, 0.5);
            border: clamp(4px, 1vw, 6px) solid #FFFFFF;
            z-index: 10;
            animation: centerGlow 2s ease-in-out infinite;
        }
        
        @media (max-width: 768px) {
            .wheel-center {
                width: clamp(88px, 19vw, 125px);
                height: clamp(88px, 19vw, 125px);
            }
        }
        
        @media (max-width: 480px) {
            .wheel-center {
                width: clamp(80px, 18vw, 115px);
                height: clamp(80px, 18vw, 115px);
                font-size: clamp(40px, 9.5vw, 58px);
            }
        }
        
        @keyframes centerGlow {
            0%, 100% { 
                background-position: 0% 50%;
                box-shadow: 
                    0 5px 20px rgba(0, 0, 0, 0.4), 
                    0 0 30px rgba(255, 153, 51, 0.6),
                    inset 0 2px 10px rgba(255, 255, 255, 0.4);
            }
            50% { 
                background-position: 100% 50%;
                box-shadow: 
                    0 5px 20px rgba(0, 0, 0, 0.4), 
                    0 0 50px rgba(255, 153, 51, 0.9),
                    inset 0 2px 10px rgba(255, 255, 255, 0.6);
            }
        }

        .pointer {
            position: absolute;
            top: clamp(-25px, -6vw, -40px);
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: clamp(25px, 6.5vw, 40px) solid transparent;
            border-right: clamp(25px, 6.5vw, 40px) solid transparent;
            border-top: clamp(50px, 13vw, 80px) solid #FF9933;
            z-index: 11;
            filter: drop-shadow(0 5px 20px rgba(255, 153, 51, 0.9)) 
                    drop-shadow(0 0 30px rgba(255, 153, 51, 0.7));
            animation: pointerBounce 1s ease-in-out infinite;
        }
        
        .pointer::after {
            content: '';
            position: absolute;
            top: clamp(-50px, -13vw, -80px);
            left: clamp(-25px, -6.5vw, -40px);
            width: clamp(50px, 13vw, 80px);
            height: clamp(50px, 13vw, 80px);
            background: radial-gradient(circle, rgba(255, 153, 51, 0.4) 0%, transparent 70%);
            animation: pointerGlow 1.5s ease-in-out infinite;
        }
        
        @media (max-width: 480px) {
            .pointer {
                top: clamp(-20px, -5vw, -30px);
            }
        }

        @keyframes pointerBounce {
            0%, 100% { 
                transform: translateX(-50%) translateY(0);
                filter: drop-shadow(0 5px 15px rgba(255, 153, 51, 0.8));
            }
            50% { 
                transform: translateX(-50%) translateY(-8px);
                filter: drop-shadow(0 8px 20px rgba(255, 153, 51, 1));
            }
        }
        
        @keyframes pointerGlow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .spin-btn {
            display: block;
            width: 88%;
            max-width: 360px;
            margin: 0 auto clamp(15px, 4vw, 25px);
            padding: clamp(16px, 4.5vw, 24px) clamp(30px, 8vw, 50px);
            background: linear-gradient(135deg, #FF9933 0%, #FFD700 50%, #FF9933 100%);
            background-size: 200% 100%;
            border: clamp(3px, 0.8vw, 5px) solid #FFFFFF;
            border-radius: 50px;
            font-size: clamp(18px, 5vw, 26px);
            font-weight: 900;
            color: #FFFFFF;
            text-shadow: 
                0 3px 6px rgba(0, 0, 0, 0.4),
                0 0 15px rgba(255, 153, 51, 0.6);
            cursor: pointer;
            box-shadow: 
                0 10px 35px rgba(255, 153, 51, 0.7),
                0 0 50px rgba(255, 153, 51, 0.5),
                inset 0 3px 12px rgba(255, 255, 255, 0.4);
            transition: all 0.3s ease;
            animation: btnShine 3s ease-in-out infinite;
        }
        
        @media (max-width: 480px) {
            .spin-btn {
                width: 85%;
                padding: 16px 35px;
                font-size: 18px;
            }
        }

        @keyframes btnShine {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .spin-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.7);
        }

        .spin-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            animation: none;
        }

        .spin-status {
            text-align: center;
            font-size: 16px;
            margin-top: 15px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .header {
            text-align: center;
            padding: 35px 20px 25px;
        }

        .game-content {
            padding: 0 20px;
        }

        .header h1 {
            font-size: 38px;
            margin-bottom: 12px;
            text-shadow: 0 3px 15px rgba(0, 0, 0, 0.4);
            font-weight: 900;
        }

        .header p {
            font-size: 18px;
            opacity: 0.95;
        }



        /* æ¸¸æˆæ¨¡å¼å¡ç‰‡ */
        .modes-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 30px;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        .mode-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 35px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
            cursor: pointer;
            border: 3px solid transparent;
        }

        .mode-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .mode-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .mode-badge.free {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .mode-icon {
            font-size: 70px;
            margin-bottom: 18px;
        }

        .mode-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 12px;
        }

        .mode-price {
            font-size: 38px;
            font-weight: bold;
            margin: 18px 0;
            color: #ffd700;
            text-shadow: 0 2px 10px rgba(255, 215, 0, 0.5);
        }

        .mode-features {
            list-style: none;
            margin: 20px 0;
            text-align: left;
        }

        .mode-features li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
            font-size: 14px;
            opacity: 0.9;
        }

        .mode-features li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #4ade80;
            font-weight: bold;
        }

        .mode-features li.disabled-feature:before {
            content: "âœ—";
            color: #ef4444;
        }

        .play-btn {
            width: 100%;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
            color: white;
            padding: 18px 35px;
            border-radius: 35px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 25px;
            box-shadow: 0 6px 20px rgba(245, 87, 108, 0.4);
        }

        .play-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(245, 87, 108, 0.4);
        }

        .play-btn.free-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .info-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            text-align: center;
        }

        .info-box h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .info-box p {
            font-size: 14px;
            opacity: 0.8;
            line-height: 1.6;
        }

        .payment-notice {
            background: rgba(255, 193, 7, 0.2);
            border: 2px solid rgba(255, 193, 7, 0.5);
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
        }

        .payment-notice p {
            margin: 5px 0;
            font-size: 14px;
        }



        /* æŠ½å¥–ç»“æœå¼¹çª— */
        .result-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .result-modal.show {
            display: flex;
        }

        .result-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 30px;
            border-radius: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            color: #fff;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.5s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .result-content h2 {
            font-size: 36px;
            margin-bottom: 20px;
        }

        .prize-amount {
            font-size: 56px;
            font-weight: bold;
            color: #ffd700;
            margin: 20px 0;
            text-shadow: 0 5px 15px rgba(255, 215, 0, 0.5);
            animation: prizeGlow 1.5s ease-in-out infinite;
        }

        @keyframes prizeGlow {
            0%, 100% { text-shadow: 0 5px 15px rgba(255, 215, 0, 0.5); }
            50% { text-shadow: 0 5px 25px rgba(255, 215, 0, 0.9); }
        }

        .result-message {
            font-size: 18px;
            margin: 20px 0;
            opacity: 0.9;
        }

        .close-modal-btn {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
            transition: all 0.3s;
        }

        .close-modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.6);
        }

        /* èƒ½é‡æ¡æ ·å¼ */
        .energy-container {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-top: 25px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .energy-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .energy-title {
            font-size: 18px;
            font-weight: bold;
        }

        .energy-value {
            font-size: 20px;
            font-weight: 900;
            color: #ffd700;
            text-shadow: 0 2px 8px rgba(255, 215, 0, 0.5);
        }

        .energy-bar-wrapper {
            width: 100%;
            height: 40px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .energy-bar {
            height: 100%;
            background: linear-gradient(90deg, #4ade80 0%, #22c55e 50%, #16a34a 100%);
            border-radius: 20px;
            transition: width 0.8s ease;
            position: relative;
            box-shadow: 0 0 20px rgba(74, 222, 128, 0.6);
            animation: energyPulse 2s ease-in-out infinite;
        }

        @keyframes energyPulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(74, 222, 128, 0.6);
            }
            50% {
                box-shadow: 0 0 30px rgba(74, 222, 128, 0.9);
            }
        }

        .energy-shine {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% {
                left: -100%;
            }
            100% {
                left: 200%;
            }
        }

        .energy-tip {
            text-align: center;
            font-size: 15px;
            margin-top: 15px;
            padding: 12px;
            background: rgba(255, 215, 0, 0.15);
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .task-btn {
            width: 100%;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            box-shadow: 0 5px 20px rgba(139, 92, 246, 0.4);
            transition: all 0.3s ease;
        }

        .task-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.6);
        }

        /* é‚€è¯·é“¾æ¥å®¹å™¨ */
        .invite-link-container {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 15px;
        }

        .invite-link-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 12px 15px;
            border-radius: 10px;
            font-size: 14px;
            color: #333;
            font-family: monospace;
        }

        .copy-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 242, 254, 0.4);
        }

        .copy-btn.copied {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
        }

        /* é‚€è¯·ç»Ÿè®¡ */
        .invite-stats {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .stat-item {
            text-align: center;
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            min-width: 100px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.8;
        }

        /* ä»»åŠ¡å¼¹çª—æ ·å¼ */
        .task-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .task-modal.show {
            display: flex;
        }

        .task-modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 40px 30px;
            border-radius: 30px;
            max-width: 450px;
            width: 90%;
            color: #fff;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 215, 0, 0.3);
            animation: modalSlideIn 0.5s ease-out;
        }

        .task-modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .task-modal-header h2 {
            font-size: 32px;
            margin-bottom: 15px;
            text-shadow: 0 3px 10px rgba(255, 215, 0, 0.5);
        }

        .task-modal-header p {
            font-size: 15px;
            opacity: 0.85;
            line-height: 1.6;
        }

        .current-task-card {
            background: rgba(255, 215, 0, 0.1);
            border: 3px solid rgba(255, 215, 0, 0.5);
            border-radius: 20px;
            padding: 30px 25px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.2);
        }

        .task-type-badge {
            display: inline-block;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 6px 18px;
            border-radius: 15px;
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .task-type-badge.initial {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #333;
        }

        .task-type-badge.optional {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .task-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #ffd700;
        }

        .task-description {
            font-size: 16px;
            opacity: 0.9;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .task-progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .task-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ade80 0%, #22c55e 100%);
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(74, 222, 128, 0.6);
        }

        .task-progress-text {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 20px;
        }

        .task-action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .task-action-btn {
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .task-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        .task-action-btn.primary {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #333;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
        }

        .task-action-btn.primary:hover {
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.6);
        }

        .task-info-box {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .task-info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .task-info-item:last-child {
            border-bottom: none;
        }

        .task-info-label {
            font-size: 14px;
            opacity: 0.8;
        }

        .task-info-value {
            font-size: 16px;
            font-weight: bold;
            color: #ffd700;
        }

        .close-task-modal-btn {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
            padding: 15px 30px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .close-task-modal-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .task-hint {
            text-align: center;
            font-size: 13px;
            opacity: 0.7;
            margin-top: 15px;
            font-style: italic;
        }
        
        /* å°åº¦è£…é¥°å…ƒç´  - æ’ç¯èŠ‚ç¯ç¬¼ */
        .diya-decoration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            pointer-events: none;
        }
        
        .diya {
            font-size: 28px;
            animation: diyaGlow 2s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(255, 153, 51, 0.8));
        }
        
        .diya:nth-child(2) { animation-delay: 0.3s; }
        .diya:nth-child(3) { animation-delay: 0.6s; }
        .diya:nth-child(4) { animation-delay: 0.9s; }
        .diya:nth-child(5) { animation-delay: 1.2s; }
        
        @keyframes diyaGlow {
            0%, 100% { 
                opacity: 0.7; 
                transform: translateY(0) scale(1);
                filter: drop-shadow(0 0 10px rgba(255, 153, 51, 0.6));
            }
            50% { 
                opacity: 1; 
                transform: translateY(-5px) scale(1.1);
                filter: drop-shadow(0 0 20px rgba(255, 153, 51, 1));
            }
        }
    </style>
</head>

<body>
    <!-- æ¼‚æµ®è£…é¥°å…ƒç´ å®¹å™¨ -->
    <div class="floating-elements"></div>
    
    <!-- æ’ç¯èŠ‚ç¯ç¬¼è£…é¥° -->
    <div class="diya-decoration">
        <span class="diya">ğŸª”</span>
        <span class="diya">ğŸª”</span>
        <span class="diya">ğŸª”</span>
        <span class="diya">ğŸª”</span>
        <span class="diya">ğŸª”</span>
    </div>
    
    <div class="container indian-border">
        <!-- ç‚«é…·æŠ½å¥–åŒºåŸŸ -->
            <div class="spin-hero">
                <div class="spin-hero-content">
                    <div class="spin-title">ğŸ° à¤­à¤¾à¤—à¥à¤¯ à¤šà¤•à¥à¤° - à¤¬à¤¡à¤¼à¤¾ à¤‡à¤¨à¤¾à¤® à¤œà¥€à¤¤à¥‡à¤‚ ğŸ°</div>
                    <div class="invite-tip">
                        âœ¨ é¦–æ¬¡é‚€è¯·å¥½å‹å³å¯è·å¾—ä¸€æ¬¡æŠ½å¥–æœºä¼š âœ¨
                        <button class="invite-btn" onclick="showInviteLink()">
                            ğŸ‘¥ é‚€è¯·å¥½å‹
                        </button>
                    </div>
                    
                    <div class="wheel-container">
                        <div class="wheel-glow"></div>
                        <div class="pointer"></div>
                        <div class="wheel" id="wheel">
                            <div class="wheel-inner">
                                <div class="sector"><span>â‚¹8888</span></div>
                                <div class="sector"><span>â‚¹888</span></div>
                                <div class="sector"><span>â‚¹188</span></div>
                                <div class="sector"><span>â‚¹88</span></div>
                                <div class="sector"><span>â‚¹18</span></div>
                                <div class="sector"><span>â‚¹8</span></div>
                                <div class="sector"><span>â‚¹3</span></div>
                                <div class="sector"><span>â‚¹1</span></div>
                                <div class="sector"><span>â‚¹0.5</span></div>
                                <div class="sector"><span>â‚¹0.7</span></div>
                                <div class="sector"><span>â‚¹5</span></div>
                                <div class="sector"><span>â‚¹0.1</span></div>
                            </div>
                            <div class="wheel-center">ğŸ</div>
                        </div>
                    </div>

                    <button class="spin-btn" id="spinBtn" onclick="handleSpin()">
                        ğŸ² ç«‹å³æŠ½å¥– ğŸ²
                    </button>
                    
                    <div class="spin-status" id="spinStatus">
                        å®Œæˆä»˜è´¹æ¸¸ç©å³å¯æŠ½å¥–ï¼
                    </div>

                    <!-- èƒ½é‡æ¡ -->
                    <div class="energy-container">
                        <div class="energy-header">
                            <div class="energy-title">ğŸ’° æç°è¿›åº¦</div>
                            <div class="energy-value" id="energyValue">0 / 100 U</div>
                        </div>
                        <div class="energy-bar-wrapper">
                            <div class="energy-bar" id="energyBar" style="width: 0%;">
                                <div class="energy-shine"></div>
                            </div>
                        </div>
                        <div class="energy-tip" id="energyTip">
                            âœ¨ å®Œæˆä»»åŠ¡å’Œé‚€è¯·å¥½å‹ï¼Œç´¯è®¡æ»¡ 100U å³å¯æç°ï¼
                        </div>
                        <button class="task-btn" id="taskBtn" onclick="showTaskModal()">
                            ğŸ“‹ æŸ¥çœ‹ä»»åŠ¡
                        </button>
                    </div>
                </div>
            </div>

        <div class="game-content">
            <div class="header">
                <h1>ğŸ² å¬å”¤ç¥é¾™</h1>
                <p>é€‰æ‹©æ¸¸æˆæ¨¡å¼å¼€å§‹ä½ çš„å†’é™©</p>
            </div>

            <div class="modes-container">
                <!-- å…è´¹æ¨¡å¼ -->
                <div class="mode-card" onclick="playFreeMode()">
                    <div class="mode-badge free">å…è´¹ä½“éªŒ</div>
                    <div class="mode-icon">ğŸ®</div>
                    <div class="mode-title">å…è´¹æ¸¸ç©</div>
                    <div class="mode-price">FREE</div>
                    <ul class="mode-features">
                        <li>æ— é™æ¬¡æ¸¸ç©æœºä¼š</li>
                        <li>ä½“éªŒå®Œæ•´æ¸¸æˆå†…å®¹</li>
                        <li>ç»ƒä¹ æ¸¸æˆæŠ€å·§</li>
                        <li class="disabled-feature">ä¸èƒ½å‚ä¸æŠ½å¥–</li>
                        <li class="disabled-feature">æ— æ³•è·å¾—å¥–åŠ±</li>
                    </ul>
                    <button class="play-btn free-btn" onclick="event.stopPropagation(); playFreeMode();">ğŸ® å¼€å§‹å…è´¹æ¸¸ç©</button>
                </div>

                <!-- ä»˜è´¹æ¨¡å¼ -->
                <div class="mode-card" id="paidModeCard">
                    <div class="mode-badge">ä»˜è´¹æ¨¡å¼</div>
                    <div class="mode-icon">ğŸ’</div>
                    <div class="mode-title">ä»˜è´¹æ¸¸ç©</div>
                    <div class="mode-price">10 USDT</div>
                    <ul class="mode-features">
                        <li>å®Œæ•´æ¸¸æˆä½“éªŒ</li>
                        <li>é€šå…³åè·å¾—æŠ½å¥–æœºä¼š</li>
                        <li>æœ€é«˜å¯èµ¢ â‚¹8888 å¢æ¯”</li>
                        <li>å¤šæ¡£å¥–é‡‘ç­‰ä½ æ‹¿</li>
                        <li>å…¬å¹³å…¬æ­£ï¼ŒåŒºå—é“¾éªŒè¯</li>
                    </ul>
                    <button class="play-btn" id="paidPlayBtn" onclick="event.stopPropagation(); handlePaidMode();">ğŸ’° æ”¯ä»˜å¹¶æ¸¸ç©</button>
                    <div class="payment-notice" id="paymentNotice">
                        <p>âš ï¸ ä»˜è´¹æ¸¸ç©éœ€è¦æ”¯ä»˜ 10 USDT</p>
                        <p style="margin-top: 10px; font-size: 12px; opacity: 0.8;">ç‚¹å‡»æŒ‰é’®åå°†è·³è½¬åˆ°ç¬¬ä¸‰æ–¹æ”¯ä»˜é¡µé¢</p>
                    </div>
                </div>
            </div>

            <div class="info-box">
                <h3>ğŸ“‹ æ¸¸æˆè§„åˆ™</h3>
                <p>
                    <strong>å…è´¹æ¨¡å¼ï¼š</strong>å¯ä»¥æ— é™æ¬¡æ¸¸ç©ä½“éªŒæ¸¸æˆï¼Œä½†ä¸èƒ½å‚ä¸æŠ½å¥–ã€‚<br><br>
                    <strong>ä»˜è´¹æ¨¡å¼ï¼š</strong>æ”¯ä»˜ 10 USDT åï¼ŒæˆåŠŸé€šå…³å³å¯è·å¾—ä¸€æ¬¡æŠ½å¥–æœºä¼šï¼Œ
                    æœ‰æœºä¼šèµ¢å– â‚¹0.1 - â‚¹8888 ä¸ç­‰çš„å¥–åŠ±,è¿˜æœ‰ç¥ç§˜éšæœºé‡‘é¢ï¼Œå¿«æ¥è¯•è¯•æ‰‹æ°”ï¼
                </p>
            </div>
        </div>

    </div>

    <!-- æŠ½å¥–ç»“æœå¼¹çª— -->
    <div class="result-modal" id="resultModal">
        <div class="result-content">
            <h2>ğŸ‰ æ­å–œä¸­å¥–ï¼</h2>
            <div class="prize-amount" id="prizeAmount">88 USDT</div>
            <div class="result-message" id="prizeMessage">
                ä½ èµ¢å¾—äº†å¥–åŠ±ï¼<br>
                å®Œæˆä»»åŠ¡å³å¯æç°ï¼
            </div>
            <button class="close-modal-btn" onclick="closeResultModal()">å¤ªæ£’äº†ï¼</button>
        </div>
    </div>

    <!-- é‚€è¯·é“¾æ¥å¼¹çª— -->
    <div class="result-modal" id="inviteModal">
        <div class="result-content">
            <h2>ğŸ‘¥ é‚€è¯·å¥½å‹</h2>
            <p style="margin: 20px 0; font-size: 16px; opacity: 0.9;">
                åˆ†äº«ä½ çš„ä¸“å±é‚€è¯·é“¾æ¥ç»™å¥½å‹<br>
                å¥½å‹é€šè¿‡é“¾æ¥è¿›å…¥æ¸¸æˆï¼Œä½ å³å¯è·å¾—æŠ½å¥–æœºä¼šï¼
            </p>
            <div class="invite-link-container">
                <input type="text" id="inviteLink" readonly class="invite-link-input">
                <button class="copy-btn" onclick="copyInviteLink()">
                    ğŸ“‹ å¤åˆ¶
                </button>
            </div>
            <div class="invite-stats">
                <div class="stat-item">
                    <div class="stat-value" id="inviteCount">0</div>
                    <div class="stat-label">å·²é‚€è¯·</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="inviteReward">0</div>
                    <div class="stat-label">å¥–åŠ±æ¬¡æ•°</div>
                </div>
            </div>
            <button class="close-modal-btn" onclick="closeInviteModal()">å…³é—­</button>
        </div>
    </div>

    <!-- ä»»åŠ¡å¼¹çª— -->
    <div class="task-modal" id="taskModal">
        <div class="task-modal-content">
            <div class="task-modal-header">
                <h2>ğŸ“‹ å½“å‰ä»»åŠ¡</h2>
                <p>å®Œæˆä»»åŠ¡è·å¾—èƒ½é‡ï¼Œç´¯ç§¯ â‚¹100 å¢æ¯”å³å¯æç°</p>
            </div>

            <div class="task-info-box">
                <div class="task-info-item">
                    <span class="task-info-label">å½“å‰è¿›åº¦</span>
                    <span class="task-info-value" id="taskTotalProgress">â‚¹0 / â‚¹100</span>
                </div>
                <div class="task-info-item">
                    <span class="task-info-label">å·²å®Œæˆä»»åŠ¡</span>
                    <span class="task-info-value" id="taskCompletedCount">0</span>
                </div>
            </div>

            <div class="current-task-card" id="currentTaskCard">
                <div class="task-type-badge" id="taskTypeBadge">åˆå§‹ä»»åŠ¡</div>
                <div class="task-name" id="taskName">å®Œæˆé¦–æ¬¡æŠ½å¥–</div>
                <div class="task-description" id="taskDescription">
                    è¿›è¡Œä¸€æ¬¡ä»˜è´¹æ¸¸ç©å¹¶å®ŒæˆæŠ½å¥–ï¼Œå³å¯æ¿€æ´»åç»­ä»»åŠ¡ç³»ç»Ÿ
                </div>
                <div class="task-progress-bar">
                    <div class="task-progress-fill" id="taskProgressFill" style="width: 0%;"></div>
                </div>
                <div class="task-progress-text" id="taskProgressText">è¿›åº¦: 0 / 1</div>
                
                <div class="task-action-buttons" id="taskActionButtons">
                    <!-- åŠ¨æ€ç”ŸæˆæŒ‰é’® -->
                </div>
            </div>

            <div class="task-hint">
                ğŸ’¡ æç¤ºï¼šæ¯ä¸ªä»»åŠ¡éƒ½ä¼šå¢åŠ ä½ çš„èƒ½é‡å€¼ï¼ŒæŒç»­å®Œæˆä»»åŠ¡å³å¯è¾¾åˆ°æç°æ¡ä»¶
            </div>

            <button class="close-task-modal-btn" onclick="closeTaskModal()">å…³é—­</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        const isDevelopment = !tg.initData;
        const API_BASE = window.location.origin + '/api';
        let authToken = localStorage.getItem('authToken') || 'dev-token';
        let isSpinning = false;

        // ä»»åŠ¡ç³»ç»Ÿé…ç½® - åç«¯æ§åˆ¶ï¼Œå‰ç«¯åªæ˜¾ç¤ºå½“å‰ä»»åŠ¡
        const TASK_REWARDS = [
            88.00000,  // åˆå§‹æŠ½å¥–å¥–åŠ±
            5.00000,   // ä»»åŠ¡1
            4.00000,   // ä»»åŠ¡2
            2.00000,   // ä»»åŠ¡3
            0.70000,   // ä»»åŠ¡4 (å¿…é¡»ä»˜è´¹)
            0.20000,   // ä»»åŠ¡5
            0.07000,   // ä»»åŠ¡6
            0.00609,   // ä»»åŠ¡7
            0.00487,   // ä»»åŠ¡8
            0.00390,   // ä»»åŠ¡9
            0.00312,   // ä»»åŠ¡10
            0.00249,   // ä»»åŠ¡11
            0.00199,   // ä»»åŠ¡12
            0.00160,   // ä»»åŠ¡13
            0.00128,   // ä»»åŠ¡14
            0.00102,   // ä»»åŠ¡15
            0.00082,   // ä»»åŠ¡16
            0.00065,   // ä»»åŠ¡17
            0.00052,   // ä»»åŠ¡18
            0.00042,   // ä»»åŠ¡19
            0.00033,   // ä»»åŠ¡20
            0.00027,   // ä»»åŠ¡21
            0.00021,   // ä»»åŠ¡22
            0.00017,   // ä»»åŠ¡23
            0.00014,   // ä»»åŠ¡24
            0.00011    // ä»»åŠ¡25
        ];

        // ä»»åŠ¡ç±»å‹å®šä¹‰
        const TASK_TYPES = {
            INITIAL_SPIN: 'initial_spin',      // åˆå§‹æŠ½å¥–
            PAID_GAME: 'paid_game',            // å¿…é¡»ä»˜è´¹æ¸¸ç©
            INVITE_OR_GAME: 'invite_or_game'   // é‚€è¯·å¥½å‹æˆ–ä»˜è´¹æ¸¸ç©
        };

        // æŠ½å¥–åŠŸèƒ½
        async function handleSpin() {
            if (isSpinning) return;

            const spinBtn = document.getElementById('spinBtn');
            const wheel = document.getElementById('wheel');
            const spinStatus = document.getElementById('spinStatus');

            try {
                isSpinning = true;
                spinBtn.disabled = true;
                spinStatus.textContent = 'æ£€æŸ¥æŠ½å¥–èµ„æ ¼...';

                // ç™»å½•
                if (!authToken || authToken === 'dev-token') {
                    await login();
                }

                // æ£€æŸ¥æœªä½¿ç”¨çš„æ”¯ä»˜
                const paymentResponse = await fetch(`${API_BASE}/payment/unused`, {
                    headers: { 'Authorization': `Bearer ${authToken}` },
                });
                const paymentData = await paymentResponse.json();

                if (!paymentData.success || !paymentData.data) {
                    spinStatus.textContent = 'è¯·å…ˆå®Œæˆä»˜è´¹æ¸¸ç©ï¼';
                    alert('ä½ éœ€è¦å…ˆè¿›è¡Œä»˜è´¹æ¸¸ç©æ‰èƒ½æŠ½å¥–ï¼');
                    isSpinning = false;
                    spinBtn.disabled = false;
                    return;
                }

                const paymentId = paymentData.data.id;
                const idempotencyKey = Date.now() + '_' + Math.random();

                spinStatus.textContent = 'ğŸ° è½¬ç›˜æ—‹è½¬ä¸­...';

                // è°ƒç”¨æŠ½å¥–API
                const spinResponse = await fetch(`${API_BASE}/spin`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ paymentId, idempotencyKey }),
                });

                const spinData = await spinResponse.json();

                if (!spinData.success) {
                    throw new Error(spinData.error || 'æŠ½å¥–å¤±è´¥');
                }

                const result = spinData.data;

                // åŠ¨ç”»è½¬ç›˜
                const targetDegree = result.displaySectorIndex * 45;
                const spinDegrees = 360 * 5 + targetDegree;
                wheel.style.transform = `rotate(${spinDegrees}deg)`;

                // æ˜¾ç¤ºç»“æœ
                setTimeout(() => {
                    spinStatus.textContent = `ğŸ‰ æ­å–œè·å¾— ${result.award} USDTï¼`;
                    
                    // æ˜¾ç¤ºå¼¹çª—
                    showResultModal(result.award, result.message);
                    
                    isSpinning = false;
                    spinBtn.disabled = false;
                    
                    // æ›´æ–°èƒ½é‡æ¡
                    checkTaskProgress();
                }, 4000);

            } catch (error) {
                console.error('æŠ½å¥–é”™è¯¯:', error);
                spinStatus.textContent = 'æŠ½å¥–å¤±è´¥ï¼Œè¯·é‡è¯•';
                alert('é”™è¯¯: ' + error.message);
                isSpinning = false;
                spinBtn.disabled = false;
            }
        }

        // ç™»å½•
        async function login() {
            try {
                console.log('=== ç™»å½•è°ƒè¯• ===');
                console.log('isDevelopment:', isDevelopment);
                
                if (isDevelopment) {
                    console.log('âš ï¸ å¼€å‘æ¨¡å¼ï¼šæ— æ³•ç™»å½•ï¼ˆä¸åœ¨ Telegram ç¯å¢ƒï¼‰');
                    authToken = 'dev-token';
                    return;
                }

                console.log('è·å– Telegram initData...');
                const initData = tg.initData;
                
                if (!initData) {
                    console.error('âŒ æ²¡æœ‰ initData');
                    throw new Error('æ— æ³•è·å– Telegram æ•°æ®ï¼Œè¯·ç¡®ä¿åœ¨ Telegram å†…æ‰“å¼€åº”ç”¨');
                }
                
                console.log('initData é•¿åº¦:', initData.length);
                console.log('å‘é€ç™»å½•è¯·æ±‚åˆ°:', `${API_BASE}/auth/login`);
                
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ initData }),
                });
                
                console.log('ç™»å½•å“åº”çŠ¶æ€:', response.status);
                
                if (!response.ok) {
                    console.error('âŒ ç™»å½•è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç :', response.status);
                    throw new Error(`ç™»å½•è¯·æ±‚å¤±è´¥ (${response.status})`);
                }
                
                const data = await response.json();
                console.log('ç™»å½•å“åº”æ•°æ®:', data);
                
                if (data.success && data.data && data.data.token) {
                    authToken = data.data.token;
                    localStorage.setItem('authToken', authToken);
                    console.log('âœ… ç™»å½•æˆåŠŸï¼Œtokenå·²ä¿å­˜');
                } else {
                    console.error('âŒ ç™»å½•å¤±è´¥:', data.error || data.message);
                    throw new Error(data.error || data.message || 'ç™»å½•å¤±è´¥ï¼Œæœªè¿”å›æœ‰æ•ˆtoken');
                }
            } catch (error) {
                console.error('âŒ ç™»å½•é”™è¯¯:', error);
                // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„æ— æ•ˆtoken
                authToken = null;
                localStorage.removeItem('authToken');
                throw error;
            }
        }

        // æ£€æŸ¥ä»»åŠ¡è¿›åº¦å¹¶æ›´æ–°èƒ½é‡æ¡
        async function checkTaskProgress() {
            try {
                if (!authToken || authToken === 'dev-token') {
                    await login();
                }

                // è·å–ç”¨æˆ·ä½™é¢
                const balanceResponse = await fetch(`${API_BASE}/user/balance`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (balanceResponse.ok) {
                    const balanceData = await balanceResponse.json();
                    if (balanceData.success) {
                        updateEnergyBar(balanceData.data.balance || 0);
                    }
                }
            } catch (error) {
                console.error('æ£€æŸ¥ä»»åŠ¡è¿›åº¦é”™è¯¯:', error);
            }
        }

        // æ›´æ–°èƒ½é‡æ¡æ˜¾ç¤º
        function updateEnergyBar(balance) {
            const energyBar = document.getElementById('energyBar');
            const energyValue = document.getElementById('energyValue');
            const energyTip = document.getElementById('energyTip');
            const taskBtn = document.getElementById('taskBtn');
            
            const percentage = Math.min((balance / 100) * 100, 100);
            
            energyBar.style.width = percentage + '%';
            energyValue.textContent = `â‚¹${balance.toFixed(2)} / â‚¹100`;
            
            // æ ¹æ®ä½™é¢æ˜¾ç¤ºä¸åŒæç¤º
            if (balance >= 100) {
                energyBar.style.background = 'linear-gradient(90deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%)';
                energyBar.style.boxShadow = '0 0 30px rgba(255, 215, 0, 0.8)';
                energyTip.innerHTML = 'ğŸ‰ æ­å–œï¼å·²è¾¾åˆ°æç°æ¡ä»¶ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æäº¤æç°ç”³è¯·';
                taskBtn.textContent = 'ğŸ’µ ç”³è¯·æç°';
                taskBtn.onclick = showWithdrawModal;
            } else if (balance > 0) {
                const remaining = (100 - balance).toFixed(2);
                energyTip.innerHTML = `ğŸ’ª å†è·å¾— â‚¹${remaining} å³å¯æç°ï¼ç»§ç»­å®Œæˆä»»åŠ¡å’Œé‚€è¯·å¥½å‹å§`;
            } else {
                energyTip.innerHTML = 'âœ¨ å®Œæˆä»˜è´¹æ¸¸ç©æŠ½å¥–è·å¾— â‚¹88 å¢æ¯”ï¼Œå®Œæˆä»»åŠ¡è·å–æ›´å¤šå¥–åŠ±ï¼';
            }
        }

        // æ˜¾ç¤ºæç°å¼¹çª—
        function showWithdrawModal() {
            alert('æç°åŠŸèƒ½å³å°†å¼€æ”¾ï¼\n\nè¯·å‡†å¤‡å¥½ä»¥ä¸‹ä¿¡æ¯ï¼š\n- é“¶è¡Œå¡å·\n- è”ç³»ç”µè¯\n\næˆ‘ä»¬ä¼šåœ¨å®¡æ ¸å24å°æ—¶å†…å®Œæˆè½¬è´¦ã€‚');
        }

        // æ˜¾ç¤ºä»»åŠ¡å¼¹çª—
        async function showTaskModal() {
            const modal = document.getElementById('taskModal');
            if (modal) {
                modal.classList.add('show');
                // åŠ è½½å½“å‰ä»»åŠ¡
                await loadCurrentTask();
            }
        }

        // å…³é—­ä»»åŠ¡å¼¹çª—
        function closeTaskModal() {
            const modal = document.getElementById('taskModal');
            modal.classList.remove('show');
        }

        // åŠ è½½å½“å‰ä»»åŠ¡
        async function loadCurrentTask() {
            try {
                if (!authToken || authToken === 'dev-token') {
                    await login();
                }

                // è·å–ç”¨æˆ·ä»»åŠ¡è¿›åº¦
                const response = await fetch(`${API_BASE}/task/current`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        updateTaskUI(data.data);
                    }
                } else {
                    // å¦‚æœAPIä¸å­˜åœ¨ï¼Œæ˜¾ç¤ºé»˜è®¤ä»»åŠ¡
                    updateTaskUI({
                        task_index: 0,
                        task_type: TASK_TYPES.INITIAL_SPIN,
                        progress: 0,
                        required: 1,
                        total_progress: 0,
                        completed_tasks: 0
                    });
                }
            } catch (error) {
                console.error('åŠ è½½ä»»åŠ¡é”™è¯¯:', error);
                // æ˜¾ç¤ºé»˜è®¤ä»»åŠ¡
                updateTaskUI({
                    task_index: 0,
                    task_type: TASK_TYPES.INITIAL_SPIN,
                    progress: 0,
                    required: 1,
                    total_progress: 0,
                    completed_tasks: 0
                });
            }
        }

        // æ›´æ–°ä»»åŠ¡UI
        function updateTaskUI(taskData) {
            const taskTypeBadge = document.getElementById('taskTypeBadge');
            const taskName = document.getElementById('taskName');
            const taskDescription = document.getElementById('taskDescription');
            const taskProgressFill = document.getElementById('taskProgressFill');
            const taskProgressText = document.getElementById('taskProgressText');
            const taskActionButtons = document.getElementById('taskActionButtons');
            const taskTotalProgress = document.getElementById('taskTotalProgress');
            const taskCompletedCount = document.getElementById('taskCompletedCount');

            const { task_index, task_type, progress, required, total_progress, completed_tasks } = taskData;

            // æ›´æ–°æ€»è¿›åº¦
            taskTotalProgress.textContent = `${total_progress.toFixed(2)} / 100 U`;
            taskCompletedCount.textContent = completed_tasks;

            // æ›´æ–°è¿›åº¦æ¡
            const progressPercent = (progress / required) * 100;
            taskProgressFill.style.width = progressPercent + '%';
            taskProgressText.textContent = `è¿›åº¦: ${progress} / ${required}`;

            // æ ¹æ®ä»»åŠ¡ç±»å‹æ˜¾ç¤ºä¸åŒå†…å®¹
            if (task_type === TASK_TYPES.INITIAL_SPIN) {
                // åˆå§‹æŠ½å¥–ä»»åŠ¡
                taskTypeBadge.className = 'task-type-badge initial';
                taskTypeBadge.textContent = 'ğŸ° åˆå§‹ä»»åŠ¡';
                taskName.textContent = 'å®Œæˆé¦–æ¬¡æŠ½å¥–';
                taskDescription.innerHTML = 'è¿›è¡Œä¸€æ¬¡ä»˜è´¹æ¸¸ç©å¹¶å®ŒæˆæŠ½å¥–<br>å®Œæˆåå³å¯è§£é”åç»­ä»»åŠ¡ç³»ç»Ÿ';
                
                taskActionButtons.innerHTML = `
                    <button class="task-action-btn primary" onclick="closeTaskModal(); scrollToSpin();">
                        ğŸ² å»æŠ½å¥–
                    </button>
                `;
            } else if (task_type === TASK_TYPES.PAID_GAME) {
                // å¿…é¡»ä»˜è´¹æ¸¸ç©ä»»åŠ¡
                taskTypeBadge.className = 'task-type-badge';
                taskTypeBadge.textContent = 'ğŸ’ å¿…åšä»»åŠ¡';
                taskName.textContent = 'ä»˜è´¹æ¸¸ç©';
                taskDescription.innerHTML = 'å®Œæˆä¸€æ¬¡ä»˜è´¹æ¸¸ç©<br>æ­¤ä»»åŠ¡å¿…é¡»å®Œæˆæ‰èƒ½ç»§ç»­';
                
                taskActionButtons.innerHTML = `
                    <button class="task-action-btn primary" onclick="closeTaskModal(); scrollToGameModes();">
                        ğŸ’° å»æ¸¸ç©
                    </button>
                `;
            } else if (task_type === TASK_TYPES.INVITE_OR_GAME) {
                // é‚€è¯·æˆ–ä»˜è´¹ä»»åŠ¡
                taskTypeBadge.className = 'task-type-badge optional';
                taskTypeBadge.textContent = 'âœ¨ å¯é€‰ä»»åŠ¡';
                taskName.textContent = 'é‚€è¯·å¥½å‹æˆ–ä»˜è´¹æ¸¸ç©';
                taskDescription.innerHTML = 'é€‰æ‹©ä»¥ä¸‹ä»»æ„ä¸€ç§æ–¹å¼å®Œæˆä»»åŠ¡ï¼š<br>â€¢ é‚€è¯·1ä½æ–°å¥½å‹<br>â€¢ å®Œæˆä¸€æ¬¡ä»˜è´¹æ¸¸ç©';
                
                taskActionButtons.innerHTML = `
                    <button class="task-action-btn" onclick="closeTaskModal(); showInviteLink();">
                        ğŸ‘¥ é‚€è¯·å¥½å‹
                    </button>
                    <button class="task-action-btn" onclick="closeTaskModal(); scrollToGameModes();">
                        ğŸ’ ä»˜è´¹æ¸¸ç©
                    </button>
                `;
            }
        }

        // æ»šåŠ¨åˆ°æŠ½å¥–åŒºåŸŸ
        function scrollToSpin() {
            const spinSection = document.querySelector('.spin-hero');
            if (spinSection) {
                spinSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // æ»šåŠ¨åˆ°æ¸¸æˆæ¨¡å¼åŒºåŸŸ
        function scrollToGameModes() {
            const modesSection = document.querySelector('.modes-container');
            if (modesSection) {
                modesSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // æ˜¾ç¤ºç»“æœå¼¹çª—
        function showResultModal(amount, message) {
            const modal = document.getElementById('resultModal');
            const prizeAmount = document.getElementById('prizeAmount');
            const prizeMessage = document.getElementById('prizeMessage');
            
            prizeAmount.textContent = amount + ' USDT';
            prizeMessage.innerHTML = message + '<br>å®Œæˆä»»åŠ¡å³å¯æç°ï¼';
            modal.classList.add('show');
        }

        // å…³é—­ç»“æœå¼¹çª—
        function closeResultModal() {
            const modal = document.getElementById('resultModal');
            modal.classList.remove('show');
        }

        // æ˜¾ç¤ºé‚€è¯·é“¾æ¥
        async function showInviteLink() {
            console.log('ğŸ”” showInviteLink() å‡½æ•°è¢«è°ƒç”¨');
            
            const modal = document.getElementById('inviteModal');
            const inviteLinkInput = document.getElementById('inviteLink');
            const inviteCountEl = document.getElementById('inviteCount');
            const inviteRewardEl = document.getElementById('inviteReward');

            try {
                console.log('=== é‚€è¯·åŠŸèƒ½è°ƒè¯• ===');
                console.log('isDevelopment:', isDevelopment);
                console.log('tg.initData:', tg.initData ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨');
                console.log('authToken:', authToken);
                console.log('Modal element:', modal ? 'æ‰¾åˆ°' : 'æœªæ‰¾åˆ°');

                // æ£€æŸ¥æ˜¯å¦åœ¨ Telegram ç¯å¢ƒä¸­
                if (isDevelopment) {
                    alert('âš ï¸ è¯·åœ¨ Telegram å†…æ‰“å¼€åº”ç”¨\n\nå½“å‰åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼Œæ— æ³•ä½¿ç”¨é‚€è¯·åŠŸèƒ½ã€‚\n\næ­£ç¡®æ­¥éª¤ï¼š\n1. æ‰“å¼€ Telegram åº”ç”¨\n2. æœç´¢ @summondargon_bot\n3. ç‚¹å‡»èœå•æŒ‰é’®\n4. åœ¨ Telegram å†…æ‰“å¼€åº”ç”¨');
                    return;
                }

                // æ˜¾ç¤ºåŠ è½½æç¤º
                tg.showPopup({
                    title: 'åŠ è½½ä¸­',
                    message: 'æ­£åœ¨è·å–é‚€è¯·ä¿¡æ¯...',
                    buttons: []
                });

                // å°è¯•ç™»å½•ï¼ˆå¦‚æœè¿˜æ²¡æœ‰æœ‰æ•ˆçš„ tokenï¼‰
                if (!authToken || authToken === 'dev-token') {
                    console.log('éœ€è¦ç™»å½•ï¼Œå¼€å§‹ç™»å½•æµç¨‹...');
                    try {
                        await login();
                        console.log('ç™»å½•å®Œæˆï¼Œtoken:', authToken ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®');
                    } catch (loginError) {
                        console.error('ç™»å½•å¤±è´¥:', loginError);
                        tg.close();
                        tg.showAlert('ç™»å½•å¤±è´¥ï¼Œè¯·é‡æ–°æ‰“å¼€åº”ç”¨å†è¯•');
                        return;
                    }
                }

                console.log('å¼€å§‹è·å–é‚€è¯·ä¿¡æ¯...');
                
                // è·å–é‚€è¯·ä¿¡æ¯
                const response = await fetch(`${API_BASE}/invite/info`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                console.log('APIå“åº”çŠ¶æ€:', response.status);
                
                // å…³é—­åŠ è½½æç¤º
                tg.close();
                
                if (!response.ok) {
                    if (response.status === 401) {
                        // æ¸…é™¤æ— æ•ˆçš„ tokenï¼Œå°è¯•é‡æ–°ç™»å½•
                        console.log('Tokenæ— æ•ˆï¼Œæ¸…é™¤å¹¶é‡æ–°ç™»å½•...');
                        authToken = null;
                        localStorage.removeItem('authToken');
                        
                        try {
                            await login();
                            // é‡æ–°å°è¯•è·å–é‚€è¯·ä¿¡æ¯
                            return await showInviteLink();
                        } catch (retryError) {
                            console.error('é‡æ–°ç™»å½•å¤±è´¥:', retryError);
                            tg.showAlert('èº«ä»½éªŒè¯å¤±è´¥ï¼Œè¯·å…³é—­åº”ç”¨åé‡æ–°æ‰“å¼€å†è¯•');
                            return;
                        }
                    }
                    throw new Error(`æœåŠ¡å™¨é”™è¯¯: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('APIå“åº”æ•°æ®:', data);
                
                if (data.success) {
                    const inviteCode = data.data.invite_code;
                    const botUsername = data.data.bot_username || 'summondargon_bot';
                    const inviteLink = `https://t.me/${botUsername}?start=${inviteCode}`;
                    
                    inviteLinkInput.value = inviteLink;
                    inviteCountEl.textContent = data.data.total_invites || 0;
                    inviteRewardEl.textContent = data.data.invite_rewards || 0;
                    
                    modal.classList.add('show');
                    console.log('âœ… é‚€è¯·å¼¹çª—å·²æ˜¾ç¤º');
                } else {
                    throw new Error(data.error || 'è·å–é‚€è¯·ä¿¡æ¯å¤±è´¥');
                }
            } catch (error) {
                console.error('âŒ é‚€è¯·é“¾æ¥é”™è¯¯:', error);
                tg.showAlert('è·å–é‚€è¯·é“¾æ¥å¤±è´¥ï¼Œè¯·ç¨åå†è¯•\n\né”™è¯¯: ' + error.message);
            }
        }

        // å¤åˆ¶é‚€è¯·é“¾æ¥
        async function copyInviteLink() {
            const inviteLinkInput = document.getElementById('inviteLink');
            const copyBtn = event.currentTarget;
            
            try {
                // å°è¯•ä½¿ç”¨ç°ä»£API
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    await navigator.clipboard.writeText(inviteLinkInput.value);
                } else {
                    // é™çº§æ–¹æ¡ˆ
                    inviteLinkInput.select();
                    document.execCommand('copy');
                }
                
                // è§†è§‰åé¦ˆ
                copyBtn.classList.add('copied');
                copyBtn.textContent = 'âœ… å·²å¤åˆ¶';
                
                // Telegramåˆ†äº«
                if (tg.openTelegramLink) {
                    const shareText = encodeURIComponent('ğŸ² ä¸€èµ·æ¥ç©å¬å”¤ç¥é¾™æ¸¸æˆï¼Œèµ¢å–å¤§å¥–ï¼');
                    tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(inviteLinkInput.value)}&text=${shareText}`);
                }
                
                setTimeout(() => {
                    copyBtn.classList.remove('copied');
                    copyBtn.textContent = 'ğŸ“‹ å¤åˆ¶';
                }, 2000);
                
            } catch (error) {
                console.error('å¤åˆ¶å¤±è´¥:', error);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥');
            }
        }

        // å…³é—­é‚€è¯·å¼¹çª—
        function closeInviteModal() {
            const modal = document.getElementById('inviteModal');
            modal.classList.remove('show');
        }

        // æ£€æŸ¥æ˜¯å¦é€šè¿‡é‚€è¯·é“¾æ¥è¿›å…¥
        async function checkInviteCode() {
            try {
                // ä»URLè·å–é‚€è¯·ç ï¼ˆTelegram startå‚æ•°ï¼‰
                const urlParams = new URLSearchParams(window.location.search);
                const startParam = urlParams.get('tgWebAppStartParam') || 
                                  (tg.initDataUnsafe?.start_parameter);
                
                if (startParam) {
                    // ç™»å½•
                    if (!authToken || authToken === 'dev-token') {
                        await login();
                    }

                    // æäº¤é‚€è¯·ç 
                    const response = await fetch(`${API_BASE}/invite/accept`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ inviteCode: startParam })
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        // æ˜¾ç¤ºé‚€è¯·æˆåŠŸæç¤º
                        if (data.data.is_first_invite) {
                            setTimeout(() => {
                                alert('ğŸ‰ æ¬¢è¿ï¼ä½ çš„é‚€è¯·äººè·å¾—äº†ä¸€æ¬¡æŠ½å¥–æœºä¼šï¼');
                            }, 1000);
                        }
                    }
                }
            } catch (error) {
                console.error('å¤„ç†é‚€è¯·ç é”™è¯¯:', error);
            }
        }

        // å…è´¹æ¨¡å¼
        function playFreeMode() {
            localStorage.setItem('gameMode', 'free');
            localStorage.removeItem('gameCompleted');
            window.location.href = '/game/index.html';
        }

        // å¤„ç†ä»˜è´¹æ¨¡å¼
        function handlePaidMode() {
            // è¿™é‡Œå°†è°ƒç”¨ç¬¬ä¸‰æ–¹æ”¯ä»˜API
            if (tg.showAlert) {
                tg.showAlert('å³å°†è·³è½¬åˆ°ç¬¬ä¸‰æ–¹æ”¯ä»˜é¡µé¢ï¼Œæ”¯ä»˜å®Œæˆåè¿”å›å³å¯å¼€å§‹æ¸¸æˆ');
            } else {
                alert('å³å°†è·³è½¬åˆ°ç¬¬ä¸‰æ–¹æ”¯ä»˜é¡µé¢ï¼Œæ”¯ä»˜å®Œæˆåè¿”å›å³å¯å¼€å§‹æ¸¸æˆ');
            }

            // TODO: é›†æˆç¬¬ä¸‰æ–¹æ”¯ä»˜API
            // ç¤ºä¾‹ï¼šwindow.open('https://payment-provider.com/pay?amount=10&callback=' + encodeURIComponent(window.location.origin));
            
            // æ”¯ä»˜æˆåŠŸåçš„å›è°ƒå¤„ç†
            // å½“ä»æ”¯ä»˜é¡µé¢è¿”å›æ—¶ï¼Œåº”è¯¥æ£€æŸ¥æ”¯ä»˜çŠ¶æ€
            // å¦‚æœæ”¯ä»˜æˆåŠŸï¼Œè®¾ç½®æ¸¸æˆæ¨¡å¼å¹¶è·³è½¬
            // localStorage.setItem('gameMode', 'paid');
            // localStorage.removeItem('gameCompleted');
            // window.location.href = '/game/index.html';
        }

        // ç›‘å¬æ¥è‡ªiframeçš„æ¶ˆæ¯
        window.addEventListener('message', function(event) {
            if (event.data && event.data.action === 'switchPage') {
                switchPage(event.data.page);
            }
        });

        // åˆå§‹åŒ–
        async function init() {
            console.log('=== åº”ç”¨åˆå§‹åŒ– ===');
            console.log('isDevelopment:', isDevelopment);
            console.log('tg.initDataå­˜åœ¨:', !!tg.initData);
            
            if (isDevelopment) {
                console.log('âš ï¸ Development mode - åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€');
            } else {
                console.log('âœ… Telegram ç¯å¢ƒ');
                
                // å°è¯•è‡ªåŠ¨ç™»å½•
                try {
                    console.log('å¼€å§‹è‡ªåŠ¨ç™»å½•...');
                    await login();
                    console.log('âœ… è‡ªåŠ¨ç™»å½•æˆåŠŸ');
                } catch (error) {
                    console.error('âŒ è‡ªåŠ¨ç™»å½•å¤±è´¥:', error);
                    // ç™»å½•å¤±è´¥ä¸é˜»æ­¢é¡µé¢åŠ è½½ï¼Œç”¨æˆ·æ“ä½œæ—¶ä¼šé‡è¯•
                }
            }
            
            // æ£€æŸ¥é‚€è¯·ç 
            await checkInviteCode();
            
            // åŠ è½½èƒ½é‡æ¡æ•°æ®
            await checkTaskProgress();
            
            console.log('=== åˆå§‹åŒ–å®Œæˆ ===');
        }

        init();
    </script>
</body>

</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Âè¨Âî§Á•ûÈæô - Dragon Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: url('/images/picture1.png') no-repeat center center;
            background-size: cover;
            background-attachment: fixed;
            color: #ffffff;
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Âç∞Â∫¶È£éÊ†ºË£ÖÈ•∞ËÉåÊôØ - Â¢ûÂº∫Áâà */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 153, 51, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(19, 136, 8, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255, 215, 0, 0.08) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* Â§ö‰∏™ÊºÇÊµÆË£ÖÈ•∞ÂÖÉÁ¥† */
        .floating-elements {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        
        .floating-elements::before {
            content: 'ü™∑';
            position: absolute;
            font-size: 40px;
            animation: floatFlower1 25s infinite linear;
            opacity: 0.4;
        }
        
        .floating-elements::after {
            content: 'ü¶ö';
            position: absolute;
            font-size: 45px;
            animation: floatFlower2 30s infinite linear;
            opacity: 0.35;
        }
        
        @keyframes floatFlower1 {
            0% { top: -60px; left: 5%; transform: rotate(0deg); }
            50% { left: 85%; transform: rotate(180deg); }
            100% { top: 110vh; left: 15%; transform: rotate(360deg); }
        }
        
        @keyframes floatFlower2 {
            0% { top: -70px; right: 10%; transform: rotate(0deg) scaleX(-1); }
            50% { right: 80%; transform: rotate(180deg) scaleX(-1); }
            100% { top: 110vh; right: 20%; transform: rotate(360deg) scaleX(-1); }
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 0;
            padding-bottom: 80px; /* ‰∏∫Â∫ïÈÉ®ÂØºËà™ÁïôÁ©∫Èó¥ */
            position: relative;
            z-index: 2;
            width: 100%;
            min-height: 100vh;
        }
        
        /* È°µÈù¢ÂÆπÂô® */
        .page {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Â∫ïÈÉ®ÂØºËà™Ê†è */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.98) 100%);
            backdrop-filter: blur(10px);
            border-top: 2px solid rgba(255, 153, 51, 0.5);
            display: flex;
            justify-content: space-around;
            padding: 8px 0 max(8px, env(safe-area-inset-bottom));
            z-index: 1000;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            background: none;
            font-size: 12px;
            text-decoration: none;
        }
        
        .nav-item.active {
            color: #FF9933;
        }
        
        .nav-item .nav-icon {
            font-size: 24px;
            transition: transform 0.3s ease;
        }
        
        .nav-item.active .nav-icon {
            transform: scale(1.2);
            filter: drop-shadow(0 0 8px rgba(255, 153, 51, 0.8));
        }
        
        @media (max-width: 768px) {
            .container {
                padding-bottom: 75px;
            }
        }

        /* Âç∞Â∫¶È£éÊ†ºÈ°∂ÈÉ®ÊäΩÂ•ñÂå∫Âüü */
        .spin-hero {
            background: linear-gradient(135deg, #FF9933 0%, #FF6B35 50%, #F7931E 100%);
            padding: clamp(20px, 5vw, 35px) clamp(15px, 4vw, 25px);
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(255, 153, 51, 0.6),
                        0 0 100px rgba(255, 107, 53, 0.3);
            border-bottom: clamp(3px, 0.8vw, 6px) solid #138808;
        }
        
        @media (max-width: 480px) {
            .spin-hero {
                padding: 18px 12px;
            }
        }
        
        /* ÊõºÈôÄÁΩóÂõæÊ°àË£ÖÈ•∞ */
        .spin-hero::after {
            content: '';
            position: absolute;
            top: -100px;
            right: -100px;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, transparent 30%, rgba(255, 255, 255, 0.1) 30%, transparent 31%),
                        radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.05) 0%, transparent 70%);
            border-radius: 50%;
            animation: rotateMandala 30s infinite linear;
            pointer-events: none;
        }
        
        @keyframes rotateMandala {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .spin-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255, 255, 255, 0.03) 10px,
                rgba(255, 255, 255, 0.03) 20px
            );
            animation: slideBackground 20s linear infinite;
        }

        @keyframes slideBackground {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50%, 50%); }
        }

        .spin-hero-content {
            position: relative;
            z-index: 1;
        }

        .spin-title {
            text-align: center;
            font-size: clamp(24px, 6vw, 36px);
            font-weight: 900;
            margin-bottom: 15px;
            text-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.9),
                0 4px 8px rgba(0, 0, 0, 0.7),
                0 0 30px rgba(255, 153, 51, 1),
                0 0 60px rgba(255, 215, 0, 0.6);
            animation: pulse 2s ease-in-out infinite;
            color: #FFD700;
            background: linear-gradient(135deg, #FF9933 0%, #FFD700 50%, #FFFFFF 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 0 15px;
        }
        
        .spin-title::before,
        .spin-title::after {
            content: 'ü™î';
            font-size: clamp(20px, 5vw, 28px);
            animation: flickerFlame 1.5s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(255, 153, 51, 0.8));
        }
        
        @keyframes flickerFlame {
            0%, 100% { 
                opacity: 0.8; 
                transform: scale(1) translateY(0);
                filter: drop-shadow(0 0 10px rgba(255, 153, 51, 0.8));
            }
            50% { 
                opacity: 1; 
                transform: scale(1.15) translateY(-3px);
                filter: drop-shadow(0 0 20px rgba(255, 153, 51, 1));
            }
        }
        
        @media (max-width: 480px) {
            .spin-title {
                gap: 8px;
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .invite-tip {
            text-align: center;
            font-size: clamp(14px, 3.5vw, 17px);
            margin-bottom: clamp(15px, 4vw, 22px);
            padding: clamp(10px, 2.5vw, 14px) clamp(15px, 4vw, 22px);
            background: rgba(255, 153, 51, 0.25);
            border-radius: 25px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 215, 0, 0.5);
            animation: tipGlow 2s ease-in-out infinite;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: clamp(10px, 3vw, 15px);
            flex-wrap: wrap;
            line-height: 1.4;
            position: relative;
            z-index: 50;
            color: #FFFFFF;
            font-weight: 600;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.9), 0 1px 3px rgba(0, 0, 0, 1);
        }
        
        @media (max-width: 480px) {
            .invite-tip {
                font-size: 13px;
                padding: 10px 15px;
            }
        }

        @keyframes tipGlow {
            0%, 100% { 
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
                border-color: rgba(255, 255, 255, 0.3);
            }
            50% { 
                box-shadow: 0 4px 25px rgba(255, 215, 0, 0.4);
                border-color: rgba(255, 215, 0, 0.6);
            }
        }

        .invite-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: clamp(8px, 2vw, 12px) clamp(18px, 5vw, 28px);
            border-radius: 20px;
            font-size: clamp(13px, 3.5vw, 16px);
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 242, 254, 0.4);
            transition: all 0.3s ease;
            white-space: nowrap;
            position: relative;
            z-index: 100;
            pointer-events: auto;
        }

        .invite-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 242, 254, 0.5);
        }

        .invite-btn:active {
            transform: translateY(0);
        }

        .dev-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: clamp(8px, 2vw, 12px) clamp(18px, 5vw, 28px);
            border-radius: 20px;
            font-size: clamp(13px, 3.5vw, 16px);
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            white-space: nowrap;
            position: relative;
            z-index: 100;
            pointer-events: auto;
            margin-left: 10px;
        }

        .dev-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        /* ËΩ¨ÁõòÂÆπÂô® - ÊñπÂùóÊ†ºÂ≠êÊ†∑Âºè */
        .wheel-container {
            position: relative;
            width: 95vw;
            max-width: 500px;
            margin: 0 auto 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6), 0 0 30px rgba(255, 215, 0, 0.3);
        }
        
        @media (max-width: 768px) {
            .wheel-container {
                width: 92vw;
                padding: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .wheel-container {
                width: 95vw;
                padding: 12px;
            }
        }

        .wheel-glow {
            display: none;
        }

        /* ÊñπÂùóÊ†ºÂ≠êËÄÅËôéÊú∫Ê†∑Âºè */
        .wheel {
            width: 100%;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            padding: 10px;
        }
        
        .wheel-inner {
            display: contents;
        }

        /* ÊñπÂùóÊ†ºÂ≠ê */
        .sector {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-weight: 900;
            font-size: clamp(16px, 4vw, 24px);
            color: white;
            text-align: center;
            padding: 10px;
            transition: all 0.15s ease;
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.4),
                inset 0 2px 10px rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .sector::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), transparent);
            opacity: 0;
            transition: opacity 0.15s ease;
        }

        .sector:hover::before {
            opacity: 1;
        }

        .sector span {
            position: relative;
            z-index: 1;
            text-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.8),
                0 0 15px rgba(255, 255, 255, 0.3);
            font-size: clamp(15px, 3.8vw, 22px);
            font-weight: 900;
            line-height: 1.2;
        }

        /* Ê¥ªË∑ÉÈó™ÁÉÅÁä∂ÊÄÅ */
        .sector.active {
            transform: scale(1.15);
            box-shadow: 
                0 8px 30px rgba(255, 215, 0, 0.8),
                0 0 40px rgba(255, 215, 0, 0.6),
                inset 0 0 20px rgba(255, 255, 255, 0.4);
            z-index: 10;
            animation: slotPulse 0.15s ease;
        }

        @keyframes slotPulse {
            0%, 100% { transform: scale(1.15); }
            50% { transform: scale(1.2); }
        }

        /* Âç∞Â∫¶È£éÊ†ºÊñπÂùóÈÖçËâ≤ - È≤úËâ≥Êòé‰∫Æ */
        .sector:nth-child(1) {
            background: linear-gradient(135deg, #FF6347, #FF4500);
        }

        .sector:nth-child(2) {
            background: linear-gradient(135deg, #FFD700, #FFA500);
        }

        .sector:nth-child(3) {
            background: linear-gradient(135deg, #FF9933, #FF7F00);
        }

        .sector:nth-child(4) {
            background: linear-gradient(135deg, #32CD32, #228B22);
        }

        .sector:nth-child(5) {
            background: linear-gradient(135deg, #FF69B4, #FF1493);
        }

        .sector:nth-child(6) {
            background: linear-gradient(135deg, #FFD700, #FFEC8B);
        }

        .sector:nth-child(7) {
            background: linear-gradient(135deg, #00CED1, #20B2AA);
        }

        .sector:nth-child(8) {
            background: linear-gradient(135deg, #FF6B35, #F7931E);
        }

        .sector:nth-child(9) {
            background: linear-gradient(135deg, #9370DB, #8A2BE2);
        }

        .sector:nth-child(10) {
            background: linear-gradient(135deg, #FF4500, #DC143C);
        }

        .sector:nth-child(11) {
            background: linear-gradient(135deg, #FFD700, #FF8C00);
        }

        .sector:nth-child(12) {
            background: linear-gradient(135deg, #32CD32, #3CB371);
        }

        /* ÊµÖËâ≤ËÉåÊôØÁöÑÊ†ºÂ≠ê‰ΩøÁî®Ê∑±Ëâ≤ÊñáÂ≠ó */
        .sector:nth-child(2) span,
        .sector:nth-child(3) span,
        .sector:nth-child(6) span,
        .sector:nth-child(11) span {
            color: #1a1a1a;
            text-shadow: 
                0 2px 6px rgba(255, 255, 255, 0.8),
                0 0 10px rgba(255, 255, 255, 0.5);
        }

        /* RandomÊ†ºÂ≠êÁâπÊÆäÊ†∑Âºè - ÂΩ©ËôπÊ∏êÂèò */
        .sector:nth-child(11) {
            background: linear-gradient(135deg, 
                #ff0000 0%, 
                #ff7f00 14%, 
                #ffff00 28%, 
                #00ff00 42%, 
                #0000ff 56%, 
                #4b0082 70%, 
                #9400d3 84%, 
                #ff0000 100%);
            background-size: 200% 200%;
            animation: rainbowShift 3s ease infinite;
        }

        @keyframes rainbowShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .wheel-center {
            display: none;
        }

        /* ÊåáÈíàÊ†∑ÂºèË∞ÉÊï¥‰∏∫‰∏çÊòæÁ§∫ */
        .pointer {
            display: none;
        }

        .spin-btn {
            display: block;
            width: 88%;
            max-width: 360px;
            margin: 0 auto clamp(15px, 4vw, 25px);
            padding: clamp(16px, 4.5vw, 24px) clamp(30px, 8vw, 50px);
            background: linear-gradient(135deg, #FF9933 0%, #FFD700 50%, #FF9933 100%);
            background-size: 200% 100%;
            border: clamp(3px, 0.8vw, 5px) solid #FFFFFF;
            border-radius: 50px;
            font-size: clamp(18px, 5vw, 26px);
            font-weight: 900;
            color: #FFFFFF;
            text-shadow: 
                0 3px 6px rgba(0, 0, 0, 0.4),
                0 0 15px rgba(255, 153, 51, 0.6);
            cursor: pointer;
            box-shadow: 
                0 10px 35px rgba(255, 153, 51, 0.7),
                0 0 50px rgba(255, 153, 51, 0.5),
                inset 0 3px 12px rgba(255, 255, 255, 0.4);
            transition: all 0.3s ease;
            animation: btnShine 3s ease-in-out infinite;
        }
        
        @media (max-width: 480px) {
            .spin-btn {
                width: 85%;
                padding: 16px 35px;
                font-size: 18px;
            }
        }

        @keyframes btnShine {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .spin-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.7);
        }

        .spin-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            animation: none;
        }

        .spin-status {
            text-align: center;
            font-size: 18px;
            margin-top: 15px;
            padding: 16px 20px;
            background: linear-gradient(135deg, rgba(255, 153, 51, 0.3), rgba(255, 215, 0, 0.2));
            border-radius: 20px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 215, 0, 0.5);
            color: #FFD700;
            font-weight: 800;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.9), 0 0 20px rgba(255, 153, 51, 0.6);
            box-shadow: 0 4px 15px rgba(255, 153, 51, 0.3);
        }

        .header {
            text-align: center;
            padding: 35px 20px 25px;
        }

        .game-content {
            padding: 0 20px;
        }

        .header h1 {
            font-size: 38px;
            margin-bottom: 12px;
            text-shadow: 0 3px 15px rgba(0, 0, 0, 0.4);
            font-weight: 900;
        }

        .header p {
            font-size: 18px;
            opacity: 0.95;
        }



        /* Ê∏∏ÊàèÊ®°ÂºèÂç°Áâá */
        .modes-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 25px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .mode-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
            cursor: pointer;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .mode-card:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .mode-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
        }

        .mode-badge.free {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .mode-icon {
            font-size: 55px;
            margin-bottom: 12px;
        }

        .mode-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 8px;
            text-align: center;
        }

        .mode-price {
            font-size: 30px;
            font-weight: bold;
            margin: 12px 0;
            color: #ffd700;
            text-shadow: 0 2px 10px rgba(255, 215, 0, 0.5);
        }

        .mode-features {
            list-style: none;
            margin: 15px 0;
            text-align: left;
            width: 100%;
        }

        .mode-features li {
            padding: 8px 0;
            padding-left: 28px;
            position: relative;
            font-size: 15px;
            color: #FFFFFF;
            font-weight: 600;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.9), 0 1px 3px rgba(0, 0, 0, 1);
            line-height: 1.6;
        }

        .mode-features li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #FFD700;
            font-weight: 900;
            font-size: 18px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        }

        .mode-features li.disabled-feature:before {
            content: "‚úó";
            color: #ef4444;
        }

        .play-btn {
            width: 100%;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
            color: white;
            padding: 14px 25px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .play-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 87, 108, 0.5);
        }

        .play-btn.free-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
        }
        
        .play-btn.free-btn:hover {
            box-shadow: 0 6px 20px rgba(79, 172, 254, 0.5);
        }

        .info-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            text-align: center;
        }

        .info-box h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .info-box p {
            font-size: 15px;
            color: #FFFFFF;
            font-weight: 600;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.9), 0 1px 3px rgba(0, 0, 0, 1);
            line-height: 1.8;
        }

        .payment-notice {
            background: linear-gradient(135deg, rgba(255, 153, 51, 0.3), rgba(255, 215, 0, 0.25));
            border: 2px solid rgba(255, 215, 0, 0.6);
            border-radius: 15px;
            padding: 18px;
            margin-top: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(255, 153, 51, 0.3);
        }

        .payment-notice p {
            margin: 8px 0;
            font-size: 15px;
            color: #FFFFFF;
            font-weight: 600;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.9), 0 1px 3px rgba(0, 0, 0, 1);
            line-height: 1.6;
        }



        /* ÊäΩÂ•ñÁªìÊûúÂºπÁ™ó */
        .result-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .result-modal.show {
            display: flex;
        }

        .result-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 30px;
            border-radius: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            color: #fff;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.5s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .result-content h2 {
            font-size: 36px;
            margin-bottom: 20px;
        }

        .prize-amount {
            font-size: 56px;
            font-weight: bold;
            color: #ffd700;
            margin: 20px 0;
            text-shadow: 0 5px 15px rgba(255, 215, 0, 0.5);
            animation: prizeGlow 1.5s ease-in-out infinite;
        }

        @keyframes prizeGlow {
            0%, 100% { text-shadow: 0 5px 15px rgba(255, 215, 0, 0.5); }
            50% { text-shadow: 0 5px 25px rgba(255, 215, 0, 0.9); }
        }

        .result-message {
            font-size: 18px;
            margin: 20px 0;
            opacity: 0.9;
        }

        .close-modal-btn {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
            transition: all 0.3s;
        }

        .close-modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.6);
        }

        /* ËÉΩÈáèÊù°Ê†∑Âºè */
        .energy-container {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-top: 25px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .energy-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .energy-title {
            font-size: 18px;
            font-weight: bold;
        }

        .energy-value {
            font-size: 20px;
            font-weight: 900;
            color: #ffd700;
            text-shadow: 0 2px 8px rgba(255, 215, 0, 0.5);
        }

        .energy-bar-wrapper {
            width: 100%;
            height: 40px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .energy-bar {
            height: 100%;
            background: linear-gradient(90deg, #4ade80 0%, #22c55e 50%, #16a34a 100%);
            border-radius: 20px;
            transition: width 0.8s ease;
            position: relative;
            box-shadow: 0 0 20px rgba(74, 222, 128, 0.6);
            animation: energyPulse 2s ease-in-out infinite;
        }

        @keyframes energyPulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(74, 222, 128, 0.6);
            }
            50% {
                box-shadow: 0 0 30px rgba(74, 222, 128, 0.9);
            }
        }

        .energy-shine {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% {
                left: -100%;
            }
            100% {
                left: 200%;
            }
        }

        .energy-tip {
            text-align: center;
            font-size: 15px;
            margin-top: 15px;
            padding: 12px;
            background: rgba(255, 215, 0, 0.15);
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .task-btn {
            width: 100%;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            box-shadow: 0 5px 20px rgba(139, 92, 246, 0.4);
            transition: all 0.3s ease;
        }

        .task-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.6);
        }

        /* ÈÇÄËØ∑ÈìæÊé•ÂÆπÂô® */
        .invite-link-container {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 15px;
        }

        .invite-link-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 12px 15px;
            border-radius: 10px;
            font-size: 14px;
            color: #333;
            font-family: monospace;
        }

        .copy-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 242, 254, 0.4);
        }

        .copy-btn.copied {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
        }

        /* ÈÇÄËØ∑ÁªüËÆ° */
        .invite-stats {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .stat-item {
            text-align: center;
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            min-width: 100px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.8;
        }

        /* ‰ªªÂä°ÂºπÁ™óÊ†∑Âºè */
        .task-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .task-modal.show {
            display: flex;
        }

        .task-modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 40px 30px;
            border-radius: 30px;
            max-width: 450px;
            width: 90%;
            color: #fff;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 215, 0, 0.3);
            animation: modalSlideIn 0.5s ease-out;
        }

        .task-modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .task-modal-header h2 {
            font-size: 32px;
            margin-bottom: 15px;
            text-shadow: 0 3px 10px rgba(255, 215, 0, 0.5);
        }

        .task-modal-header p {
            font-size: 15px;
            opacity: 0.85;
            line-height: 1.6;
        }

        .current-task-card {
            background: rgba(255, 215, 0, 0.1);
            border: 3px solid rgba(255, 215, 0, 0.5);
            border-radius: 20px;
            padding: 30px 25px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.2);
        }

        .task-type-badge {
            display: inline-block;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 6px 18px;
            border-radius: 15px;
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .task-type-badge.initial {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #333;
        }

        .task-type-badge.optional {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .task-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #ffd700;
        }

        .task-description {
            font-size: 16px;
            opacity: 0.9;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .task-progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .task-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ade80 0%, #22c55e 100%);
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(74, 222, 128, 0.6);
        }

        .task-progress-text {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 20px;
        }

        .task-action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .task-action-btn {
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .task-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        .task-action-btn.primary {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #333;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
        }

        .task-action-btn.primary:hover {
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.6);
        }

        .task-info-box {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .task-info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .task-info-item:last-child {
            border-bottom: none;
        }

        .task-info-label {
            font-size: 14px;
            opacity: 0.8;
        }

        .task-info-value {
            font-size: 16px;
            font-weight: bold;
            color: #ffd700;
        }

        .close-task-modal-btn {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
            padding: 15px 30px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .close-task-modal-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
            cursor: pointer;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn-primary, .btn-secondary {
            flex: 1;
            padding: 15px 30px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.6);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .task-hint {
            text-align: center;
            font-size: 13px;
            opacity: 0.7;
            margin-top: 15px;
            font-style: italic;
        }
        
        /* ÊéíË°åÊ¶úÊ†∑Âºè */
        .leaderboard-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 20px 15px;
            margin-top: 20px;
        }
        
        .leaderboard-item {
            background: linear-gradient(135deg, rgba(255, 153, 51, 0.1) 0%, rgba(19, 136, 8, 0.1) 100%);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid rgba(255, 153, 51, 0.3);
            transition: all 0.3s ease;
        }
        
        .leaderboard-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 153, 51, 0.3);
        }
        
        .leaderboard-rank {
            font-size: 24px;
            font-weight: 900;
            min-width: 40px;
            text-align: center;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .leaderboard-rank.top-1 {
            font-size: 32px;
        }
        
        .leaderboard-rank.top-1::before {
            content: 'ü•á ';
            -webkit-text-fill-color: initial;
        }
        
        .leaderboard-rank.top-2::before {
            content: 'ü•à ';
            -webkit-text-fill-color: initial;
        }
        
        .leaderboard-rank.top-3::before {
            content: 'ü•â ';
            -webkit-text-fill-color: initial;
        }
        
        .leaderboard-info {
            flex: 1;
        }
        
        .leaderboard-name {
            font-size: 16px;
            font-weight: bold;
            color: #FFFFFF;
            margin-bottom: 4px;
        }
        
        .leaderboard-detail {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .leaderboard-amount {
            font-size: 20px;
            font-weight: 900;
            color: #FFD700;
            text-align: right;
        }
        
        .leaderboard-status {
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 10px;
            margin-top: 4px;
            display: inline-block;
        }
        
        .leaderboard-status.pending {
            background: rgba(255, 193, 7, 0.2);
            color: #FFC107;
        }
        
        .leaderboard-status.completed {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }
        
        /* Âç∞Â∫¶Ë£ÖÈ•∞ÂÖÉÁ¥† - ÊéíÁÅØËäÇÁÅØÁ¨º */
        .diya-decoration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            pointer-events: none;
        }
        
        .diya {
            font-size: 28px;
            animation: diyaGlow 2s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(255, 153, 51, 0.8));
        }
        
        .diya:nth-child(2) { animation-delay: 0.3s; }
        .diya:nth-child(3) { animation-delay: 0.6s; }
        .diya:nth-child(4) { animation-delay: 0.9s; }
        .diya:nth-child(5) { animation-delay: 1.2s; }
        
        @keyframes diyaGlow {
            0%, 100% { 
                opacity: 0.7; 
                transform: translateY(0) scale(1);
                filter: drop-shadow(0 0 10px rgba(255, 153, 51, 0.6));
            }
            50% { 
                opacity: 1; 
                transform: translateY(-5px) scale(1.1);
                filter: drop-shadow(0 0 20px rgba(255, 153, 51, 1));
            }
        }

        @keyframes scrollText {
            0% { 
                transform: translateX(100%); 
            }
            100% { 
                transform: translateX(-100%); 
            }
        }
        /* Èü≥‰πêÊéßÂà∂ÊåâÈíÆ */
        .music-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid rgba(255, 215, 0, 0.5);
            backdrop-filter: blur(10px);
            cursor: pointer;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .music-toggle:hover {
            transform: scale(1.1);
            background: rgba(0, 0, 0, 0.85);
            border-color: rgba(255, 215, 0, 0.8);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }

        .music-toggle:active {
            transform: scale(0.95);
        }

        .music-icon {
            font-size: 24px;
            animation: pulse 2s ease-in-out infinite;
        }

        .music-toggle.playing .music-icon {
            animation: rotate 3s linear infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>

<body>
    <!-- ËÉåÊôØÈü≥‰πê -->
    <audio id="bgMusic" loop>
        <source src="/music/background.mp3" type="audio/mpeg">
    </audio>

    <!-- ÊäΩÂ•ñÈü≥Êïà -->
    <audio id="spinSound" preload="auto">
        <source src="/music/spin.mp3" type="audio/mpeg">
    </audio>
    <audio id="winSound" preload="auto">
        <source src="/music/win.mp3" type="audio/mpeg">
    </audio>

    <!-- ÊºÇÊµÆË£ÖÈ•∞ÂÖÉÁ¥†ÂÆπÂô® -->
    <div class="floating-elements"></div>
    
    <!-- ÊéíÁÅØËäÇÁÅØÁ¨ºË£ÖÈ•∞ -->
    <div class="diya-decoration">
        <span class="diya">ü™î</span>
        <span class="diya">ü™î</span>
        <span class="diya">ü™î</span>
        <span class="diya">ü™î</span>
        <span class="diya">ü™î</span>
    </div>
    
    <div class="container indian-border">
        
        <!-- È°µÈù¢1ÔºöÊ∏∏ÊàèÈ°µ -->
        <div class="page active" id="gamePage">
            <div class="game-content" style="padding-top: 30px;">
                <div class="header">
                    <h1>üê≤ Âè¨Âî§Á•ûÈæô</h1>
                    <p>ÈÄâÊã©Ê∏∏ÊàèÊ®°ÂºèÂºÄÂßã‰Ω†ÁöÑÂÜíÈô©</p>
                </div>

                <div class="modes-container">
                <!-- ‰ªòË¥πÊ®°ÂºèÔºàÈ¶ñÊ¨°ÂÖçË¥πÔºâ-->
                <div class="mode-card" id="paidModeCard">
                    <div class="mode-badge" id="modeBadge">È¶ñÊ¨°ÂÖçË¥π</div>
                    <div class="mode-icon">üíé</div>
                    <div class="mode-title">‰ªòË¥πÊ∏∏Áé©</div>
                    <div class="mode-price" id="modePrice">
                        <span style="text-decoration: line-through; opacity: 0.5; font-size: 18px;">10 USDT</span>
                        <span style="color: #FFD700; font-size: 32px; font-weight: bold;">FREE</span>
                    </div>
                    <div style="background: linear-gradient(135deg, #FF6B6B, #FF8E53); padding: 20px; border-radius: 20px; margin: 15px 0; box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4); border: 3px solid rgba(255, 255, 255, 0.3); position: relative; overflow: hidden;">
                        <div style="position: absolute; top: -50%; right: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%); animation: shine 3s infinite;"></div>
                        <div style="position: relative; z-index: 1; text-align: center;">
                            <div style="font-size: 40px; margin-bottom: 10px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));">üéÅ</div>
                            <p style="font-size: 20px; font-weight: 900; color: #FFF; margin: 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); letter-spacing: 1px;">È¶ñÊ¨°ÂèÇ‰∏éÂç≥ÈÄÅ</p>
                            <p style="font-size: 28px; font-weight: 900; color: #FFD700; margin: 8px 0 0 0; text-shadow: 3px 3px 6px rgba(0,0,0,0.5); letter-spacing: 2px; animation: pulse 1.5s infinite;">ÂÖçË¥πÊäΩÂ•ñÊú∫‰ºöÔºÅ</p>
                        </div>
                    </div>
                    <ul class="mode-features">
                        <li>‚ú® È¶ñÊ¨°Ê∏∏Áé©ÂÆåÂÖ®ÂÖçË¥π</li>
                        <li>üé∞ Ê∏∏ÊàèÁªìÊùüÁ´ãÂç≥ÊäΩÂ•ñ</li>
                        <li>üí∞ ÊúÄÈ´òÂèØËµ¢ ‚Çπ8.88Cr Âç¢ÊØî</li>
                        <li>üéâ Â§öÊ°£Â•ñÈáëÁ≠â‰Ω†Êãø</li>
                    </ul>
                    <!-- Ê∏∏Áé©Êú∫‰ºöÊòæÁ§∫ -->
                    <div id="playTicketsDisplay" style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); border: 2px solid rgba(255,215,0,0.5); padding: 12px 20px; border-radius: 20px; margin-bottom: 15px; display: none; box-shadow: 0 8px 32px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <span style="font-size: 24px;">üéüÔ∏è</span>
                            <div style="text-align: left;">
                                <div style="font-size: 12px; color: rgba(255,255,255,0.8); line-height: 1.2;">Ê∏∏Áé©Êú∫‰ºö</div>
                                <div style="font-size: 28px; font-weight: 900; color: #FFD700; text-shadow: 0 2px 8px rgba(255,215,0,0.5); line-height: 1;" id="playTicketsCount">0</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÊåâÈíÆÁªÑÔºöÂàÜÂºÄÊ∏∏Áé©ÂíåË¥≠‰π∞ -->
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <!-- Ê∏∏Áé©ÊåâÈíÆÔºàÈ¶ñÊ¨°ÂÖçË¥πÊàñ‰ΩøÁî®Èó®Á•®Ôºâ -->
                        <button class="play-btn" id="playGameBtn" onclick="event.stopPropagation(); handlePlayGame();" style="background: linear-gradient(135deg, #667eea, #764ba2); font-size: 18px; font-weight: bold;">
                            üéÆ <span id="playGameBtnText">Á´ãÂç≥ÂÖçË¥πÊ∏∏Áé©</span>
                        </button>
                        
                        <!-- Ë¥≠‰π∞Èó®Á•®ÊåâÈíÆ -->
                        <button class="play-btn" id="buyTicketBtn" onclick="event.stopPropagation(); handleBuyTicket();" style="background: linear-gradient(135deg, #FFD700, #FFA500); font-size: 16px; font-weight: bold; display: none;">
                            üí≥ Ë¥≠‰π∞Ê∏∏Áé©Êú∫‰ºö (‚Çπ1000)
                        </button>
                    </div>
                    
                    <div class="payment-notice" id="paymentNotice" style="display: none;">
                        <p>üí° ÊèêÁ§∫ÔºöÈ¶ñÊ¨°Ê∏∏Áé©ÂÆåÂÖ®ÂÖçË¥πÔºÅ</p>
                        <p style="margin-top: 10px; font-size: 12px; opacity: 0.8;">ÂêéÁª≠Ê∏∏Áé©ÈúÄË¥≠‰π∞Ê∏∏Áé©Êú∫‰ºö</p>
                    </div>
                </div>
            </div>

                <div class="info-box" style="background: linear-gradient(135deg, rgba(19, 136, 8, 0.25), rgba(255, 153, 51, 0.2)); border: 2px solid rgba(255, 215, 0, 0.5); backdrop-filter: blur(15px); box-shadow: 0 4px 15px rgba(255, 153, 51, 0.3);">
                    <h3 style="color: #FFD700; font-size: 20px; font-weight: 900; text-shadow: 0 2px 8px rgba(0, 0, 0, 0.9);">üìã Ê∏∏ÊàèËßÑÂàô</h3>
                    <p>
                        <strong style="color: #FFD700;">üéÅ È¶ñÊ¨°ÂÖçË¥πÔºö</strong>Êñ∞Áî®Êà∑È¶ñÊ¨°Ê∏∏Áé©ÂÆåÂÖ®ÂÖçË¥πÔºåÊ∏∏ÊàèÁªìÊùüÂêéÁ´ãÂç≥Ëé∑Âæó‰∏ÄÊ¨°ÊäΩÂ•ñÊú∫‰ºöÔºÅ<br><br>
                        <strong style="color: #FFD700;">üí∞ ÂêéÁª≠Ê∏∏Áé©Ôºö</strong>ÊîØ‰ªò ‚Çπ1000 Âç¢ÊØîÂç≥ÂèØÁªßÁª≠Ê∏∏Áé©ÔºåÊØèÊ¨°ÈÄöÂÖ≥ÈÉΩËÉΩËé∑ÂæóÊäΩÂ•ñÊú∫‰ºöÔºå
                        ÊúâÊú∫‰ºöËµ¢ÂèñÈ´òËææ ‚Çπ8.88 Crore (8.88‰∫øÂç¢ÊØî) Ë∂ÖÁ∫ßÂ§ßÂ•ñÔºåËøòÊúâÂ§öÊ°£Â•ñÈáëÁ≠â‰Ω†ÊãøÔºåÂø´Êù•ËØïËØïÊâãÊ∞îÔºÅ
                    </p>
                </div>
            </div>
        </div>

        <!-- È°µÈù¢2ÔºöÊäΩÂ•ñÈ°µ -->
        <div class="page" id="spinPage">
            <div class="spin-hero" style="padding-bottom: 25px;">
                <div class="spin-hero-content">
                    <!-- È°∂ÈÉ®Ê†áÈ¢òÂå∫ -->
                    <div class="spin-title" style="margin-bottom: 20px;">üé∞ ‡§≠‡§æ‡§ó‡•ç‡§Ø ‡§ö‡§ï‡•ç‡§∞ üé∞</div>
                    
                    <!-- ÊàêÂäüÊèêÁé∞ÈÄöÁü•ÊªöÂä®Ê°Ü - ÊäΩÂ•ñÈ°µ -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; padding: 12px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); overflow: hidden;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="font-size: 20px;">üéâ</div>
                            <div style="flex: 1; overflow: hidden;">
                                <div data-withdrawal-notice style="color: white; font-size: 13px; white-space: nowrap; animation: scrollText 6s linear infinite;">
                                    Âä†ËΩΩ‰∏≠...
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÊäΩÂ•ñÊ¨°Êï∞ÊòæÁ§∫ -->
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="display: inline-block; background: rgba(255, 215, 0, 0.15); border: 2px solid rgba(255, 215, 0, 0.5); border-radius: 15px; padding: 12px 25px;">
                            <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px;">ÂèØÁî®ÊäΩÂ•ñÊ¨°Êï∞</div>
                            <div style="font-size: 32px; font-weight: 900; color: #FFD700; text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);"><span id="availableSpins">0</span> Ê¨°</div>
                        </div>
                    </div>
                    
                    <!-- ËΩ¨Áõò - ÊñπÂùóÊ†ºÂ≠êËÄÅËôéÊú∫ -->
                    <div class="wheel-container" style="margin: 25px auto;">
                        <div class="wheel" id="wheel">
                            <div class="wheel-inner">
                                <div class="sector" data-index="0"><span>‚Çπ8.88Cr</span></div>
                                <div class="sector" data-index="1"><span>‚Çπ88.8L</span></div>
                                <div class="sector" data-index="2"><span>‚Çπ18.8L</span></div>
                                <div class="sector" data-index="3"><span>‚Çπ8.8L</span></div>
                                <div class="sector" data-index="4"><span>‚Çπ1.8L</span></div>
                                <div class="sector" data-index="5"><span>‚Çπ80K</span></div>
                                <div class="sector" data-index="6"><span>‚Çπ30K</span></div>
                                <div class="sector" data-index="7"><span>‚Çπ10K</span></div>
                                <div class="sector" data-index="8"><span>‚Çπ9.9K</span></div>
                                <div class="sector" data-index="9"><span>‚Çπ7K</span></div>
                                <div class="sector" data-index="10"><span>üé≤ Random</span></div>
                                <div class="sector" data-index="11"><span>‚Çπ99</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- ÊäΩÂ•ñÊåâÈíÆ -->
                    <button class="spin-btn" id="spinBtn" onclick="handleSpin()" style="margin: 20px auto; display: block;">
                        üé≤ Á´ãÂç≥ÊäΩÂ•ñ üé≤
                    </button>
                    
                    <!-- Áä∂ÊÄÅÊèêÁ§∫ -->
                    <div class="spin-status" id="spinStatus" style="margin-bottom: 25px;">
                        üí° ÈÇÄËØ∑Â•ΩÂèãÊàñ‰ªòË¥πÊ∏∏Áé©Ëé∑ÂæóÊäΩÂ•ñÊú∫‰ºöÔºÅ
                    </div>

                    <!-- Êìç‰ΩúÊåâÈíÆÁªÑ -->
                    <div style="display: flex; gap: 12px; justify-content: center; margin-bottom: 25px; flex-wrap: wrap; padding: 0 15px;">
                        <button class="invite-btn" onclick="showInviteLink()" style="flex: 1; min-width: 140px; max-width: 200px;">
                            üë• ÈÇÄËØ∑Â•ΩÂèã
                        </button>
                        <button class="invite-btn" onclick="showTaskModal()" style="flex: 1; min-width: 140px; max-width: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
                            üìã Ëé∑ÂèñÊäΩÂ•ñ
                        </button>
                    </div>

                    <!-- ÊèêÁé∞ÊåâÈíÆÂå∫Âüü -->
                    <div style="margin-top: 30px; padding: 25px; background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 165, 0, 0.15)); border-radius: 20px; box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3); border: 2px solid rgba(255, 215, 0, 0.3);">
                        <div style="display: flex; align-items: center; justify-content: space-between; gap: 20px;">
                            <div style="flex: 1; text-align: center; padding: 15px; background: rgba(255, 215, 0, 0.2); border-radius: 15px; border: 2px solid rgba(255, 215, 0, 0.4);">
                                <div style="font-size: 14px; font-weight: bold; color: #FFD700; margin-bottom: 8px; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">üéÅ ÊàëÁöÑÂ•ñÈáë</div>
                                <div id="withdrawBalance" style="font-size: 32px; font-weight: 900; color: #FFD700; text-shadow: 0 3px 10px rgba(255, 215, 0, 0.8), 0 0 20px rgba(255, 215, 0, 0.5); letter-spacing: 1px;">‚Çπ0</div>
                            </div>
                            <button class="task-btn" id="withdrawBtn" onclick="handleWithdraw()" style="flex: 1; background: linear-gradient(135deg, #FFD700, #FFA500); font-size: 20px; font-weight: bold; padding: 25px 20px; box-shadow: 0 6px 20px rgba(255, 215, 0, 0.5); border: 3px solid rgba(255, 255, 255, 0.3);">
                                üí∞ Áî≥ËØ∑ÊèêÁé∞
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- È°µÈù¢3ÔºöÊéíË°åÊ¶ú -->
        <div class="page" id="leaderboardPage">
            <div class="game-content" style="padding-top: 20px;">
                <div class="header">
                    <h1>üèÜ ÊèêÁé∞ÊéíË°åÊ¶ú</h1>
                    <p>ÂÆûÊó∂ÊèêÁé∞Êï∞ÊçÆÔºåÂÖ¨ÂºÄÈÄèÊòé</p>
                </div>

                <!-- ÊàêÂäüÊèêÁé∞ÈÄöÁü•ÊªöÂä®Ê°Ü -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; padding: 15px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); overflow: hidden;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="font-size: 24px;">üéâ</div>
                        <div style="flex: 1; overflow: hidden;">
                            <div data-withdrawal-notice style="color: white; font-size: 14px; white-space: nowrap; animation: scrollText 6s linear infinite;">
                                Âä†ËΩΩ‰∏≠...
                            </div>
                        </div>
                    </div>
                </div>

                <div class="leaderboard-container" id="leaderboardContainer">
                    <div style="text-align: center; padding: 40px 20px; color: rgba(255,255,255,0.6);">
                        <div style="font-size: 48px; margin-bottom: 15px;">üìä</div>
                        <p>Âä†ËΩΩ‰∏≠...</p>
                    </div>
                </div>

                <div class="info-box" style="margin-top: 20px;">
                    <h3>üí° ËØ¥Êòé</h3>
                    <p>
                        ‚Ä¢ ÊéíË°åÊ¶úÊòæÁ§∫ÊâÄÊúâÁé©ÂÆ∂ÁöÑÊèêÁé∞ËÆ∞ÂΩï<br>
                        ‚Ä¢ Êï∞ÊçÆÂÆûÊó∂Êõ¥Êñ∞ÔºåÂÖ¨Âπ≥ÂÖ¨Ê≠£<br>
                        ‚Ä¢ Á¥ØËÆ°Êª° ‚Çπ10K Âç¢ÊØîÂç≥ÂèØÁî≥ËØ∑ÊèêÁé∞<br>
                        ‚Ä¢ ÊèêÁé∞ÂÆ°Ê†∏ÈÄöËøáÂêé24Â∞èÊó∂ÂÜÖÂà∞Ë¥¶
                    </p>
                </div>
            </div>
        </div>

        <!-- Â∫ïÈÉ®ÂØºËà™Ê†è -->
        <div class="bottom-nav">
            <button class="nav-item active" onclick="switchPage('gamePage', event)">
                <div class="nav-icon">üéÆ</div>
                <div>Ê∏∏Êàè</div>
            </button>
            <button class="nav-item" onclick="switchPage('spinPage', event)">
                <div class="nav-icon">üé∞</div>
                <div>ÊäΩÂ•ñ</div>
            </button>
            <button class="nav-item" onclick="switchPage('leaderboardPage', event)">
                <div class="nav-icon">üèÜ</div>
                <div>ÊéíË°åÊ¶ú</div>
            </button>
        </div>

    </div>

    <!-- ÊäΩÂ•ñÁªìÊûúÂºπÁ™ó -->
    <div class="result-modal" id="resultModal">
        <div class="result-content">
            <h2>üéâ ÊÅ≠Âñú‰∏≠Â•ñÔºÅ</h2>
            <div class="prize-amount" id="prizeAmount">9900 Âç¢ÊØî</div>
            <div class="result-message" id="prizeMessage">
                ‰Ω†Ëµ¢Âæó‰∫ÜÂ•ñÂä±ÔºÅ<br>
                ‰Ω†ÁúüÂπ∏ËøêÂø´ÂéªÊèêÁé∞ÂêßÔºÅ
            </div>
            <button class="close-modal-btn" onclick="closeResultModal()">Â§™Ê£í‰∫ÜÔºÅ</button>
        </div>
    </div>

    <!-- ÈÇÄËØ∑ÈìæÊé•ÂºπÁ™ó -->
    <div class="result-modal" id="inviteModal">
        <div class="result-content">
            <h2>üë• ÈÇÄËØ∑Â•ΩÂèã</h2>
            <p style="margin: 20px 0; font-size: 16px; opacity: 0.9;">
                ÂàÜ‰∫´‰Ω†ÁöÑ‰∏ìÂ±ûÈÇÄËØ∑ÈìæÊé•ÁªôÂ•ΩÂèã<br>
                Â•ΩÂèãÈÄöËøáÈìæÊé•ËøõÂÖ•Ê∏∏ÊàèÔºå‰Ω†Âç≥ÂèØËé∑ÂæóÊäΩÂ•ñÊú∫‰ºöÔºÅ
            </p>
            <div class="invite-link-container">
                <input type="text" id="inviteLink" readonly class="invite-link-input">
                <button class="copy-btn" onclick="copyInviteLink()">
                    üìã Â§çÂà∂
                </button>
            </div>
            <div class="invite-stats">
                <div class="stat-item">
                    <div class="stat-value" id="inviteCount">0</div>
                    <div class="stat-label">Â∑≤ÈÇÄËØ∑</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="inviteReward">0</div>
                    <div class="stat-label">Â•ñÂä±Ê¨°Êï∞</div>
                </div>
            </div>
            <button class="close-modal-btn" onclick="closeInviteModal()">ÂÖ≥Èó≠</button>
        </div>
    </div>

    <!-- ÊèêÁé∞ÊèêÁ§∫ÂºπÁ™ó -->
    <div class="result-modal" id="withdrawTipModal">
        <div class="result-content" style="max-width: 400px;">
            <div style="font-size: 60px; margin-bottom: 15px;">üí∞</div>
            <h2 style="font-size: 28px; margin-bottom: 15px; color: #FFD700;">ÊèêÁé∞ËØ¥Êòé</h2>
            <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.2)); padding: 25px; border-radius: 15px; margin: 20px 0; border: 2px solid rgba(255, 215, 0, 0.3);">
                <p style="font-size: 20px; font-weight: bold; color: #FFD700; margin: 0; line-height: 1.6; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
                    Á¥ØËÆ°Êª° <span style="font-size: 28px; color: #FFF;">‚Çπ10K</span><br>
                    Âç≥ÂèØÁ´ãÈ©¨ÊèêÁé∞Âà∞Ë¥¶ÔºÅ
                </p>
            </div>
            <div id="withdrawTipContent" style="font-size: 16px; color: rgba(255,255,255,0.9); margin: 20px 0; line-height: 1.8;">
                <!-- Âä®ÊÄÅÂÜÖÂÆπ -->
            </div>
            <button class="close-modal-btn" onclick="closeWithdrawTipModal()" style="margin-top: 10px;">Áü•ÈÅì‰∫Ü</button>
        </div>
    </div>

    <!-- ÊèêÁé∞Áî≥ËØ∑ÂºπÁ™ó -->
    <div class="result-modal" id="withdrawModal">
        <div class="result-content" style="max-width: 500px; background: white; color: #333;">
            <!-- È°∂ÈÉ®Ê†áÈ¢ò -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; margin: -30px -30px 20px -30px; border-radius: 15px 15px 0 0;">
                <h2 style="font-size: 24px; margin: 0; color: white; text-align: center;">üí∞ ÊèêÁé∞Áî≥ËØ∑</h2>
            </div>

            <!-- ÊèêÁé∞ÈáëÈ¢ùÊòæÁ§∫ -->
            <div style="text-align: center; margin-bottom: 25px;">
                <p style="font-size: 14px; color: #666; margin-bottom: 8px;">ÊèêÁé∞ÈáëÈ¢ù</p>
                <p style="font-size: 36px; font-weight: bold; color: #667eea; margin: 0;" id="withdrawModalAmount">‚Çπ0</p>
            </div>

            <!-- ÊèêÁé∞‰ø°ÊÅØË°®Âçï -->
            <div style="text-align: left; margin-bottom: 20px;">
                <label style="display: block; font-size: 14px; font-weight: bold; margin-bottom: 8px; color: #333;">
                    UPIÂú∞ÂùÄ <span style="color: #ff4444;">*</span>
                </label>
                <input type="text" id="withdrawUpiId" placeholder="‰æãÂ¶Ç: 9876543210@paytm" 
                    style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #e0e0e0; font-size: 14px; box-sizing: border-box; margin-bottom: 15px;">
                
                <label style="display: block; font-size: 14px; font-weight: bold; margin-bottom: 8px; color: #333;">
                    ÊâãÊú∫Âè∑ <span style="color: #ff4444;">*</span>
                </label>
                <input type="tel" id="withdrawMobile" placeholder="‰æãÂ¶Ç: 9876543210" 
                    style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #e0e0e0; font-size: 14px; box-sizing: border-box; margin-bottom: 15px;">
                
                <label style="display: block; font-size: 14px; font-weight: bold; margin-bottom: 8px; color: #333;">
                    Èì∂Ë°åË¥¶Âè∑ÔºàÂèØÈÄâÔºâ
                </label>
                <input type="text" id="withdrawBankAccount" placeholder="‰æãÂ¶Ç: 123456789012" 
                    style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #e0e0e0; font-size: 14px; box-sizing: border-box; margin-bottom: 15px;">
                
                <label style="display: block; font-size: 14px; font-weight: bold; margin-bottom: 8px; color: #333;">
                    IFSC‰ª£Á†ÅÔºàÂèØÈÄâÔºâ
                </label>
                <input type="text" id="withdrawIfsc" placeholder="‰æãÂ¶Ç: SBIN0001234" 
                    style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #e0e0e0; font-size: 14px; box-sizing: border-box;">
            </div>

            <!-- ÊèêÁ§∫‰ø°ÊÅØ -->
            <div style="background: #fff3cd; padding: 12px; border-radius: 8px; border-left: 4px solid #ffc107; margin-bottom: 20px;">
                <p style="font-size: 12px; color: #856404; margin: 0; line-height: 1.5;">
                    <strong>üìå Ê∏©È¶®ÊèêÁ§∫Ôºö</strong><br>
                    ‚Ä¢ ÊèêÁé∞ÈáëÈ¢ùÂøÖÈ°ªËææÂà∞ ‚Çπ10,000 ÊâçËÉΩÁî≥ËØ∑<br>
                    ‚Ä¢ ÂÆ°Ê†∏ÈÄöËøáÂêé24Â∞èÊó∂ÂÜÖÂà∞Ë¥¶<br>
                    ‚Ä¢ ËØ∑Á°Æ‰øùÊèê‰æõÁöÑ‰ø°ÊÅØÂáÜÁ°ÆÊó†ËØØ
                </p>
            </div>

            <!-- ÊåâÈíÆÂå∫Âüü -->
            <div style="display: flex; gap: 10px;">
                <button onclick="closeWithdrawModal()" style="flex: 1; padding: 14px; background: #6c757d; border: none; border-radius: 8px; color: white; font-size: 16px; font-weight: bold; cursor: pointer;">
                    ÂèñÊ∂à
                </button>
                <button onclick="submitWithdrawRequest()" style="flex: 2; padding: 14px; background: linear-gradient(135deg, #667eea, #764ba2); border: none; border-radius: 8px; color: white; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);">
                    Êèê‰∫§Áî≥ËØ∑
                </button>
            </div>
        </div>
    </div>

    <!-- ‰ªªÂä°ÂºπÁ™ó -->
    <div class="task-modal" id="taskModal">
        <div class="task-modal-content">
            <div class="current-task-card" id="currentTaskCard">
                <div class="task-type-badge" id="taskTypeBadge">ÂàùÂßã‰ªªÂä°</div>
                <div class="task-name" id="taskName">ÂÆåÊàêÈ¶ñÊ¨°ÊäΩÂ•ñ</div>
                <div class="task-description" id="taskDescription">
                    ËøõË°å‰∏ÄÊ¨°‰ªòË¥πÊ∏∏Áé©Âπ∂ÂÆåÊàêÊäΩÂ•ñÔºåÂç≥ÂèØÊøÄÊ¥ªÂêéÁª≠‰ªªÂä°Á≥ªÁªü
                </div>
                <div class="task-progress-bar">
                    <div class="task-progress-fill" id="taskProgressFill" style="width: 0%;"></div>
                </div>
                <div class="task-progress-text" id="taskProgressText">ËøõÂ∫¶: 0 / 1</div>
                
                <div class="task-action-buttons" id="taskActionButtons">
                    <!-- Âä®ÊÄÅÁîüÊàêÊåâÈíÆ -->
                </div>
            </div>


            <button class="close-task-modal-btn" onclick="closeTaskModal()">ÂÖ≥Èó≠</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        const APP_VERSION = '1.2.0';
        const API_BASE = window.location.origin + '/api';
        let authToken = localStorage.getItem('authToken');
        let isSpinning = false;

        // Èü≥‰πêÊéßÂà∂
        const bgMusic = document.getElementById('bgMusic');

        // Èü≥ÊïàÊéßÂà∂
        const spinSound = document.getElementById('spinSound');
        const winSound = document.getElementById('winSound');

        // Êí≠ÊîæÈü≥ÊïàÂáΩÊï∞ÔºàÂÆâÂÖ®Êí≠ÊîæÔºåÊñá‰ª∂‰∏çÂ≠òÂú®‰πü‰∏çÊä•ÈîôÔºâ
        function playSound(sound) {
            if (!sound || !sound.src) {
                return; // Â¶ÇÊûúÈü≥ÊïàÊñá‰ª∂‰∏çÂ≠òÂú®ÔºåÁõ¥Êé•ËøîÂõû
            }
            try {
                sound.currentTime = 0;
                sound.play().catch(err => {
                    // Èü≥ÊïàÊí≠ÊîæÂ§±Ë¥•ÔºàÂèØËÉΩÊòØÊñá‰ª∂‰∏çÂ≠òÂú®ÊàñÊµèËßàÂô®ÈôêÂà∂ÔºâÔºåÈùôÈªòÂ§ÑÁêÜ
                });
            } catch (error) {
                // Èü≥ÊïàÊí≠ÊîæÈîôËØØÔºåÈùôÈªòÂ§ÑÁêÜ
            }
        }

        // ÂàùÂßãÂåñÈü≥‰πêÁä∂ÊÄÅ - Ëá™Âä®Êí≠ÊîæËÉåÊôØÈü≥‰πê
        function initMusic() {
            // Âª∂Ëøü‰∏Ä‰∏ãÔºåÁ°Æ‰øùÈ°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÊí≠Êîæ
            setTimeout(() => {
                bgMusic.play().catch(error => {
                    // Ëá™Âä®Êí≠ÊîæË¢´ÈòªÊ≠¢ÔºåÂ∞ùËØïÂú®Áî®Êà∑‰∫§‰∫íÂêéÊí≠Êîæ
                    document.addEventListener('click', function playOnInteraction() {
                        bgMusic.play().catch(() => {});
                        document.removeEventListener('click', playOnInteraction);
                    }, { once: true });
                });
            }, 500);
        }

        // ÂÆâÂÖ®ÁöÑ Telegram API ÂåÖË£ÖÂáΩÊï∞
        function safeTgAlert(message) {
            try {
                if (typeof tg.showAlert === 'function') {
                    tg.showAlert(message);
                } else {
                    alert(message);
                }
            } catch (error) {
                console.error('showAlert Â§±Ë¥•:', error);
                alert(message);
            }
        }

        function safeTgConfirm(message, callback) {
            try {
                if (typeof tg.showConfirm === 'function') {
                    tg.showConfirm(message, callback);
                } else if (confirm(message)) {
                    callback(true);
                }
            } catch (error) {
                console.error('showConfirm Â§±Ë¥•:', error);
                if (confirm(message)) {
                    callback(true);
                }
            }
        }

        // ‰ªªÂä°Á≥ªÁªüÈÖçÁΩÆ - ÂêéÁ´ØÊéßÂà∂ÔºåÂâçÁ´ØÂè™ÊòæÁ§∫ÂΩìÂâç‰ªªÂä°
        const TASK_REWARDS = [
            9900,    // ‰ªªÂä°1ÔºöÈ¶ñÊ¨°Ê∏∏Áé©
            99,      // ‰ªªÂä°2ÔºöÈÇÄËØ∑Êàñ‰ªòË¥π
            0.5,     // ‰ªªÂä°3ÔºöÂøÖÈ°ª‰ªòË¥π
            0.4,     // ‰ªªÂä°4
            0.05,    // ‰ªªÂä°5
            0.04,    // ‰ªªÂä°6
            0.001,   // ‰ªªÂä°7ÔºöÂøÖÈ°ª‰ªòË¥π
            0.001,   // ‰ªªÂä°8
            0.001,   // ‰ªªÂä°9
            0.001,   // ‰ªªÂä°10
            0.001,   // ‰ªªÂä°11ÔºöÂøÖÈ°ª‰ªòË¥π
            0.001,   // ‰ªªÂä°12
            0.0005,  // ‰ªªÂä°13
            0.0005,  // ‰ªªÂä°14
            0.0005,  // ‰ªªÂä°15ÔºöÂøÖÈ°ª‰ªòË¥π
            0.0005,  // ‰ªªÂä°16
            0.0002,  // ‰ªªÂä°17
            0.0002,  // ‰ªªÂä°18
            0.0002,  // ‰ªªÂä°19ÔºöÂøÖÈ°ª‰ªòË¥π
            0.0002,  // ‰ªªÂä°20
            0.0001,  // ‰ªªÂä°21
            0.0001,  // ‰ªªÂä°22
            0.0005,  // ‰ªªÂä°23ÔºöÂøÖÈ°ª‰ªòË¥π
            0.0005   // ‰ªªÂä°24ÔºöÂøÖÈ°ª‰ªòË¥π
        ];

        // ‰ªªÂä°Á±ªÂûãÂÆö‰πâ
        const TASK_TYPES = {
            INITIAL_SPIN: 'initial_spin',      // ÂàùÂßãÊäΩÂ•ñ
            PAID_GAME: 'paid_game',            // ÂøÖÈ°ª‰ªòË¥πÊ∏∏Áé©
            INVITE_OR_GAME: 'invite_or_game'   // ÈÇÄËØ∑Â•ΩÂèãÊàñ‰ªòË¥πÊ∏∏Áé©
        };

        // Ê†ºÂºèÂåñÂ•ñÈáëÊòæÁ§∫ - ‰ΩøÁî®Âç∞Â∫¶Êï∞Â≠óÁ≥ªÁªü
        function formatPrizeAmount(amount) {
            // Á°Æ‰øùËΩ¨Êç¢‰∏∫Êï∞Â≠óÁ±ªÂûã
            const num = parseFloat(amount);
            if (isNaN(num)) {
                return '‚Çπ0';
            }
            
            if (num >= 10000000) {
                // Crore (ÂçÉ‰∏á)
                const crore = num / 10000000;
                return `‚Çπ${crore.toFixed(2).replace(/\.?0+$/, '')}Cr`;
            } else if (num >= 100000) {
                // Lakh (ÂçÅ‰∏á)
                const lakh = num / 100000;
                return `‚Çπ${lakh.toFixed(1).replace(/\.?0+$/, '')}L`;
            } else if (num >= 10000) {
                // Âè™Êúâ >= 10000 ÊâçÊòæÁ§∫‰∏∫KÊ†ºÂºè
                const thousand = num / 1000;
                return `‚Çπ${thousand.toFixed(1).replace(/\.?0+$/, '')}K`;
            } else if (num >= 1) {
                // 1-9999ÔºöÂè™Âú®Â∞èÊï∞‰∏ç‰∏∫0Êó∂ÊòæÁ§∫Â∞èÊï∞
                const hasDecimal = num % 1 !== 0;
                if (hasDecimal) {
                    // ÊúâÂ∞èÊï∞ÔºöÂéªÊéâÊú´Â∞æÁöÑ0
                    return `‚Çπ${num.toFixed(6).replace(/\.?0+$/, '')}`;
                } else {
                    // Êï¥Êï∞ÔºöÁõ¥Êé•ÊòæÁ§∫Ôºå‰ΩøÁî®Âç∞Â∫¶Êï∞Â≠óÊ†ºÂºè
                    return `‚Çπ${Math.floor(num).toLocaleString('en-IN')}`;
                }
            } else {
                // Â∞è‰∫é1ÁöÑÔºö‰øùÁïôÂ∞èÊï∞ÔºåÂéªÊéâÊú´Â∞æÁöÑ0
                return `‚Çπ${num.toFixed(6).replace(/\.?0+$/, '')}`;
            }
        }

        // ÊäΩÂ•ñÂäüËÉΩÔºàÂü∫‰∫é available_spinsÔºâ
        async function handleSpin() {
            if (isSpinning) return;

            const spinBtn = document.getElementById('spinBtn');
            const wheel = document.getElementById('wheel');
            const spinStatus = document.getElementById('spinStatus');

            try {
                isSpinning = true;
                spinBtn.disabled = true;
                spinStatus.textContent = 'Ê£ÄÊü•ÊäΩÂ•ñËµÑÊ†º...';

                // ÁôªÂΩï
                if (!authToken) {
                    await login();
                }

                // Ê£ÄÊü•ÂèØÁî®ÊäΩÂ•ñÊ¨°Êï∞
                const availableResponse = await fetch(`${API_BASE}/spin/available`, {
                    headers: { 'Authorization': `Bearer ${authToken}` },
                });
                const availableData = await availableResponse.json();

                if (!availableData.success || availableData.data.available_spins <= 0) {
                    spinStatus.textContent = 'Ê≤°ÊúâÂèØÁî®ÁöÑÊäΩÂ•ñÊú∫‰ºöÔºÅ';
                    isSpinning = false;
                    spinBtn.disabled = false;
                    // ÊòæÁ§∫‰ªªÂä°ÂºπÁ™ó
                    showTaskModal();
                    return;
                }

                spinStatus.textContent = 'üé∞ ËΩ¨ÁõòÊóãËΩ¨‰∏≠...';

                // Êí≠ÊîæËΩ¨ÁõòÈü≥Êïà
                playSound(spinSound);

                // Ë∞ÉÁî®Êñ∞ÁöÑÊäΩÂ•ñAPIÔºàÂü∫‰∫é available_spinsÔºâ
                const spinResponse = await fetch(`${API_BASE}/spin/execute`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json',
                    },
                });

                const spinData = await spinResponse.json();

                if (!spinData.success) {
                    throw new Error(spinData.message || 'ÊäΩÂ•ñÂ§±Ë¥•');
                }

                const result = spinData.data;
                const prizeAmount = result.prize_amount || result.amount || 88;

                // ËÆ°ÁÆóÊñπÂùóË∑≥Âä®Âä®ÁîªÔºàÊ†πÊçÆÂ•ñÈáëÈáëÈ¢ùÂåπÈÖçÊ†ºÂ≠êÔºâ
                // Ê†ºÂ≠êÈáëÈ¢ùÔºö8.88Cr, 88.8L, 18.8L, 8.8L, 1.8L, 80K, 30K, 10K, 9.9K, 7K, Random, 99
                const prizeMap = {
                    88880000: 0, 8880000: 1, 1880000: 2, 880000: 3, 180000: 4, 80000: 5, 
                    30000: 6, 10000: 7, 9900: 8, 7000: 9, 99: 11
                    // RandomÂ•ñÂä±‰ºöÂú®ÂêéÁ´ØÈöèÊú∫ÁîüÊàêÈáëÈ¢ùÔºåÊ†πÊçÆÂÆûÈôÖÈáëÈ¢ùÂåπÈÖçÂà∞ÂØπÂ∫îÊ†ºÂ≠êÔºåÂ¶ÇÊûúÊ≤°ÊúâÂåπÈÖçÂ∞±ÊòæÁ§∫Âú®Ê†ºÂ≠ê10
                };
                
                // ÂØπ‰∫éÈöèÊú∫Â•ñÂä±ÔºàÊ†ºÂ≠ê10ÔºâÔºåÂ¶ÇÊûúÈáëÈ¢ù‰∏çÂú®prizeMap‰∏≠ÔºåÂ∞±ÊòæÁ§∫Âú®Ëøô‰∏™Ê†ºÂ≠ê
                let targetSector = prizeMap[prizeAmount];
                if (targetSector === undefined) {
                    // Ê£ÄÊü•ÊòØÂê¶ÊòØÈöèÊú∫ÈáëÈ¢ùÔºà100-10000‰πãÈó¥ÁöÑ‰ªªÊÑèÂÄºÔºâ
                    if (prizeAmount > 99 && prizeAmount < 100000 && !prizeMap[prizeAmount]) {
                        targetSector = 10; // RandomÊ†ºÂ≠ê
                    } else {
                        targetSector = 7; // ÈªòËÆ§10KÊ†ºÂ≠ê
                    }
                }
                
                // Êí≠ÊîæÊäΩÂ•ñÈü≥Êïà
                playSound(spinSound);

                // ËÄÅËôéÊú∫Ë∑≥Âä®Âä®Áîª
                const sectors = wheel.querySelectorAll('.sector');
                let currentIndex = 0;
                let cycles = 0;
                const totalCycles = 3; // Ë∑≥Âä®3Âúà
                const speed = 80; // ÂàùÂßãÈÄüÂ∫¶(ms)
                
                const jump = () => {
                    // ÁßªÈô§‰πãÂâçÁöÑactive
                    sectors.forEach(s => s.classList.remove('active'));
                    
                    // Ê∑ªÂä†ÂΩìÂâçÁöÑactive
                    sectors[currentIndex].classList.add('active');
                    
                    // ËÆ°ÁÆó‰∏ã‰∏Ä‰∏™‰ΩçÁΩÆ
                    currentIndex = (currentIndex + 1) % 12;
                    
                    // ÂÆåÊàê‰∏ÄÂúà
                    if (currentIndex === 0) {
                        cycles++;
                    }
                    
                    // Âà§Êñ≠ÊòØÂê¶ÁªìÊùü
                    if (cycles < totalCycles || currentIndex <= targetSector) {
                        // ÈÄêÊ∏êÂáèÈÄü
                        const delay = cycles >= totalCycles ? speed + (currentIndex * 30) : speed;
                        setTimeout(jump, delay);
                    } else {
                        // Á°Æ‰øùÂÅúÂú®ÁõÆÊ†á‰ΩçÁΩÆ
                        sectors.forEach(s => s.classList.remove('active'));
                        sectors[targetSector].classList.add('active');
                    }
                };
                
                jump();

                // ÊòæÁ§∫ÁªìÊûú
                setTimeout(async () => {
                    // ÂÅúÊ≠¢ËΩ¨ÁõòÈü≥Êïà
                    if (spinSound) {
                        spinSound.pause();
                        spinSound.currentTime = 0;
                    }

                    // Êí≠Êîæ‰∏≠Â•ñÈü≥Êïà
                    playSound(winSound);

                    const formattedAmount = formatPrizeAmount(prizeAmount);
                    
                    // ÁîüÊàêÈºìÂä±ËØùËØ≠
                    const encouragementMessage = generateEncouragementMessage(prizeAmount);
                    spinStatus.textContent = `üéâ ÊÅ≠ÂñúËé∑Âæó ${formattedAmount} Âç¢ÊØîÔºÅ${encouragementMessage}`;
                    
                    // ÊòæÁ§∫ÂºπÁ™ó
                    const message = result.requires_tasks 
                        ? `üéâ ÊÅ≠ÂñúËé∑Âæó ${formattedAmount} Âç¢ÊØîÔºÅ\n\n${encouragementMessage}\n\nÂÆåÊàê‰ªªÂä°ÂêéÂç≥ÂèØËß£ÈîÅÊèêÁé∞„ÄÇ`
                        : `üéâ ÊÅ≠ÂñúËé∑Âæó ${formattedAmount} Âç¢ÊØîÔºÅ\n\n${encouragementMessage}`;
                    showResultModal(prizeAmount, message);
                    
                    isSpinning = false;
                    spinBtn.disabled = false;
                    
                    // Êõ¥Êñ∞ÊâÄÊúâÊòæÁ§∫
                    await loadAvailableSpins(); // ÊäΩÂ•ñÊ¨°Êï∞ÂáèÂ∞ë
                    await checkTaskProgress(); // Êõ¥Êñ∞ËÉΩÈáèÊù°
                }, 4000);

            } catch (error) {
                console.error('ÊäΩÂ•ñÈîôËØØ:', error);
                spinStatus.textContent = 'ÊäΩÂ•ñÂ§±Ë¥•ÔºåËØ∑ÈáçËØï';
                safeTgAlert('ÊäΩÂ•ñÂ§±Ë¥•: ' + error.message);
                isSpinning = false;
                spinBtn.disabled = false;
            }
        }

        // ÁîüÊàêÈºìÂä±ËØùËØ≠
        function generateEncouragementMessage(prizeAmount) {
            const balance = window.currentBalance || 0;
            const totalBalance = balance + prizeAmount;
            const withdrawThreshold = 100; // ÊèêÁé∞Èó®Êßõ ‚Çπ100
            
            const messages = {
                highPrize: [
                    'üéä Â§™Ê£í‰∫ÜÔºÅÂ§ßÂ•ñÊù•‰∫ÜÔºÅ',
                    'üíé ËøêÊ∞îÁàÜÊ£öÔºÅÁªßÁª≠Âä†Ê≤πÔºÅ',
                    'üåü Âπ∏ËøêÂ•≥Á•ûÁú∑È°æ‰Ω†ÔºÅ',
                    'üî• ÊâãÊ∞îÁÅ´ÁÉ≠ÔºÅÂÜçÊé•ÂÜçÂéâÔºÅ'
                ],
                nearWithdraw: [
                    'üí™ Âä†Ê≤πÔºÅÈ©¨‰∏äÂ∞±ËÉΩÊèêÁé∞‰∫ÜÔºÅ',
                    'üéØ ËøòÂ∑Æ‰∏ÄÁÇπÁÇπÂ∞±Âà∞10000Âç¢ÊØî‰∫ÜÔºÅ',
                    '‚≠ê ÂùöÊåÅ‰ΩèÔºÅÊèêÁé∞Âú®ÊúõÔºÅ',
                    'üöÄ ÂÜçÊù•Âá†Ê¨°Â∞±ËÉΩÊèêÁé∞‰∫ÜÔºÅ'
                ],
                canWithdraw: [
                    'üéâ ÊÅ≠ÂñúÔºÅÂ∑≤ËææÂà∞ÊèêÁé∞Èó®ÊßõÔºÅ',
                    'üí∞ Â§™Â•Ω‰∫ÜÔºÅÂèØ‰ª•ÂéªÊèêÁé∞‰∫ÜÔºÅ',
                    '‚ú® ÂÆåÁæéÔºÅËµ∂Âø´ÂéªÊèêÁé∞ÂêßÔºÅ',
                    'üéä ÊàêÂäüÔºÅÂø´ÂéªÈ¢ÜÂèñ‰Ω†ÁöÑÂ•ñÂä±ÔºÅ'
                ],
                encouragement: [
                    'üåà ÁªßÁª≠Âä™ÂäõÔºÅÂ•ΩËøêËøûËøûÔºÅ',
                    'üí´ ÁßØÂ∞ëÊàêÂ§öÔºÅÂùöÊåÅÂ∞±ÊòØËÉúÂà©ÔºÅ',
                    'üéØ ÊØè‰∏ÄÊ¨°ÈÉΩÂú®Êé•ËøëÁõÆÊ†áÔºÅ',
                    '‚ö° Âä†Ê≤πÔºÅ‰∏ãÊ¨°‰ºöÊõ¥Â•ΩÔºÅ',
                    'üçÄ Âπ∏ËøêÊ≠£Âú®Ë∑Ø‰∏äÔºÅ',
                    'üé™ ÁªßÁª≠Ê∏∏ÊàèÔºÅÂ§ßÂ•ñÁ≠â‰Ω†ÔºÅ'
                ]
            };
            
            // Â§ßÂ•ñÔºàË∂ÖËøá50Âç¢ÊØîÔºâ
            if (prizeAmount >= 50) {
                return messages.highPrize[Math.floor(Math.random() * messages.highPrize.length)];
            }
            
            // Â∑≤ËææÂà∞ÊèêÁé∞Èó®Êßõ
            if (totalBalance >= withdrawThreshold) {
                return messages.canWithdraw[Math.floor(Math.random() * messages.canWithdraw.length)];
            }
            
            // Êé•ËøëÊèêÁé∞Èó®ÊßõÔºàËøòÂ∑Æ20Âç¢ÊØî‰ª•ÂÜÖÔºâ
            if (withdrawThreshold - totalBalance <= 20) {
                return messages.nearWithdraw[Math.floor(Math.random() * messages.nearWithdraw.length)];
            }
            
            // ÊôÆÈÄöÈºìÂä±
            return messages.encouragement[Math.floor(Math.random() * messages.encouragement.length)];
        }

        // ÁôªÂΩï
        async function login() {
            try {
                const initData = tg.initData;
                
                if (!initData) {
                    throw new Error('Êó†Ê≥ïËé∑Âèñ Telegram Êï∞ÊçÆÔºåËØ∑Á°Æ‰øùÂú® Telegram ÂÜÖÊâìÂºÄÂ∫îÁî®');
                }
                
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ initData }),
                });
                
                if (!response.ok) throw new Error(`ÁôªÂΩïÂ§±Ë¥• (${response.status})`);
                
                const data = await response.json();
                
                if (data.success && data.data && data.data.token) {
                    authToken = data.data.token;
                    localStorage.setItem('authToken', authToken);
                } else {
                    console.error('ÁôªÂΩïÂ§±Ë¥•:', data.error || data.message);
                    throw new Error(data.error || data.message || 'ÁôªÂΩïÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('ÁôªÂΩïÈîôËØØ:', error);
                // Ê∏ÖÈô§ÂèØËÉΩÂ≠òÂú®ÁöÑÊó†Êïàtoken
                authToken = null;
                localStorage.removeItem('authToken');
                throw error;
            }
        }

        // Ê£ÄÊü•‰ªªÂä°ËøõÂ∫¶Âπ∂Êõ¥Êñ∞ËÉΩÈáèÊù°
        async function checkTaskProgress() {
            try {
                if (!authToken) {
                    await login();
                }

                const balanceResponse = await fetch(`${API_BASE}/user/balance`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (balanceResponse.ok) {
                    const balanceData = await balanceResponse.json();
                    
                    if (balanceData.success) {
                        const balance = balanceData.data.lockedBalance || balanceData.data.locked_balance || 0;
                        updateEnergyBar(balance);
                    }
                }
            } catch (error) {
                console.error('Ê£ÄÊü•‰ªªÂä°ËøõÂ∫¶ÈîôËØØ:', error);
            }
        }

        // Êõ¥Êñ∞‰ΩôÈ¢ùÊòæÁ§∫
        function updateEnergyBar(balance) {
            const withdrawBalance = document.getElementById('withdrawBalance');
            if (withdrawBalance) {
                withdrawBalance.textContent = formatPrizeAmount(balance);
            }
            window.currentBalance = balance;
        }

        // Â§ÑÁêÜÊèêÁé∞ÊåâÈíÆÁÇπÂáª
        async function handleWithdraw() {
            const balance = window.currentBalance || 0;
            console.log('[Withdraw] ÂºÄÂßãÂ§ÑÁêÜÊèêÁé∞ËØ∑Ê±ÇÔºå‰ΩôÈ¢ù:', balance);
            
            // Áõ¥Êé•ÊòæÁ§∫ÊèêÁé∞Áî≥ËØ∑ÂºπÁ™óÔºàÂú®ÂºπÁ™óÂÜÖÊ£ÄÊü•‰ΩôÈ¢ùÔºâ
            showWithdrawModal(balance);
        }

        // ÊòæÁ§∫ÊèêÁé∞Áî≥ËØ∑ÂºπÁ™ó
        function showWithdrawModal(balance) {
            const modal = document.getElementById('withdrawModal');
            const amountDisplay = document.getElementById('withdrawModalAmount');
            
            if (modal && amountDisplay) {
                amountDisplay.textContent = formatPrizeAmount(balance);
                modal.style.display = 'flex';

            }
        }

        // ÂÖ≥Èó≠ÊèêÁé∞Áî≥ËØ∑ÂºπÁ™ó
        function closeWithdrawModal() {
            const modal = document.getElementById('withdrawModal');
            if (modal) {
                modal.style.display = 'none';
                // Ê∏ÖÁ©∫Ë°®Âçï
                document.getElementById('withdrawUpiId').value = '';
                document.getElementById('withdrawMobile').value = '';
                document.getElementById('withdrawBankAccount').value = '';
                document.getElementById('withdrawIfsc').value = '';

            }
        }

        // Êèê‰∫§ÊèêÁé∞Áî≥ËØ∑
        async function submitWithdrawRequest() {
            try {
                // Ëé∑ÂèñË°®ÂçïÊï∞ÊçÆ
                const upiId = document.getElementById('withdrawUpiId').value.trim();
                const mobile = document.getElementById('withdrawMobile').value.trim();
                const bankAccount = document.getElementById('withdrawBankAccount').value.trim();
                const ifsc = document.getElementById('withdrawIfsc').value.trim();
                const balance = window.currentBalance || 0;

                // È™åËØÅÂøÖÂ°´Â≠óÊÆµ
                if (!upiId) {
                    showToast('‚ùå ËØ∑ËæìÂÖ•UPIÂú∞ÂùÄ');
                    return;
                }

                // È™åËØÅUPIÊ†ºÂºèÔºàÂøÖÈ°ªÂåÖÂê´@Á¨¶Âè∑Ôºâ
                if (!upiId.includes('@')) {
                    showToast('‚ùå UPIÂú∞ÂùÄÊ†ºÂºèÈîôËØØÔºåÂ∫îÂåÖÂê´@Á¨¶Âè∑');
                    return;
                }

                if (!mobile) {
                    showToast('‚ùå ËØ∑ËæìÂÖ•ÊâãÊú∫Âè∑');
                    return;
                }

                // È™åËØÅÂç∞Â∫¶ÊâãÊú∫Âè∑Ê†ºÂºèÔºà10‰ΩçÊï∞Â≠óÔºå‰ª•6-9ÂºÄÂ§¥Ôºâ
                if (!/^[6-9]\d{9}$/.test(mobile)) {
                    showToast('‚ùå ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÂç∞Â∫¶ÊâãÊú∫Âè∑Ôºà10‰ΩçÊï∞Â≠óÔºâ');
                    return;
                }

                // Ê£ÄÊü•ÊèêÁé∞ÈáëÈ¢ù
                const minWithdrawAmount = 10000;
                if (balance < minWithdrawAmount) {
                    const remaining = minWithdrawAmount - balance;
                    showToast(`‚ùå ÊèêÁé∞ÈáëÈ¢ù‰∏çË∂≥ÔºÅ\nËøòÈúÄ ${formatPrizeAmount(remaining)} ÊâçËÉΩÁî≥ËØ∑ÊèêÁé∞\n\nüí° ÁªßÁª≠ÂÆåÊàê‰ªªÂä°ÂíåÈÇÄËØ∑Â•ΩÂèãÊù•Â¢ûÂä†Â•ñÈáëÂêßÔºÅ`);
                    return;
                }

                // ÂáÜÂ§áÊèê‰∫§Êï∞ÊçÆ
                const withdrawData = {
                    upiId: upiId,
                    mobile: mobile,
                    bankAccount: bankAccount || null,
                    ifsc: ifsc || null,
                    amount: balance
                };



                // TODO: Ë∞ÉÁî®ÂêéÁ´ØAPIÊèê‰∫§ÊèêÁé∞Áî≥ËØ∑
                // const response = await fetch(`${API_BASE}/withdrawal/request`, {
                //     method: 'POST',
                //     headers: {
                //         'Content-Type': 'application/json',
                //         'Authorization': `Bearer ${authToken}`
                //     },
                //     body: JSON.stringify(withdrawData)
                // });
                //
                // if (!response.ok) {
                //     throw new Error('ÊèêÁé∞Áî≥ËØ∑Êèê‰∫§Â§±Ë¥•');
                // }
                //
                // const result = await response.json();
                // if (!result.success) {
                //     throw new Error(result.error || 'ÊèêÁé∞Áî≥ËØ∑Â§±Ë¥•');
                // }

                // ÊöÇÊó∂Ê®°ÊãüÊàêÂäü
                showToast('‚úÖ ÊèêÁé∞Áî≥ËØ∑Â∑≤Êèê‰∫§ÔºÅ\n\nÊàë‰ª¨‰ºöÂú®24Â∞èÊó∂ÂÜÖÂÆåÊàêÂÆ°Ê†∏Âπ∂ËΩ¨Ë¥¶Âà∞ÊÇ®ÁöÑË¥¶Êà∑„ÄÇ');
                closeWithdrawModal();
                
                // TODO: Âà∑Êñ∞Áî®Êà∑‰ΩôÈ¢ùÁ≠âÊï∞ÊçÆ
                // await checkTaskProgress();

            } catch (error) {
                console.error('ÊèêÁé∞Áî≥ËØ∑Â§±Ë¥•:', error);
                showToast('‚ùå ÊèêÁé∞Áî≥ËØ∑Êèê‰∫§Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
            }
        }

        // ÊòæÁ§∫ÊèêÁé∞ÊèêÁ§∫ÂºπÁ™óÔºà‰øùÁïôÂéüÊúâÂäüËÉΩÔºâ
        function showWithdrawTipModal(currentBalance, remaining) {
            const modal = document.getElementById('withdrawTipModal');
            const content = document.getElementById('withdrawTipContent');
            
            content.innerHTML = `
                <div style="background: rgba(255, 107, 107, 0.2); padding: 15px; border-radius: 10px; border: 1px solid rgba(255, 107, 107, 0.3); margin-bottom: 15px;">
                    <p style="margin: 0; font-size: 14px; opacity: 0.8;">ÂΩìÂâçÂ•ñÈáë</p>
                    <p style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #FFD700;">${formatPrizeAmount(currentBalance)}</p>
                </div>
                <p style="margin: 0; font-size: 16px; opacity: 0.9;">
                    üí™ ËøòÈúÄËé∑Âæó <span style="color: #FFD700; font-weight: bold; font-size: 18px;">${formatPrizeAmount(remaining)}</span> Âç≥ÂèØÊèêÁé∞ÔºÅ
                </p>
                <p style="margin: 15px 0 0 0; font-size: 14px; opacity: 0.7;">
                    üí° ÁªßÁª≠ÂÆåÊàê‰ªªÂä°ÂíåÈÇÄËØ∑Â•ΩÂèãÊù•Â¢ûÂä†Â•ñÈáëÂêß
                </p>
            `;
            
            modal.classList.add('show');
        }

        // ÂÖ≥Èó≠ÊèêÁé∞ÊèêÁ§∫ÂºπÁ™ó
        function closeWithdrawTipModal() {
            const modal = document.getElementById('withdrawTipModal');
            modal.classList.remove('show');
        }

        // ÊòæÁ§∫‰ªªÂä°ÂºπÁ™ó
        async function showTaskModal() {
            const modal = document.getElementById('taskModal');
            if (modal) {
                modal.classList.add('show');
                // Âä†ËΩΩÂΩìÂâç‰ªªÂä°
                await loadCurrentTask();
            }
        }

        // ÂÖ≥Èó≠‰ªªÂä°ÂºπÁ™ó
        function closeTaskModal() {
            const modal = document.getElementById('taskModal');
            modal.classList.remove('show');
        }

        // Âä†ËΩΩÂΩìÂâç‰ªªÂä°
        async function loadCurrentTask() {
            try {
                if (!authToken) {
                    await login();
                }

                // Ëé∑ÂèñÁî®Êà∑‰ªªÂä°ËøõÂ∫¶
                const response = await fetch(`${API_BASE}/task/current`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        updateTaskUI(data.data);
                    }
                } else {
                    // Â¶ÇÊûúAPI‰∏çÂ≠òÂú®ÔºåÊòæÁ§∫ÈªòËÆ§‰ªªÂä°
                    updateTaskUI({
                        task_index: 0,
                        task_type: TASK_TYPES.INITIAL_SPIN,
                        progress: 0,
                        required: 1,
                        total_progress: 0,
                        completed_tasks: 0
                    });
                }
            } catch (error) {
                console.error('Âä†ËΩΩ‰ªªÂä°ÈîôËØØ:', error);
                // ÊòæÁ§∫ÈªòËÆ§‰ªªÂä°
                updateTaskUI({
                    task_index: 0,
                    task_type: TASK_TYPES.INITIAL_SPIN,
                    progress: 0,
                    required: 1,
                    total_progress: 0,
                    completed_tasks: 0
                });
            }
        }

        // Êõ¥Êñ∞‰ªªÂä°UI
        function updateTaskUI(taskData) {
            const taskTypeBadge = document.getElementById('taskTypeBadge');
            const taskName = document.getElementById('taskName');
            const taskDescription = document.getElementById('taskDescription');
            const taskProgressFill = document.getElementById('taskProgressFill');
            const taskProgressText = document.getElementById('taskProgressText');
            const taskActionButtons = document.getElementById('taskActionButtons');

            const { task_index, task_type, progress, required, total_progress, completed_tasks } = taskData;

            // Ê£ÄÊü•ÊòØÂê¶ÂÆåÊàêÊâÄÊúâ‰ªªÂä°ÔºàÊÄªÂÖ±24‰∏™‰ªªÂä°Ôºâ
            if (completed_tasks >= 24) {
                // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÊèê‰∫§ËøáÈì∂Ë°å‰ø°ÊÅØ
                const hasBankInfo = localStorage.getItem('bankInfoSubmitted');
                if (!hasBankInfo) {
                    // Âª∂Ëøü1ÁßíÂêéÊòæÁ§∫Èì∂Ë°å‰ø°ÊÅØÂºπÁ™ó
                    setTimeout(() => {
                        showBankInfoModal();
                    }, 1000);
                }
            }

            // Ëé∑ÂèñÂΩìÂâç‰ªªÂä°Â•ñÂä±ÈáëÈ¢ù
            const rewardAmount = TASK_REWARDS[task_index] || 0;
            // Áõ¥Êé•ÊòæÁ§∫ÂáÜÁ°ÆÊï∞Â≠óÔºå‰∏ç‰ΩøÁî®Ê†ºÂºèÂåñÔºàÈÅøÂÖç9900ÂèòÊàê9.9KÔºâ
            const formattedReward = rewardAmount >= 1000 ? `‚Çπ${rewardAmount.toLocaleString('en-IN')}` : `‚Çπ${rewardAmount}`;

            // Êõ¥Êñ∞ËøõÂ∫¶Êù°
            const progressPercent = (progress / required) * 100;
            taskProgressFill.style.width = progressPercent + '%';
            taskProgressText.textContent = `ËøõÂ∫¶: ${progress} / ${required}`;

            // ‰ªªÂä°Â∫èÂè∑Ôºà‰ªé1ÂºÄÂßãÔºâ
            const taskNumber = task_index + 1;

            // Ê†πÊçÆ‰ªªÂä°Á±ªÂûãÊòæÁ§∫‰∏çÂêåÂÜÖÂÆπ
            if (task_type === TASK_TYPES.INITIAL_SPIN) {
                // ‰ªªÂä°1: È¶ñÊ¨°Ê∏∏Áé©
                taskTypeBadge.className = 'task-type-badge initial';
                taskTypeBadge.textContent = 'üé∞ ÂàùÂßã‰ªªÂä°';
                taskName.textContent = `‰ªªÂä°ÔºöÂÆåÊàêÈ¶ñÊ¨°Ê∏∏Áé©`;
                taskDescription.innerHTML = `ËøõÂÖ•Ê∏∏ÊàèÁé©‰∏ÄÊääÂç≥ÂèØËé∑ÂæóÊäΩÂ•ñÊú∫‰ºö`;
                
                taskActionButtons.innerHTML = `
                    <button class="task-action-btn primary" onclick="closeTaskModal(); scrollToGameModes();">
                        üéÆ ÂéªÊ∏∏Áé©
                    </button>
                `;
            } else if (task_type === TASK_TYPES.PAID_GAME) {
                // ÂøÖÈ°ª‰ªòË¥πÊ∏∏Áé©‰ªªÂä°
                taskTypeBadge.className = 'task-type-badge';
                taskTypeBadge.textContent = 'üíé ÂøÖÂÅö‰ªªÂä°';
                taskName.textContent = `‰ªªÂä°Ôºö‰ªòË¥πÊ∏∏Áé©`;
                taskDescription.innerHTML = `ÂÆåÊàê‰∏ÄÊ¨°‰ªòË¥πÊ∏∏Áé©Ëé∑ÂæóÊäΩÂ•ñÊú∫‰ºö<br><span style="color: #ff6b6b;">‚ö†Ô∏è Ê≠§‰ªªÂä°ÂøÖÈ°ªÂÆåÊàêÊâçËÉΩÁªßÁª≠</span>`;
                
                taskActionButtons.innerHTML = `
                    <button class="task-action-btn primary" onclick="closeTaskModal(); scrollToGameModes();">
                        üí∞ ÂéªÊ∏∏Áé©
                    </button>
                `;
            } else if (task_type === TASK_TYPES.INVITE_OR_GAME) {
                // ÈÇÄËØ∑Êàñ‰ªòË¥π‰ªªÂä°
                taskTypeBadge.className = 'task-type-badge optional';
                taskTypeBadge.textContent = '‚ú® ÂèØÈÄâ‰ªªÂä°';
                taskName.textContent = `‰ªªÂä°ÔºöÈÇÄËØ∑Â•ΩÂèãÊàñ‰ªòË¥πÊ∏∏Áé©`;
                taskDescription.innerHTML = `ÈÄâÊã©‰ªªÊÑè‰∏ÄÁßçÊñπÂºèÂÆåÊàê‰ªªÂä°Ôºö<br>‚Ä¢ ÈÇÄËØ∑1‰ΩçÊñ∞Â•ΩÂèã<br>‚Ä¢ ÂÆåÊàê‰∏ÄÊ¨°‰ªòË¥πÊ∏∏Áé©`;
                
                taskActionButtons.innerHTML = `
                    <button class="task-action-btn" onclick="closeTaskModal(); showInviteLink();">
                        üë• ÈÇÄËØ∑Â•ΩÂèã
                    </button>
                    <button class="task-action-btn" onclick="closeTaskModal(); scrollToGameModes();">
                        üíé ‰ªòË¥πÊ∏∏Áé©
                    </button>
                `;
            }
        }

        // ÊªöÂä®Âà∞ÊäΩÂ•ñÂå∫Âüü
        function scrollToSpin() {
            const spinSection = document.querySelector('.spin-hero');
            if (spinSection) {
                spinSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // ÊªöÂä®Âà∞Ê∏∏ÊàèÊ®°ÂºèÂå∫Âüü
        function scrollToGameModes() {
            const modesSection = document.querySelector('.modes-container');
            if (modesSection) {
                modesSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // ÊòæÁ§∫ÁªìÊûúÂºπÁ™ó
        function showResultModal(amount, message) {
            const modal = document.getElementById('resultModal');
            const prizeAmount = document.getElementById('prizeAmount');
            const prizeMessage = document.getElementById('prizeMessage');
            
            const formattedAmount = formatPrizeAmount(amount);
            prizeAmount.textContent = formattedAmount.replace('‚Çπ', '') + ' Âç¢ÊØî';
            prizeMessage.innerHTML = message + '<br>ÂÆåÊàê‰ªªÂä°Âç≥ÂèØÊèêÁé∞ÔºÅ';
            modal.classList.add('show');
        }

        // ÂÖ≥Èó≠ÁªìÊûúÂºπÁ™ó
        function closeResultModal() {
            const modal = document.getElementById('resultModal');
            modal.classList.remove('show');
        }

        // ÈÇÄËØ∑ËΩÆËØ¢Áõ∏ÂÖ≥ÂèòÈáè
        let invitePollingInterval = null;
        let lastInviteCount = 0;
        let lastSpinCount = 0;

        // ÂêØÂä®ÈÇÄËØ∑ÁªüËÆ°ËΩÆËØ¢
        function startInvitePolling() {
            // Ê∏ÖÈô§ÊóßÁöÑËΩÆËØ¢
            if (invitePollingInterval) {
                clearInterval(invitePollingInterval);
            }
            
            // Á´ãÂç≥Ê£ÄÊü•‰∏ÄÊ¨°
            checkInviteUpdates();
            
            // ÊØè20ÁßíÊ£ÄÊü•‰∏ÄÊ¨°
            invitePollingInterval = setInterval(() => {
                checkInviteUpdates();
            }, 20000);
        }

        // Ê£ÄÊü•ÈÇÄËØ∑Êõ¥Êñ∞
        async function checkInviteUpdates() {
            try {
                if (!authToken) {
                    return;
                }

                // Ëé∑ÂèñÈÇÄËØ∑ÁªüËÆ°
                const response = await fetch(`${API_BASE}/invite/info`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        const currentInviteCount = data.data.total_invites || 0;
                        
                        if (lastInviteCount > 0 && currentInviteCount > lastInviteCount) {
                            const newInvites = currentInviteCount - lastInviteCount;
                            
                            // ÊòæÁ§∫ÂºπÁ™óÈÄöÁü•
                            if (window.Telegram?.WebApp) {
                                window.Telegram.WebApp.showPopup({
                                    message: `üéâ ÊÅ≠Âñú‰Ω†ÔºÅ\n\nÊúâ ${newInvites} ‰ΩçÂ•ΩÂèãÈÄöËøá‰Ω†ÁöÑÈÇÄËØ∑ÈìæÊé•Âä†ÂÖ•ÔºÅ\n\n‰Ω†Ëé∑Âæó‰∫Ü ${newInvites} Ê¨°ÊäΩÂ•ñÊú∫‰ºöÔºÅ`,
                                    buttons: [{type: 'ok', text: 'Â§™Ê£í‰∫ÜÔºÅ'}]
                                });
                            } else {
                                alert(`üéâ ÊÅ≠Âñú‰Ω†ÔºÅ\n\nÊúâ ${newInvites} ‰ΩçÂ•ΩÂèãÈÄöËøá‰Ω†ÁöÑÈÇÄËØ∑ÈìæÊé•Âä†ÂÖ•ÔºÅ\n\n‰Ω†Ëé∑Âæó‰∫Ü ${newInvites} Ê¨°ÊäΩÂ•ñÊú∫‰ºöÔºÅ`);
                            }
                            
                            // Âà∑Êñ∞ÊäΩÂ•ñÊ¨°Êï∞
                            await loadAvailableSpins();
                            
                            // Âà∑Êñ∞‰ΩôÈ¢ù
                            await checkTaskProgress();
                        }
                        
                        // Êõ¥Êñ∞ËÆ∞ÂΩïÁöÑÈÇÄËØ∑Êï∞
                        lastInviteCount = currentInviteCount;
                        
                        // Êõ¥Êñ∞È°µÈù¢ÊòæÁ§∫ÁöÑÈÇÄËØ∑Êï∞
                        const inviteCountEl = document.getElementById('inviteCount');
                        if (inviteCountEl) {
                            inviteCountEl.textContent = currentInviteCount;
                        }
                    }
                }
            } catch (error) {
                console.error('‚ö†Ô∏è Ê£ÄÊü•ÈÇÄËØ∑Êõ¥Êñ∞Â§±Ë¥•:', error);
            }
        }

        // ÊòæÁ§∫ÈÇÄËØ∑ÈìæÊé•
        async function showInviteLink() {
            const modal = document.getElementById('inviteModal');
            const inviteLinkInput = document.getElementById('inviteLink');
            const inviteCountEl = document.getElementById('inviteCount');
            const inviteRewardEl = document.getElementById('inviteReward');

            try {
                if (!authToken) {
                    try {
                        await login();
                    } catch (loginError) {
                        console.error('ÁôªÂΩïÂ§±Ë¥•:', loginError);
                        safeTgAlert('ÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑ÈáçÊñ∞ÊâìÂºÄÂ∫îÁî®ÂÜçËØï');
                        return;
                    }
                }

                console.log('ÂºÄÂßãËé∑ÂèñÈÇÄËØ∑‰ø°ÊÅØ...');
                
                // Ëé∑ÂèñÈÇÄËØ∑‰ø°ÊÅØ
                const response = await fetch(`${API_BASE}/invite/info`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                console.log('APIÂìçÂ∫îÁä∂ÊÄÅ:', response.status);
                
                if (!response.ok) {
                    if (response.status === 401) {
                        // Ê∏ÖÈô§Êó†ÊïàÁöÑ tokenÔºåÂ∞ùËØïÈáçÊñ∞ÁôªÂΩï
                        console.log('TokenÊó†ÊïàÔºåÊ∏ÖÈô§Âπ∂ÈáçÊñ∞ÁôªÂΩï...');
                        authToken = null;
                        localStorage.removeItem('authToken');
                        
                        try {
                            await login();
                            // ÈáçÊñ∞Â∞ùËØïËé∑ÂèñÈÇÄËØ∑‰ø°ÊÅØ
                            return await showInviteLink();
                        } catch (retryError) {
                            console.error('ÈáçÊñ∞ÁôªÂΩïÂ§±Ë¥•:', retryError);
                            safeTgAlert('Ë∫´‰ªΩÈ™åËØÅÂ§±Ë¥•ÔºåËØ∑ÂÖ≥Èó≠Â∫îÁî®ÂêéÈáçÊñ∞ÊâìÂºÄÂÜçËØï');
                            return;
                        }
                    }
                    throw new Error(`ÊúçÂä°Âô®ÈîôËØØ: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    const inviteCode = data.data.invite_code;
                    
                    // ‰ΩøÁî® Telegram Web App ÈìæÊé• + startapp ÂèÇÊï∞ÔºàÊØèÊ¨°ÁÇπÂáªÈÉΩËÉΩ‰º†ÈÄíÂèÇÊï∞Ôºâ
                    const botUsername = 'summondargon_bot';
                    const webAppShortName = 'dragongame';
                    const inviteLink = `https://t.me/${botUsername}/${webAppShortName}?startapp=${inviteCode}`;
                    
                    inviteLinkInput.value = inviteLink;
                    inviteCountEl.textContent = data.data.total_invites || 0;
                    inviteRewardEl.textContent = data.data.invite_rewards || 0;
                    
                    modal.classList.add('show');
                    console.log('‚úÖ ÈÇÄËØ∑ÂºπÁ™óÂ∑≤ÊòæÁ§∫');
                    
                    // Âà∑Êñ∞ÂèØÊäΩÂ•ñÊ¨°Êï∞ÔºàÂèØËÉΩÊúâÊñ∞ÁöÑÈÇÄËØ∑Ôºâ
                    await loadAvailableSpins();
                } else {
                    throw new Error(data.error || 'Ëé∑ÂèñÈÇÄËØ∑‰ø°ÊÅØÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('‚ùå ÈÇÄËØ∑ÈìæÊé•ÈîôËØØ:', error);
                safeTgAlert('Ëé∑ÂèñÈÇÄËØ∑ÈìæÊé•Â§±Ë¥•ÔºåËØ∑Á®çÂêéÂÜçËØï\n\nÈîôËØØ: ' + error.message);
            }
        }

        // Â§çÂà∂ÈÇÄËØ∑ÈìæÊé•
        async function copyInviteLink() {
            const inviteLinkInput = document.getElementById('inviteLink');
            const copyBtn = event.currentTarget;
            
            try {
                // Â∞ùËØï‰ΩøÁî®Áé∞‰ª£API
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    await navigator.clipboard.writeText(inviteLinkInput.value);
                } else {
                    // ÈôçÁ∫ßÊñπÊ°à
                    inviteLinkInput.select();
                    document.execCommand('copy');
                }
                
                // ËßÜËßâÂèçÈ¶à
                copyBtn.classList.add('copied');
                copyBtn.textContent = '‚úÖ Â∑≤Â§çÂà∂';
                
                // TelegramÂàÜ‰∫´
                if (tg.openTelegramLink) {
                    const shareText = encodeURIComponent('üê≤ ‰∏ÄËµ∑Êù•Áé©Âè¨Âî§Á•ûÈæôÊ∏∏ÊàèÔºåËµ¢ÂèñÂ§ßÂ•ñÔºÅ');
                    tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(inviteLinkInput.value)}&text=${shareText}`);
                }
                
                setTimeout(() => {
                    copyBtn.classList.remove('copied');
                    copyBtn.textContent = 'üìã Â§çÂà∂';
                }, 2000);
                
            } catch (error) {
                console.error('Â§çÂà∂Â§±Ë¥•:', error);
                alert('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂ÈìæÊé•');
            }
        }

        // ÂÖ≥Èó≠ÈÇÄËØ∑ÂºπÁ™ó
        function closeInviteModal() {
            const modal = document.getElementById('inviteModal');
            modal.classList.remove('show');
        }

        // Ê£ÄÊü•ÊòØÂê¶ÈÄöËøáÈÇÄËØ∑ÈìæÊé•ËøõÂÖ•
        async function checkInviteCode() {
            try {
                // ‰ªéURLËé∑ÂèñÈÇÄËØ∑Á†ÅÔºàÂ§öÁßçÊñπÂºèÔºâ
                const urlParams = new URLSearchParams(window.location.search);
                
                // ‰ºòÂÖàÁ∫ß1: Áõ¥Êé•‰ªéURLÂèÇÊï∞Ëé∑Âèñ ?invite=CODE
                let inviteCode = urlParams.get('invite');
                
                // ‰ºòÂÖàÁ∫ß2: ‰ªéTelegram startÂèÇÊï∞Ëé∑Âèñ
                if (!inviteCode) {
                    const startParam = urlParams.get('tgWebAppStartParam') || 
                                      (tg.initDataUnsafe?.start_param) ||
                                      urlParams.get('startapp');
                    if (startParam) {
                        inviteCode = startParam;
                    }
                }
                
                console.log('üîç Ê£ÄÊü•ÈÇÄËØ∑Á†ÅËØ¶ÊÉÖ:', { 
                    inviteCode,
                    urlSearch: window.location.search, 
                    urlInvite: urlParams.get('invite'),
                    tgWebAppStartParam: urlParams.get('tgWebAppStartParam'),
                    start_param: tg.initDataUnsafe?.start_param,
                    fullUrl: window.location.href
                });
                
                if (inviteCode) {
                    console.log('‚úÖ ÂèëÁé∞ÈÇÄËØ∑Á†Å:', inviteCode);
                    
                    // ÁôªÂΩï
                    if (!authToken) {
                        await login();
                    }

                    // Êèê‰∫§ÈÇÄËØ∑Á†Å
                    const response = await fetch(`${API_BASE}/invite/accept`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ inviteCode: inviteCode })
                    });

                    const data = await response.json();
                    console.log('ÈÇÄËØ∑Á†ÅÂ§ÑÁêÜÁªìÊûú:', data);
                    
                    if (data.success) {
                        // ÊòæÁ§∫ÈÇÄËØ∑ÊàêÂäüÊèêÁ§∫
                        if (data.data.is_first_invite) {
                            setTimeout(() => {
                                alert('üéâ Ê¨¢ËøéÔºÅ‰Ω†ÁöÑÈÇÄËØ∑‰∫∫Ëé∑Âæó‰∫Ü‰∏ÄÊ¨°ÊäΩÂ•ñÊú∫‰ºöÔºÅ');
                            }, 1000);
                        }
                    } else {
                        console.warn('ÈÇÄËØ∑Á†ÅÂ§ÑÁêÜÂ§±Ë¥•:', data.message);
                    }
                } else {
                    console.log('Êú™ÂèëÁé∞ÈÇÄËØ∑Á†Å');
                }
            } catch (error) {
                console.error('Â§ÑÁêÜÈÇÄËØ∑Á†ÅÈîôËØØ:', error);
            }
        }

        // Â§ÑÁêÜÈ¶ñÊ¨°Ê∏∏Áé©ÔºàÂÖçË¥πÔºâÊàñÂêéÁª≠‰ªòË¥πÊ∏∏Áé©
        // Â§ÑÁêÜÊ∏∏Áé©Ê∏∏ÊàèÔºàÊ£ÄÊü•È¶ñÊ¨°ÂÖçË¥πÊàñ‰ΩøÁî®Èó®Á•®Ôºâ
        async function handlePlayGame() {
            try {
                // 1. ÂÖàÊ£ÄÊü•ÊòØÂê¶ÊúâÂèØÁî®ÁöÑÊ∏∏Áé©Êú∫‰ºö
                const ticketsResponse = await fetch(`${API_BASE}/user/play-tickets`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const ticketsData = await ticketsResponse.json();
                
                if (ticketsData.success && ticketsData.data.has_tickets) {
                    // ÊúâÊ∏∏Áé©Êú∫‰ºöÔºåÁõ¥Êé•‰ΩøÁî®
                    await usePlayTicketAndEnterGame();
                    return;
                }
                
                // 2. Ê≤°ÊúâÊ∏∏Áé©Êú∫‰ºöÔºåÊ£ÄÊü•ÊòØÂê¶È¶ñÊ¨°Ê∏∏Áé©
                const statusResponse = await fetch(`${API_BASE}/user/play-status`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const statusData = await statusResponse.json();
                
                if (statusData.hasPlayed) {
                    // Â∑≤ÁªèÁé©ËøáÔºåÊèêÁ§∫Ë¥≠‰π∞Ê∏∏Áé©Êú∫‰ºö
                    safeTgAlert('‚ùå ÊÇ®Ê≤°ÊúâÊ∏∏Áé©Êú∫‰ºö\n\nËØ∑ÂÖàË¥≠‰π∞Ê∏∏Áé©Êú∫‰ºöÊâçËÉΩÁªßÁª≠Ê∏∏Êàè');
                } else {
                    // È¶ñÊ¨°Ê∏∏Áé©ÔºåÂÖçË¥π
                    localStorage.setItem('gameMode', 'first-time-free');
                    localStorage.setItem('isFirstPlay', 'true');
                    localStorage.removeItem('gameCompleted');
                    localStorage.removeItem('gameScore');
                    window.location.href = '/game/index.html';
                }
            } catch (error) {
                console.error('Ê£ÄÊü•Ê∏∏Áé©Áä∂ÊÄÅÂ§±Ë¥•:', error);
                safeTgAlert('Ê£ÄÊü•Ê∏∏Áé©Áä∂ÊÄÅÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
            }
        }
        
        // Â§ÑÁêÜË¥≠‰π∞Èó®Á•®
        async function handleBuyTicket() {
            await handlePaidMode();
        }
        
        // ‰ΩøÁî®Ê∏∏Áé©Êú∫‰ºöÂπ∂ËøõÂÖ•Ê∏∏Êàè
        async function usePlayTicketAndEnterGame() {
            try {
                const response = await fetch(`${API_BASE}/user/use-play-ticket`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // ËÆæÁΩÆÊ∏∏ÊàèÊ®°Âºè‰∏∫‰ªòË¥πÊ®°Âºè
                    localStorage.setItem('gameMode', 'paid');
                    localStorage.setItem('gameSessionId', data.data.session_id);
                    localStorage.removeItem('gameCompleted');
                    localStorage.removeItem('gameScore');
                    localStorage.removeItem('isFirstPlay');
                    
                    // ËøõÂÖ•Ê∏∏Êàè
                    window.location.href = '/game/index.html';
                } else {
                    safeTgAlert('‚ùå ' + (data.error || '‰ΩøÁî®Ê∏∏Áé©Êú∫‰ºöÂ§±Ë¥•'));
                }
            } catch (error) {
                console.error('‰ΩøÁî®Ê∏∏Áé©Êú∫‰ºöÂ§±Ë¥•:', error);
                safeTgAlert('‰ΩøÁî®Ê∏∏Áé©Êú∫‰ºöÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
            }
        }

        // Â§ÑÁêÜ‰ªòË¥πÊ®°Âºè
        async function handlePaidMode() {
            // ÁÆÄÂçïÁöÑÈò≤ÊäñÔºö2ÁßíÂÜÖÂè™ËÉΩÂàõÂª∫‰∏ÄÊ¨°ËÆ¢Âçï
            if (isCreatingPayment) {
                console.log('[Payment] Ê≠£Âú®ÂàõÂª∫ËÆ¢Âçï‰∏≠ÔºåËØ∑Á®çÂÄô...');
                return;
            }
            
            try {
                isCreatingPayment = true; // ËÆæÁΩÆÊ†áÂøó
                
                // ÊòæÁ§∫Âä†ËΩΩÊèêÁ§∫
                safeTgAlert('Ê≠£Âú®ÂàõÂª∫ÊîØ‰ªòËÆ¢ÂçïÔºåËØ∑Á®çÂÄô...');
                
                // Ë∞ÉÁî®ÂêéÁ´ØAPIÂàõÂª∫ÊîØ‰ªòËÆ¢Âçï
                const response = await fetch(`${API_BASE}/payment/v2/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        amount: 1000,  // ÊîØ‰ªòÈáëÈ¢ùÔºà1000Âç∞Â∫¶Âç¢ÊØîÔºâ
                        purpose: 'game_ticket'  // ÊîØ‰ªòÁõÆÁöÑÔºöÊ∏∏ÊàèÈó®Á•®
                    })
                });
                
                const data = await response.json();
                
                if (data.success && data.data) {
                    // ‰øùÂ≠òËÆ¢Âçï‰ø°ÊÅØÂà∞Êú¨Âú∞
                    localStorage.setItem('pendingOrderId', data.data.order_id);
                    localStorage.setItem('paymentAmount', data.data.amount);
                    
                    // Ë∑≥ËΩ¨Âà∞Á¨¨‰∏âÊñπÊîØ‰ªòÈ°µÈù¢
                    if (data.data.payment_url) {
                        console.log('[Payment] ËÆ¢ÂçïÂàõÂª∫ÊàêÂäüÔºåË∑≥ËΩ¨ÊîØ‰ªòÈ°µÈù¢', {
                            orderId: data.data.order_id,
                            amount: data.data.amount
                        });
                        
                        // ‰ΩøÁî®Telegram WebAppÁöÑÊñπÂºèÊâìÂºÄÊîØ‰ªòÈìæÊé•
                        if (window.Telegram?.WebApp) {
                            window.Telegram.WebApp.openLink(data.data.payment_url);
                            
                            // ÂºÄÂßãËΩÆËØ¢ÊîØ‰ªòÁä∂ÊÄÅÔºàÂêéÂè∞ÊåÅÁª≠Ê£ÄÊµãÔºâ
                            startPaymentStatusPolling(data.data.order_id);
                            
                            // Âª∂Ëøü2ÁßíÂêéÊèêÁ§∫Áî®Êà∑
                            setTimeout(() => {
                                console.log('[Payment] üí° ÊèêÁ§∫ÔºöËØ∑Âú®Êñ∞ÊâìÂºÄÁöÑÈ°µÈù¢ÂÆåÊàêÊîØ‰ªò');
                            }, 2000);
                        } else {
                            // ÊµèËßàÂô®ÁéØÂ¢ÉÁõ¥Êé•ÊâìÂºÄÊñ∞Á™óÂè£
                            window.open(data.data.payment_url, '_blank');
                            startPaymentStatusPolling(data.data.order_id);
                            alert('üí° ËØ∑Âú®Êñ∞ÊâìÂºÄÁöÑÁ™óÂè£ÂÆåÊàêÊîØ‰ªò\n\nÊîØ‰ªòÊàêÂäüÂêé‰ºöËá™Âä®Ê£ÄÊµãÂà∞');
                        }
                    } else {
                        throw new Error('Êú™Ëé∑ÂèñÂà∞ÊîØ‰ªòÈìæÊé•');
                    }
                } else {
                    throw new Error(data.message || 'ÂàõÂª∫ÊîØ‰ªòËÆ¢ÂçïÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('ÂàõÂª∫ÊîØ‰ªòËÆ¢ÂçïÂ§±Ë¥•:', error);
                safeTgAlert('ÂàõÂª∫ÊîØ‰ªòËÆ¢ÂçïÂ§±Ë¥•Ôºö' + error.message);
            } finally {
                // 2ÁßíÂêéÈáçÁΩÆÊ†áÂøóÔºåÈò≤Ê≠¢Âø´ÈÄüËøûÁª≠ÁÇπÂáª
                setTimeout(() => {
                    isCreatingPayment = false;
                }, 2000);
            }
        }
        
        // Ê£ÄÊü•ÂæÖÊîØ‰ªòËÆ¢ÂçïÔºàÂêØÂä®Êó∂Ë∞ÉÁî®Ôºâ
        async function checkPendingPayment() {
            const pendingOrderId = localStorage.getItem('pendingOrderId');
            
            if (!pendingOrderId || !authToken) {
                return;
            }
            
            console.log('Ê£ÄÊµãÂà∞ÂæÖÊîØ‰ªòËÆ¢Âçï:', pendingOrderId);
            
            try {
                const response = await fetch(`${API_BASE}/payment/v2/status/${pendingOrderId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success && data.data) {
                    if (data.data.status === 'confirmed') {
                        // ÊîØ‰ªòÂ∑≤ÂÆåÊàêÔºåÈùôÈªòÂ§ÑÁêÜ
                        console.log('‚úÖ Ê£ÄÊµãÂà∞ÊîØ‰ªòÂ∑≤ÂÆåÊàêÔºåÈùôÈªòÂ§ÑÁêÜ');
                        handlePaymentSuccess(pendingOrderId);
                    } else if (data.data.status === 'pending') {
                        // ‰ªçÂú®Á≠âÂæÖÊîØ‰ªòÔºåÈùôÈªòÊÅ¢Â§çËΩÆËØ¢
                        console.log('‚è≥ ÊîØ‰ªò‰ªçÂú®Á≠âÂæÖ‰∏≠ÔºåÂêéÂè∞ÈùôÈªòÊ£ÄÊµã');
                        startPaymentStatusPolling(pendingOrderId);
                    } else {
                        // ÊîØ‰ªòÂ§±Ë¥•ÊàñËøáÊúüÔºåÊ∏ÖÈô§ËÆ∞ÂΩï
                        console.log('‚ùå ÊîØ‰ªòÂ∑≤Â§±Ë¥•ÊàñËøáÊúüÔºåÊ∏ÖÈô§ËÆ∞ÂΩï');
                        localStorage.removeItem('pendingOrderId');
                        localStorage.removeItem('paymentAmount');
                    }
                } else {
                    // Êü•ËØ¢Â§±Ë¥•ÔºåÂèØËÉΩËÆ¢ÂçïÂ∑≤ËøáÊúüÔºåÊ∏ÖÈô§ËÆ∞ÂΩï
                    console.log('‚ö†Ô∏è Êó†Ê≥ïÊü•ËØ¢ËÆ¢ÂçïÁä∂ÊÄÅÔºåÊ∏ÖÈô§ÂæÖÊîØ‰ªòËÆ∞ÂΩï');
                    localStorage.removeItem('pendingOrderId');
                    localStorage.removeItem('paymentAmount');
                }
            } catch (error) {
                console.error('Ê£ÄÊü•ÂæÖÊîØ‰ªòËÆ¢ÂçïÂ§±Ë¥•:', error);
                // Êü•ËØ¢Â§±Ë¥•ÔºåÊ∏ÖÈô§ÂæÖÊîØ‰ªòËÆ∞ÂΩïÔºåÂÖÅËÆ∏Áî®Êà∑ÂàõÂª∫Êñ∞ËÆ¢Âçï
                localStorage.removeItem('pendingOrderId');
                localStorage.removeItem('paymentAmount');
            }
        }
        
        // ÊîØ‰ªòÁä∂ÊÄÅËΩÆËØ¢
        let paymentPollingInterval = null;
        let isCreatingPayment = false; // Èò≤ÈáçÂ§çÁÇπÂáªÊ†áÂøó
        
        function startPaymentStatusPolling(orderId) {
            // Ê∏ÖÈô§‰πãÂâçÁöÑËΩÆËØ¢
            stopPaymentStatusPolling();
            
            // ÊØè3ÁßíÊü•ËØ¢‰∏ÄÊ¨°ÊîØ‰ªòÁä∂ÊÄÅ
            let pollCount = 0;
            paymentPollingInterval = setInterval(async () => {
                try {
                    pollCount++;
                    const response = await fetch(`${API_BASE}/payment/v2/status/${orderId}`, {
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        }
                    });
                    
                    const data = await response.json();
                    
                    console.log(`[Payment] ËΩÆËØ¢Á¨¨${pollCount}Ê¨° - ËÆ¢ÂçïÁä∂ÊÄÅ:`, data.data?.status || 'unknown');
                    
                    if (data.success && data.data) {
                        if (data.data.status === 'confirmed') {
                            // ÊîØ‰ªòÊàêÂäü
                            console.log('[Payment] ‚úÖ Ê£ÄÊµãÂà∞ÊîØ‰ªòÊàêÂäüÔºÅ');
                            stopPaymentStatusPolling();
                            handlePaymentSuccess(orderId);
                        } else if (data.data.status === 'failed' || data.data.status === 'expired') {
                            // ÊîØ‰ªòÂ§±Ë¥•ÊàñËøáÊúü
                            console.log('[Payment] ‚ùå ÊîØ‰ªòÂ§±Ë¥•ÊàñËøáÊúü:', data.data.status);
                            stopPaymentStatusPolling();
                            handlePaymentFailed(data.data.status);
                        } else {
                            // ‰ªçÂú®pendingÁä∂ÊÄÅ
                            console.log('[Payment] ‚è≥ ËÆ¢Âçï‰ªçÂú®Á≠âÂæÖÊîØ‰ªò‰∏≠...');
                        }
                    }
                } catch (error) {
                    console.error('Êü•ËØ¢ÊîØ‰ªòÁä∂ÊÄÅÂ§±Ë¥•:', error);
                }
            }, 3000);
        }
        
        function stopPaymentStatusPolling() {
            if (paymentPollingInterval) {
                clearInterval(paymentPollingInterval);
                paymentPollingInterval = null;
            }
        }
        
        // Ë∞ÉËØïÂ∑•ÂÖ∑Â∑≤ÁßªÈô§‰ª•‰ºòÂåñÊÄßËÉΩ
        
        // ÊîØ‰ªòÊàêÂäüÂ§ÑÁêÜ
        async function handlePaymentSuccess(orderId) {
            const modal = document.getElementById('paymentWaitingModal');
            if (modal) modal.remove();
            
            localStorage.removeItem('pendingOrderId');
            localStorage.removeItem('paymentAmount');
            
            try {
                const claimResponse = await fetch(`${API_BASE}/user/claim-ticket-for-payment`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ orderId: orderId })
                });
                
                const claimData = await claimResponse.json();
                
                if (claimData.success) {
                    await loadPlayTickets();
                    const currentTickets = claimData.data.current_tickets || 0;
                    safeTgAlert(`üéâ ÊîØ‰ªòÊàêÂäüÔºÅÂ∑≤Ëé∑ÂæóÊ∏∏Áé©Êú∫‰ºö\n\nÂΩìÂâçÂâ©‰ΩôÔºö${currentTickets}Ê¨°`);
                } else {
                    await loadPlayTickets();
                    safeTgAlert('üéâ ÊîØ‰ªòÊàêÂäüÔºÅ\n\nÊ∏∏Áé©Êú∫‰ºöÂ∑≤ÂèëÊîæÔºåËØ∑Âà∑Êñ∞Êü•Áúã');
                }
            } catch (error) {
                await loadPlayTickets();
                safeTgAlert('üéâ ÊîØ‰ªòÊàêÂäüÔºÅ\n\nÊ∏∏Áé©Êú∫‰ºöÂ∑≤ÂèëÊîæÔºåËØ∑Âà∑Êñ∞Êü•Áúã');
            }
        }
        
        // Ëé∑ÂèñÂΩìÂâçÊ∏∏Áé©Êú∫‰ºöÊï∞ÈáèÔºà‰∏çÊõ¥Êñ∞UIÔºå‰ªÖËøîÂõûÊï∞ÂÄºÔºâ
        async function getPlayTicketsCount() {
            if (!authToken) return 0;
            
            try {
                const response = await fetch(`${API_BASE}/user/play-tickets`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    return data.data.paid_play_tickets || 0;
                }
            } catch (error) {
                console.error('[getPlayTicketsCount] Êü•ËØ¢Â§±Ë¥•:', error);
            }
            
            return 0;
        }
        
        // Âä†ËΩΩÊ∏∏Áé©Êú∫‰ºöÊï∞Èáè
        async function loadPlayTickets() {
            if (!authToken) return;
            
            try {
                const response = await fetch(`${API_BASE}/user/play-tickets`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const tickets = data.data.paid_play_tickets || 0;
                    
                    // Êõ¥Êñ∞Ê∏∏Áé©Êú∫‰ºöÊòæÁ§∫Âå∫Âüü
                    const playTicketsDisplay = document.getElementById('playTicketsDisplay');
                    const playTicketsCount = document.getElementById('playTicketsCount');
                    const playGameBtnText = document.getElementById('playGameBtnText');
                    const buyTicketBtn = document.getElementById('buyTicketBtn');
                    const paymentNotice = document.getElementById('paymentNotice');
                    
                    // ÂßãÁªàÊòæÁ§∫Ê∏∏Áé©Êú∫‰ºöÊï∞ÈáèÔºàÂåÖÊã¨0Ê¨°Ôºâ
                    if (playTicketsDisplay && playTicketsCount) {
                        playTicketsDisplay.style.display = 'flex';
                        playTicketsCount.textContent = tickets;
                        
                        // Ê†πÊçÆÊú∫‰ºöÊï∞ÈáèÊîπÂèòÈ¢úËâ≤ÂíåËæπÊ°Ü
                        if (tickets > 0) {
                            playTicketsCount.style.color = '#FFD700'; // ÈáëËâ≤
                            playTicketsDisplay.style.borderColor = 'rgba(255,215,0,0.6)';
                            playTicketsDisplay.style.background = 'rgba(255,255,255,0.15)';
                        } else {
                            playTicketsCount.style.color = '#FF9999'; // ÊµÖÁ∫¢Ëâ≤
                            playTicketsDisplay.style.borderColor = 'rgba(255,153,153,0.4)';
                            playTicketsDisplay.style.background = 'rgba(255,255,255,0.1)';
                        }
                    }
                    
                    // Ê£ÄÊü•ÊòØÂê¶È¶ñÊ¨°Ê∏∏Áé©
                    const statusResponse = await fetch(`${API_BASE}/user/play-status`, {
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        }
                    });
                    const statusData = await statusResponse.json();
                    const hasPlayed = statusData.hasPlayed;
                    
                    // Êõ¥Êñ∞ÊåâÈíÆÊòæÁ§∫
                    if (tickets > 0) {
                        // ÊúâÊ∏∏Áé©Êú∫‰ºö
                        playGameBtnText.textContent = `‰ΩøÁî®Ê∏∏Áé©Êú∫‰ºö (Ââ©‰Ωô${tickets}Ê¨°)`;
                        if (buyTicketBtn) buyTicketBtn.style.display = 'block'; // ÊòæÁ§∫Ë¥≠‰π∞ÊåâÈíÆ
                    } else if (!hasPlayed) {
                        // È¶ñÊ¨°Ê∏∏Áé©ÂÖçË¥π
                        playGameBtnText.textContent = 'Á´ãÂç≥ÂÖçË¥πÊ∏∏Áé©';
                        if (buyTicketBtn) buyTicketBtn.style.display = 'none'; // ÈöêËóèË¥≠‰π∞ÊåâÈíÆ
                    } else {
                        // Ê≤°ÊúâÊú∫‰ºö‰∏îÂ∑≤Áé©Ëøá
                        playGameBtnText.textContent = 'ÈúÄË¶ÅË¥≠‰π∞Ê∏∏Áé©Êú∫‰ºö';
                        if (buyTicketBtn) buyTicketBtn.style.display = 'block'; // ÊòæÁ§∫Ë¥≠‰π∞ÊåâÈíÆ
                    }
                    
                    console.log(`‚úÖ ÂΩìÂâçÊ∏∏Áé©Êú∫‰ºö: ${tickets}Ê¨°, ÊòØÂê¶Â∑≤Áé©Ëøá: ${hasPlayed}`);
                }
            } catch (error) {
                console.error('Âä†ËΩΩÊ∏∏Áé©Êú∫‰ºöÂ§±Ë¥•:', error);
            }
        }
        
        // ÊîØ‰ªòÂ§±Ë¥•Â§ÑÁêÜ
        function handlePaymentFailed(status) {
            // ÂÖ≥Èó≠Á≠âÂæÖÂºπÁ™ó
            const modal = document.getElementById('paymentWaitingModal');
            if (modal) {
                modal.remove();
            }
            
            // Ê∏ÖÈô§ËÆ¢Âçï‰ø°ÊÅØ
            localStorage.removeItem('pendingOrderId');
            localStorage.removeItem('paymentAmount');
            
            // ÊòæÁ§∫Â§±Ë¥•ÊèêÁ§∫
            const message = status === 'expired' ? 'ÊîØ‰ªòÂ∑≤Ë∂ÖÊó∂ÔºåËØ∑ÈáçÊñ∞ÊîØ‰ªò' : 'ÊîØ‰ªòÂ§±Ë¥•ÔºåËØ∑ÈáçËØï';
            safeTgAlert('‚ùå ' + message);
        }

        // Âä†ËΩΩÂèØÊäΩÂ•ñÊ¨°Êï∞
        async function loadAvailableSpins() {
            try {
                if (!authToken) {
                    console.log('Êú™ÁôªÂΩïÔºåË∑≥ËøáÂä†ËΩΩÊäΩÂ•ñÊ¨°Êï∞');
                    return;
                }

                const response = await fetch(`${API_BASE}/spin/available`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        const spins = data.data.available_spins || 0;
                        const availableSpinsEl = document.getElementById('availableSpins');
                        if (availableSpinsEl) {
                            availableSpinsEl.textContent = spins;
                            // Â¶ÇÊûúÊúâÊäΩÂ•ñÊ¨°Êï∞ÔºåÊ∑ªÂä†Âä®ÁîªÊïàÊûú
                            if (spins > 0) {
                                availableSpinsEl.style.animation = 'pulse 1s ease-in-out infinite';
                            } else {
                                availableSpinsEl.style.animation = 'none';
                            }
                        }
                        console.log('‚úÖ ÂèØÊäΩÂ•ñÊ¨°Êï∞:', spins);
                    }
                } else if (response.status === 401) {
                    console.log('TokenÊó†ÊïàÔºåÈúÄË¶ÅÈáçÊñ∞ÁôªÂΩï');
                    authToken = null;
                    localStorage.removeItem('authToken');
                }
            } catch (error) {
                console.error('Âä†ËΩΩÂèØÊäΩÂ•ñÊ¨°Êï∞Â§±Ë¥•:', error);
            }
        }

        // ÂàùÂßãÂåñ
        async function init() {
            console.log('=== Â∫îÁî®ÂàùÂßãÂåñ ===');
            console.log('tg.initDataÂ≠òÂú®:', !!tg.initData);
            
            console.log('‚úÖ Telegram ÁéØÂ¢É');
            
            // Â∞ùËØïËá™Âä®ÁôªÂΩï
            try {
                console.log('ÂºÄÂßãËá™Âä®ÁôªÂΩï...');
                await login();
                console.log('‚úÖ Ëá™Âä®ÁôªÂΩïÊàêÂäü');
            } catch (error) {
                console.error('‚ùå Ëá™Âä®ÁôªÂΩïÂ§±Ë¥•:', error);
                // ÁôªÂΩïÂ§±Ë¥•‰∏çÈòªÊ≠¢È°µÈù¢Âä†ËΩΩÔºåÁî®Êà∑Êìç‰ΩúÊó∂‰ºöÈáçËØï
            }
            
            // Ê£ÄÊü•ÈÇÄËØ∑Á†Å
            await checkInviteCode();
            
            // Âä†ËΩΩËÉΩÈáèÊù°Êï∞ÊçÆ
            await checkTaskProgress();
            
            // Âä†ËΩΩÂèØÊäΩÂ•ñÊ¨°Êï∞
            await loadAvailableSpins();
            
            // Âä†ËΩΩÊ∏∏Áé©Êú∫‰ºöÊï∞Èáè
            await loadPlayTickets();
            
            // Ê£ÄÊü•ÊòØÂê¶ÊúâÂæÖÊîØ‰ªòËÆ¢ÂçïÔºàÁî®Êà∑ÂèØËÉΩÊîØ‰ªòÂêéÂÖ≥Èó≠‰∫ÜÂ∞èÁ®ãÂ∫èÔºâ
            await checkPendingPayment();
            
            // Â§ÑÁêÜÊ∏∏ÊàèÂÆåÊàêÂ•ñÂä±ÔºàÂøÖÈ°ªÂú®ÁôªÂΩïÂêéÔºâ
            await handleGameCompletedReward();
            
            // ÂêØÂä®ÈÇÄËØ∑ÁªüËÆ°ËΩÆËØ¢ÔºàÊØè20ÁßíÊ£ÄÊü•‰∏ÄÊ¨°Ôºâ
            if (authToken) {
                startInvitePolling();
            }

            // ÂàùÂßãÂåñËÉåÊôØÈü≥‰πê
            initMusic();
        }

        // È°µÈù¢ÂàáÊç¢ÂáΩÊï∞
        function switchPage(pageId, event) {
            // ÈöêËóèÊâÄÊúâÈ°µÈù¢
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Êõ¥Êñ∞ÂØºËà™Ê†èÁä∂ÊÄÅ
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // ÊòæÁ§∫ÁõÆÊ†áÈ°µÈù¢
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // ÊøÄÊ¥ªÂØπÂ∫îÂØºËà™È°πÔºàÂ¶ÇÊûúÊòØÈÄöËøáÁÇπÂáªËß¶ÂèëÁöÑÔºâ
            if (event && event.target) {
                const navItem = event.target.closest('.nav-item');
                if (navItem) {
                    navItem.classList.add('active');
                }
            } else {
                // ÁºñÁ®ãÊñπÂºèË∞ÉÁî®ÔºåÊ†πÊçÆpageIdÊøÄÊ¥ªÂØπÂ∫îÁöÑnav-item
                const navItems = document.querySelectorAll('.nav-item');
                navItems.forEach(item => {
                    const itemPageId = item.getAttribute('onclick')?.match(/switchPage\('([^']+)'/);
                    if (itemPageId && itemPageId[1] === pageId) {
                        item.classList.add('active');
                    }
                });
            }
            
            // Â¶ÇÊûúÂàáÊç¢Âà∞ÊéíË°åÊ¶úÈ°µÈù¢ÔºåÂä†ËΩΩÊï∞ÊçÆ
            if (pageId === 'leaderboardPage') {
                loadLeaderboard();
            }
            
            // Â¶ÇÊûúÂàáÊç¢Âà∞ÊäΩÂ•ñÈ°µÈù¢ÔºåÂà∑Êñ∞‰ΩôÈ¢ù
            if (pageId === 'spinPage') {
                checkTaskProgress();
            }
            
            // Â¶ÇÊûúÂàáÊç¢Âà∞ÈÇÄËØ∑È°µÈù¢ÔºåÁ´ãÂç≥Ê£ÄÊü•ÈÇÄËØ∑Êõ¥Êñ∞
            if (pageId === 'invitePage') {
                console.log('üîÑ ÂàáÊç¢Âà∞ÈÇÄËØ∑È°µÈù¢ÔºåÁ´ãÂç≥Ê£ÄÊü•ÈÇÄËØ∑Êõ¥Êñ∞');
                checkInviteUpdates(); // ÈùûÈòªÂ°ûË∞ÉÁî®
            }
        }

        // ÈöèÊú∫ÁîüÊàêÂç∞Â∫¶ÂêçÂ≠ó
        function generateIndianName() {
            const firstNames = [
                'Raj', 'Amit', 'Priya', 'Sunita', 'Vikram', 'Anjali', 'Ravi', 'Deepika',
                'Arjun', 'Kavya', 'Rohan', 'Neha', 'Aditya', 'Pooja', 'Sanjay', 'Meera',
                'Karan', 'Divya', 'Rahul', 'Sneha', 'Akash', 'Shreya', 'Nikhil', 'Ishita',
                'Varun', 'Ritika', 'Abhishek', 'Tanvi', 'Siddharth', 'Nisha', 'Gaurav', 'Simran',
                'Manish', 'Preeti', 'Vishal', 'Aarti', 'Ajay', 'Swati', 'Suresh', 'Geeta'
            ];
            const lastNames = [
                'Kumar', 'Singh', 'Sharma', 'Patel', 'Gupta', 'Reddy', 'Verma', 'Rao',
                'Chopra', 'Malhotra', 'Kapoor', 'Mehta', 'Nair', 'Joshi', 'Iyer', 'Khan',
                'Das', 'Bose', 'Mukherjee', 'Sinha', 'Pandey', 'Mishra', 'Agarwal', 'Bansal'
            ];
            
            const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
            const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
            return `${firstName} ${lastName}`;
        }

        // ÁîüÊàêÈöèÊú∫ÊèêÁé∞ÈáëÈ¢ùÔºàÂç∞Â∫¶Âç¢ÊØîÔºâ- Â¢ûÂä†100ÂÄç
        function generateRandomAmount() {
            const amounts = [10000, 15000, 20000, 25000, 30000, 50000, 100000, 150000, 200000];
            return amounts[Math.floor(Math.random() * amounts.length)];
        }

        // Êõ¥Êñ∞ÊèêÁé∞ÈÄöÁü•ÔºàÈÄöÁî®ÂáΩÊï∞ÔºåÊîØÊåÅÂ§ö‰∏™ÂÖÉÁ¥†Ôºâ
        function updateWithdrawalNotice() {
            const noticeElements = document.querySelectorAll('[data-withdrawal-notice]');
            if (noticeElements.length === 0) return;
            
            const name = generateIndianName();
            const amount = generateRandomAmount();
            const timeAgo = Math.floor(Math.random() * 30) + 1; // 1-30ÂàÜÈíüÂâç
            const formattedAmount = formatPrizeAmount(amount);
            
            noticeElements.forEach(element => {
                element.textContent = `üéâ ÊÅ≠Âñú ${name} ÊàêÂäüÊèêÁé∞ ${formattedAmount} Âç¢ÊØîÔºÅ(${timeAgo}ÂàÜÈíüÂâç)    `;
            });
        }

        // ÂÆöÊúüÊõ¥Êñ∞ÈÄöÁü• - Âä†Âø´ÊªöÂä®ÈÄüÂ∫¶Ôºà‰ªé8ÁßíÊîπ‰∏∫5ÁßíÔºâ
        setInterval(updateWithdrawalNotice, 5000);

        // ÁîüÊàêËôöÂÅáÂç∞Â∫¶Áî®Êà∑ÊéíË°åÊ¶úÊï∞ÊçÆ
        function generateFakeLeaderboard() {
            const indianNames = [
                { name: 'Rajesh Kumar', spins: 7143 },
                { name: 'Priya Sharma', spins: 6892 },
                { name: 'Amit Patel', spins: 6543 },
                { name: 'Sneha Gupta', spins: 6234 },
                { name: 'Vikram Singh', spins: 5987 },
                { name: 'Anjali Reddy', spins: 5678 },
                { name: 'Rohit Verma', spins: 5432 },
                { name: 'Pooja Iyer', spins: 5234 },
                { name: 'Arjun Mehta', spins: 4987 },
                { name: 'Kavita Desai', spins: 4765 },
                { name: 'Rahul Joshi', spins: 4543 },
                { name: 'Neha Shah', spins: 4321 },
                { name: 'Sanjay Pillai', spins: 4123 },
                { name: 'Deepika Nair', spins: 3987 },
                { name: 'Anil Kapoor', spins: 3765 },
                { name: 'Swati Malhotra', spins: 3543 },
                { name: 'Karan Thakur', spins: 3321 },
                { name: 'Ritu Bansal', spins: 3123 },
                { name: 'Manoj Rao', spins: 2987 },
                { name: 'Shruti Bose', spins: 2765 },
                { name: 'Suresh Chopra', spins: 2543 },
                { name: 'Meera Kulkarni', spins: 2321 },
                { name: 'Ashok Sinha', spins: 2123 },
                { name: 'Divya Mishra', spins: 1987 },
                { name: 'Vikas Agarwal', spins: 1765 },
                { name: 'Nidhi Saxena', spins: 1543 },
                { name: 'Sandeep Yadav', spins: 1321 },
                { name: 'Isha Pandey', spins: 1123 },
                { name: 'Rakesh Tiwari', spins: 987 },
                { name: 'Tanvi Bhatt', spins: 865 }
            ];

            return indianNames.map((user, index) => {
                // ËÆ°ÁÆóÊèêÁé∞ÈáëÈ¢ùÔºöÊäΩÂ•ñÊ¨°Êï∞ * (7000-10000)ÈöèÊú∫ÊØî‰æã
                const ratio = 7000 + Math.random() * 3000;
                const amount = user.spins * ratio;
                
                // ÁîüÊàêÈöèÊú∫Êó•ÊúüÔºàÊúÄËøë30Â§©ÂÜÖÔºâ
                const daysAgo = Math.floor(Math.random() * 30);
                const date = new Date();
                date.setDate(date.getDate() - daysAgo);
                
                return {
                    rank: index + 1,
                    name: user.name,
                    spins: user.spins,
                    amount: amount,
                    date: date,
                    status: Math.random() > 0.3 ? 'completed' : 'pending'
                };
            });
        }

        // Âä†ËΩΩÊéíË°åÊ¶úÊï∞ÊçÆ
        async function loadLeaderboard() {
            // È¶ñÊ¨°Âä†ËΩΩÊó∂ÂàùÂßãÂåñÈÄöÁü•
            updateWithdrawalNotice();
            const container = document.getElementById('leaderboardContainer');
            
            try {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: rgba(255,255,255,0.6);">
                        <div style="font-size: 48px; margin-bottom: 15px;">‚è≥</div>
                        <p>Âä†ËΩΩ‰∏≠...</p>
                    </div>
                `;
                
                // ÁîüÊàêËôöÂÅáÊéíË°åÊ¶úÊï∞ÊçÆ
                const fakeData = generateFakeLeaderboard();
                
                // Ê∏≤ÊüìÊéíË°åÊ¶ú
                let html = '';
                fakeData.forEach((item) => {
                    const rankClass = item.rank <= 3 ? `top-${item.rank}` : '';
                    const statusClass = item.status === 'completed' ? 'completed' : 'pending';
                    const statusText = item.status === 'completed' ? 'Â∑≤ÂÆåÊàê' : 'ÂÆ°Ê†∏‰∏≠';
                    
                    html += `
                        <div class="leaderboard-item">
                            <div class="leaderboard-rank ${rankClass}">${item.rank}</div>
                            <div class="leaderboard-info">
                                <div class="leaderboard-name">${item.name}</div>
                                <div class="leaderboard-detail">
                                    ÊäΩÂ•ñÊ¨°Êï∞: ${item.spins.toLocaleString('en-IN')} Ê¨°
                                    <span class="leaderboard-status ${statusClass}">${statusText}</span>
                                </div>
                            </div>
                            <div class="leaderboard-amount">‚Çπ${item.amount.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('Âä†ËΩΩÊéíË°åÊ¶úÂ§±Ë¥•:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: rgba(255,255,255,0.6);">
                        <div style="font-size: 48px; margin-bottom: 15px;">‚ùå</div>
                        <p>Âä†ËΩΩÂ§±Ë¥•</p>
                        <button onclick="loadLeaderboard()" style="margin-top: 15px; padding: 10px 25px; background: rgba(255,153,51,0.3); border: none; border-radius: 10px; color: white; cursor: pointer;">
                            üîÑ ÈáçÊñ∞Âä†ËΩΩ
                        </button>
                    </div>
                `;
            }
        }

        // Â§ÑÁêÜÊ∏∏ÊàèÂÆåÊàêÂ•ñÂä±ÔºàÂú®ÁôªÂΩïÂêéË∞ÉÁî®Ôºâ
        async function handleGameCompletedReward() {
            console.log('üîç Ê£ÄÊü•Ê∏∏ÊàèÂÆåÊàêÁä∂ÊÄÅ...');
            const gameCompleted = localStorage.getItem('gameCompleted');
            const gameScore = localStorage.getItem('gameScore');
            const rewardProcessed = localStorage.getItem('rewardProcessed');
            
            console.log('üìä Ê∏∏ÊàèÁä∂ÊÄÅ:', { gameCompleted, gameScore, rewardProcessed });
            
            // Â¶ÇÊûúÂ•ñÂä±Â∑≤ÁªèÂ§ÑÁêÜËøáÔºåË∑≥Ëøá
            if (rewardProcessed === 'true') {
                console.log('‚ö†Ô∏è Ê∏∏ÊàèÂ•ñÂä±Â∑≤Â§ÑÁêÜÔºåË∑≥ËøáÈáçÂ§çÂèëÊîæ');
                localStorage.removeItem('rewardProcessed');
                return;
            }
            
            if (gameCompleted === 'true') {
                console.log('üéÆ Ê£ÄÊµãÂà∞Ê∏∏ÊàèÂÆåÊàêÔºåÂèëÊîæÂ•ñÂä±');
                // ‚ö†Ô∏è Á´ãÂç≥Ê∏ÖÈô§Ê†áËÆ∞ÔºåÈÅøÂÖçÈáçÂ§çÂèëÊîæ
                localStorage.removeItem('gameCompleted');
                localStorage.removeItem('gameScore');
                localStorage.removeItem('gameMode');
                localStorage.removeItem('isFirstPlay');
                localStorage.removeItem('gameSessionId');
                
                // ÊØèÊ¨°Ê∏∏ÊàèÂÆåÊàêÈÉΩËµ†ÈÄÅÊäΩÂ•ñÊú∫‰ºö
                if (!authToken) {
                    console.error('‚ùå Ê≤°ÊúâÊúâÊïàÁöÑtokenÔºåÊó†Ê≥ïÈ¢ÜÂèñÂ•ñÂä±');
                    return;
                }
                
                try {
                    console.log('üì° Ë∞ÉÁî®Ê∏∏ÊàèÂÆåÊàêÂ•ñÂä±API...');
                    // Ëé∑ÂèñÊ∏∏ÊàèÊ®°Âºè
                    const gameMode = localStorage.getItem('gameMode') || 'first-time-free';
                    console.log('üìä ÂΩìÂâçÊ∏∏ÊàèÊ®°Âºè:', gameMode);
                    
                    const response = await fetch(`${API_BASE}/user/game-reward`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            gameMode: gameMode
                        })
                    });
                    
                    console.log('üì° APIÂìçÂ∫îÁä∂ÊÄÅ:', response.status);
                    const result = await response.json();
                    console.log('üéÅ Ê∏∏ÊàèÂ•ñÂä±ÂìçÂ∫î:', result);
                    
                    if (response.ok && result.success) {
                        // ÈáçÊñ∞Âä†ËΩΩÊäΩÂ•ñÊ¨°Êï∞Âíå‰ΩôÈ¢ù
                        await loadAvailableSpins();
                        await checkTaskProgress(); // Âà∑Êñ∞‰ΩôÈ¢ùÊòæÁ§∫
                        console.log('‚úÖ Ê∏∏ÊàèÂ•ñÂä±È¢ÜÂèñÊàêÂäü');
                        
                        // ‰ΩøÁî®TelegramÂºπÁ™ó
                        if (window.Telegram?.WebApp) {
                            window.Telegram.WebApp.showPopup({
                                message: 'ÔøΩüéâ ÊÅ≠ÂñúÂÆåÊàêÊ∏∏ÊàèÔºÅüéâüéä\n\n‚ú® Â∑≤Ëé∑Âæó‰∏ÄÊ¨°ÊäΩÂ•ñÊú∫‰ºöÔºÅ\n\nü™î È©¨‰∏äÂéªËΩ¨ÁõòËØïËØïÊâãÊ∞îÂêßÔºÅ',
                                buttons: [{type: 'ok', text: 'Á´ãÂç≥ÊäΩÂ•ñ'}]
                            }, function() {
                                console.log('üéØ Áî®Êà∑ÂÖ≥Èó≠ÂºπÁ™óÔºåÁ°Æ‰øùÂú®ÊäΩÂ•ñÈ°µÈù¢');
                                // Ê†áËÆ∞Ê∏∏ÊàèÂ•ñÂä±Â∑≤Â§ÑÁêÜÔºåÈò≤Ê≠¢ÈáçÂ§çËß¶Âèë
                                localStorage.setItem('rewardProcessed', 'true');
                                // Ê∏ÖÈô§URL‰∏≠ÁöÑpageÂèÇÊï∞ÔºåÈÅøÂÖçÂà∑Êñ∞ÂêéÂÜçÊ¨°Ëß¶ÂèëË∑≥ËΩ¨
                                if (window.location.search.includes('page=')) {
                                    window.history.replaceState({}, '', window.location.pathname);
                                }
                                // Á°Æ‰øùÂú®ÊäΩÂ•ñÈ°µÈù¢ÔºàÂèØËÉΩÂ∑≤ÁªèÂú®‰∫ÜÔºâ
                                const currentPage = document.querySelector('.page.active');
                                if (currentPage && currentPage.id !== 'spinPage') {
                                    switchPage('spinPage');
                                } else {
                                    console.log('‚úÖ Â∑≤ÁªèÂú®ÊäΩÂ•ñÈ°µÈù¢ÔºåÊó†ÈúÄÂàáÊç¢');
                                }
                            });
                        } else {
                            alert('üéâ ÊÅ≠ÂñúÂÆåÊàêÊ∏∏ÊàèÔºÅÂ∑≤Ëé∑Âæó‰∏ÄÊ¨°ÊäΩÂ•ñÊú∫‰ºöÔºÅ');
                            // Ê∏ÖÈô§URL‰∏≠ÁöÑpageÂèÇÊï∞
                            if (window.location.search.includes('page=')) {
                                window.history.replaceState({}, '', window.location.pathname);
                            }
                            // Á°Æ‰øùÂú®ÊäΩÂ•ñÈ°µÈù¢
                            const currentPage = document.querySelector('.page.active');
                            if (currentPage && currentPage.id !== 'spinPage') {
                                switchPage('spinPage');
                            }
                        }
                    } else {
                        console.error('‚ùå È¢ÜÂèñÊ∏∏ÊàèÂ•ñÂä±Â§±Ë¥•:', result);
                    }
                } catch (error) {
                    console.error('‚ùå È¢ÜÂèñÊ∏∏ÊàèÂ•ñÂä±ÂºÇÂ∏∏:', error);
                }
            }
        }

        // È°µÈù¢Âä†ËΩΩÂêéÁ´ãÂç≥Ê£ÄÊü•ÂºÄÂèëËÄÖÊùÉÈôêÔºàÈíàÂØπÂ∑≤ÁôªÂΩïÁî®Êà∑Ôºâ
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üì± È°µÈù¢DOMÂä†ËΩΩÂÆåÊàê');
            
            // Ê£ÄÊü•URLÂèÇÊï∞ÔºåÁúãÊòØÂê¶ÈúÄË¶ÅË∑≥ËΩ¨Âà∞ÁâπÂÆöÈ°µÈù¢
            const urlParams = new URLSearchParams(window.location.search);
            const targetPage = urlParams.get('page');
            
            // Â¶ÇÊûúURLÊåáÂÆöË∑≥ËΩ¨Âà∞ÊäΩÂ•ñÈ°µÈù¢ÔºàÊ∏∏ÊàèÂÆåÊàêÂêéË∑≥ËΩ¨Ôºâ
            if (targetPage === 'spin') {
                console.log('üéØ URLÂèÇÊï∞ÊåáÂÆöË∑≥ËΩ¨Âà∞ÊäΩÂ•ñÈ°µÈù¢');
                // ‰∏çÁ´ãÂç≥Ë∑≥ËΩ¨ÔºåÁ≠âÂæÖÁôªÂΩïÂÆåÊàêÂêéÂú®init‰∏≠Â§ÑÁêÜ
            }
            
            // ÂàùÂßãÂåñÊèêÁé∞ÈÄöÁü•
            updateWithdrawalNotice();
        });

        init();
    </script>
</body>

</html>
